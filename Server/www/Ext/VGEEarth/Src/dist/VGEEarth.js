!function(){var e={4895:function(e,t,i){i(2775),i(9716),i(5314),i(2777),i(8222),i(7075)},1572:function(){function e(e){this._definitionChanged=new Cesium.Event,this.colorSubscription=void 0,this.color=e.color,this.duration=e.duration,this.url=e.imgUrl,this._time=(new Date).getTime()}Object.defineProperties(e.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color")}),e.prototype.getType=function(e){return"Cloud"},e.prototype.getValue=function(e,t){return Cesium.defined(t)||(t={}),t.color=Cesium.Property.getValueOrClonedDefault(this.color,e,Cesium.Color.WHITE,t.color),t.image=this.url,t.time=((new Date).getTime()-this._time)%this.duration/this.duration,t},e.prototype.equals=function(t){return this===t||t instanceof e&&Cesium.Property.equals(this.color,t.color)},Cesium.CloudMaterialProperty=e,Cesium.Material.CloudType="Cloud",Cesium.Material.CloudSource="czm_material czm_getMaterial(czm_materialInput materialInput)\n{\n     czm_material material = czm_getDefaultMaterial(materialInput);\n     vec2 st = materialInput.st;\n     vec4 colorImage = texture2D(image,   vec2(fract(st.s + time),fract(st.t)));\n     material.alpha = colorImage.a * color.a  ;\n     material.diffuse =  1.3 * color.rgb  ;\n     return material;\n }",Cesium.Material._materialCache.addMaterial(Cesium.Material.CloudType,{fabric:{type:Cesium.Material.CloudType,uniforms:{color:new Cesium.Color(1,0,0,.5),image:"",time:0},source:Cesium.Material.CloudSource},translucent:function(e){return!0}})},5673:function(e,t,i){var n=i(3456);(e.exports=i(9252)(!1)).push([e.id,'@font-face {\r\n  font-family: "iconfont"; /* Project id 3068445 */\r\n  src: url('+n(i(289))+") format('woff2'),\r\n       url("+n(i(5266))+") format('woff'),\r\n       url("+n(i(6058))+') format(\'truetype\');\r\n}\r\n\r\n.iconfont {\r\n  font-family: "iconfont" !important;\r\n  font-size: 16px;\r\n  font-style: normal;\r\n  -webkit-font-smoothing: antialiased;\r\n  -moz-osx-font-smoothing: grayscale;\r\n}\r\n\r\n.vge-icon-guanbi2:before {\r\n  content: "\\E725";\r\n}\r\n\r\n.vge-icon-shipin:before {\r\n  content: "\\E644";\r\n}\r\n\r\n.vge-icon-zhuanyiluxian:before {\r\n  content: "\\E657";\r\n}\r\n\r\n.vge-icon-wenjianjia:before {\r\n  content: "\\EC17";\r\n}\r\n\r\n.vge-icon-mimazhongzhi:before {\r\n  content: "\\E60E";\r\n}\r\n\r\n.vge-icon-vr:before {\r\n  content: "\\E6F6";\r\n}\r\n\r\n.vge-icon-shuizhi:before {\r\n  content: "\\E638";\r\n}\r\n\r\n.vge-icon-moxingbianji:before {\r\n  content: "\\EC7C";\r\n}\r\n\r\n.vge-icon-sanwei:before {\r\n  content: "\\E633";\r\n}\r\n\r\n.vge-icon-Icon_lujinghuizhi:before {\r\n  content: "\\E631";\r\n}\r\n\r\n.vge-icon-liangsuanmianji:before {\r\n  content: "\\EDC8";\r\n}\r\n\r\n.vge-icon-TINdixingcaozuo:before {\r\n  content: "\\EE2A";\r\n}\r\n\r\n.vge-icon-luopancompass83:before {\r\n  content: "\\E6A1";\r\n}\r\n\r\n.vge-icon-tuichu:before {\r\n  content: "\\E688";\r\n}\r\n\r\n.vge-icon-icon_tianjia:before {\r\n  content: "\\EB89";\r\n}\r\n\r\n.vge-icon-zhongzhi:before {\r\n  content: "\\E669";\r\n}\r\n\r\n.vge-icon-ditu-youxia-tuceng:before {\r\n  content: "\\E628";\r\n}\r\n\r\n.vge-icon-changjingjuanlian:before {\r\n  content: "\\EC64";\r\n}\r\n\r\n.vge-icon-changjing:before {\r\n  content: "\\ED99";\r\n}\r\n\r\n.vge-icon-jianqie:before {\r\n  content: "\\E600";\r\n}\r\n\r\n',""])},634:function(e,t,i){(e.exports=i(9252)(!1)).push([e.id,"html, body {\r\n    height: 100%;\r\n    margin: 0;\r\n    padding: 0;\r\n    overflow: hidden;\r\n}\r\n\r\n* {\r\n    margin: 0;\r\n    padding: 0;\r\n}\r\n\r\n/*定义滚动条高宽及背景 高宽分别对应横竖滚动条的尺寸*/\r\n::-webkit-scrollbar {\r\n    width: 7px;\r\n    height: 7px;\r\n    background-color: #F5F5F5;\r\n}\r\n\r\n/*定义滚动条轨道 内阴影+圆角*/\r\n::-webkit-scrollbar-track {\r\n    box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);\r\n    -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);\r\n    border-radius: 10px;\r\n    background-color: #F5F5F5;\r\n}\r\n\r\n/*定义滑块 内阴影+圆角*/\r\n::-webkit-scrollbar-thumb {\r\n    border-radius: 10px;\r\n    box-shadow: inset 0 0 6px rgba(0, 0, 0, .1);\r\n    -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, .1);\r\n    background-color: #c8c8c8;\r\n}\r\n",""])},1693:function(e,t,i){(e.exports=i(9252)(!1)).push([e.id,".cesium-image-layer-split:hover {\r\n    cursor: ew-resize;\r\n}\r\n",""])},8663:function(e,t,i){(e.exports=i(9252)(!1)).push([e.id,'.MultiFieldAdaptWindow-container {\r\n    position: absolute;\r\n    left: 0px;\r\n    bottom: 0px;\r\n    min-width: 350px;\r\n    min-height: 180px;\r\n    color: white;\r\n}\r\n\r\n.MultiFieldAdaptWindow-container::before {\r\n    position: absolute;\r\n    content: "";\r\n    top: 100%;\r\n    left: calc(50% - 20px);\r\n    border: 20px solid transparent;\r\n    border-top: 40px solid rgba(30, 32, 42, 0.5);\r\n}\r\n\r\n.MultiFieldAdaptWindow-header {\r\n    height: 30px;\r\n    line-height: 30px;\r\n    color: white;\r\n    min-width: 200px;\r\n    padding: 0px 10px;\r\n    background: #1a4879;\r\n    border-top-right-radius: 4px;\r\n    border-top-left-radius: 4px;\r\n    position: relative;\r\n    user-select: none;\r\n}\r\n\r\n.MultiFieldAdaptWindow-close {\r\n    position: absolute;\r\n    right: 1px;\r\n    font-size: 25px;\r\n    cursor: pointer;\r\n    width: 29px;\r\n    text-align: center;\r\n}\r\n\r\n.MultiFieldAdaptWindow-close:hover {\r\n    background: #dc2929b9;\r\n}\r\n\r\n.MultiFieldAdaptWindow-body {\r\n    padding: 5px;\r\n    background: linear-gradient(0deg, rgba(30, 32, 42, 0.5), rgba(13, 16, 19, 0.7));\r\n    border: 1px solid rgb(29, 26, 26);\r\n    border-top: 0px;\r\n    border-bottom-right-radius: 4px;\r\n    border-bottom-left-radius: 4px;\r\n}\r\n\r\n.MultiFieldAdaptWindow-info-item {\r\n    margin: 14px 0px;\r\n    max-width: 350px;\r\n}\r\n\r\n.MultiFieldAdaptWindow-ifno-label {\r\n    display: inline-block;\r\n    min-width: 60px;\r\n    text-align: justify;\r\n    text-align-last: justify;\r\n    background: #fff6f625;\r\n}\r\n\r\n.MultiFieldAdaptWindow-ifno-text {\r\n    background: #fff6f60e;\r\n}\r\n',""])},7938:function(e,t,i){(e.exports=i(9252)(!1)).push([e.id,".div-mask {\r\n    background: #0000;\r\n    position: absolute;\r\n    left: 0;\r\n    top: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    box-shadow: inset 1px 0px 500px 170px #000000;\r\n    pointer-events: none;\r\n    z-index: 999;\r\n}\r\n",""])},3455:function(e,t,i){(e.exports=i(9252)(!1)).push([e.id,".ctrlPanel {\r\n    position: absolute;\r\n    top: 50px;\r\n    left: 50px;\r\n    padding: 20px;\r\n    border: #0ae9ff solid 1px;\r\n    text-align: center;\r\n    z-index: 200;\r\n    background-color: rgba(78, 84, 101, 0.38);\r\n}\r\n",""])},9252:function(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i,n=e[1]||"",o=e[3];if(!o)return n;if(t&&"function"==typeof btoa){var r=(i=o,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */"),a=o.sources.map((function(e){return"/*# sourceURL="+o.sourceRoot+e+" */"}));return[n].concat(a).concat([r]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+i+"}":i})).join("")},t.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},o=0;o<this.length;o++){var r=this[o][0];"number"==typeof r&&(n[r]=!0)}for(o=0;o<e.length;o++){var a=e[o];"number"==typeof a[0]&&n[a[0]]||(i&&!a[2]?a[2]=i:i&&(a[2]="("+a[2]+") and ("+i+")"),t.push(a))}},t}},3456:function(e){e.exports=function(e){return"string"!=typeof e?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),/["'() \t\n]/.test(e)?'"'+e.replace(/"/g,'\\"').replace(/\n/g,"\\n")+'"':e)}},9716:function(e,t,i){var n=i(5673);"string"==typeof n&&(n=[[e.id,n,""]]);i(6723)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},2775:function(e,t,i){var n=i(634);"string"==typeof n&&(n=[[e.id,n,""]]);i(6723)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},5314:function(e,t,i){var n=i(1693);"string"==typeof n&&(n=[[e.id,n,""]]);i(6723)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},7075:function(e,t,i){var n=i(8663);"string"==typeof n&&(n=[[e.id,n,""]]);i(6723)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},8222:function(e,t,i){var n=i(7938);"string"==typeof n&&(n=[[e.id,n,""]]);i(6723)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},2777:function(e,t,i){var n=i(3455);"string"==typeof n&&(n=[[e.id,n,""]]);i(6723)(n,{hmr:!0,transform:void 0,insertInto:void 0}),n.locals&&(e.exports=n.locals)},6723:function(e,t,i){var n,o,r={},a=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=n.apply(this,arguments)),o}),s=function(e,t){return t?t.querySelector(e):document.querySelector(e)},l=function(e){var t={};return function(e,i){if("function"==typeof e)return e();if(void 0===t[e]){var n=s.call(this,e,i);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}}(),c=null,d=0,h=[],u=i(1947);function p(e,t){for(var i=0;i<e.length;i++){var n=e[i],o=r[n.id];if(o){o.refs++;for(var a=0;a<o.parts.length;a++)o.parts[a](n.parts[a]);for(;a<n.parts.length;a++)o.parts.push(w(n.parts[a],t))}else{var s=[];for(a=0;a<n.parts.length;a++)s.push(w(n.parts[a],t));r[n.id]={id:n.id,refs:1,parts:s}}}}function m(e,t){for(var i=[],n={},o=0;o<e.length;o++){var r=e[o],a=t.base?r[0]+t.base:r[0],s={css:r[1],media:r[2],sourceMap:r[3]};n[a]?n[a].parts.push(s):i.push(n[a]={id:a,parts:[s]})}return i}function g(e,t){var i=l(e.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=h[h.length-1];if("top"===e.insertAt)n?n.nextSibling?i.insertBefore(t,n.nextSibling):i.appendChild(t):i.insertBefore(t,i.firstChild),h.push(t);else if("bottom"===e.insertAt)i.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=l(e.insertAt.before,i);i.insertBefore(t,o)}}function v(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=h.indexOf(e);t>=0&&h.splice(t,1)}function f(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var n=i.nc;n&&(e.attrs.nonce=n)}return y(t,e.attrs),g(e,t),t}function y(e,t){Object.keys(t).forEach((function(i){e.setAttribute(i,t[i])}))}function w(e,t){var i,n,o,r;if(t.transform&&e.css){if(!(r=t.transform(e.css)))return function(){};e.css=r}if(t.singleton){var a=d++;i=c||(c=f(t)),n=E.bind(null,i,a,!1),o=E.bind(null,i,a,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",y(t,e.attrs),g(e,t),t}(t),n=M.bind(null,i,t),o=function(){v(i),i.href&&URL.revokeObjectURL(i.href)}):(i=f(t),n=T.bind(null,i),o=function(){v(i)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else o()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=a()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var i=m(e,t);return p(i,t),function(e){for(var n=[],o=0;o<i.length;o++){var a=i[o];(s=r[a.id]).refs--,n.push(s)}for(e&&p(m(e,t),t),o=0;o<n.length;o++){var s;if(0===(s=n[o]).refs){for(var l=0;l<s.parts.length;l++)s.parts[l]();delete r[s.id]}}}};var C,b=(C=[],function(e,t){return C[e]=t,C.filter(Boolean).join("\n")});function E(e,t,i,n){var o=i?"":n.css;if(e.styleSheet)e.styleSheet.cssText=b(t,o);else{var r=document.createTextNode(o),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(r,a[t]):e.appendChild(r)}}function T(e,t){var i=t.css,n=t.media;if(n&&e.setAttribute("media",n),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}function M(e,t,i){var n=i.css,o=i.sourceMap,r=void 0===t.convertToAbsoluteUrls&&o;(t.convertToAbsoluteUrls||r)&&(n=u(n)),o&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var a=new Blob([n],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}},1947:function(e){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var i=t.protocol+"//"+t.host,n=i+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var o,r=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(r)?e:(o=0===r.indexOf("//")?r:0===r.indexOf("/")?i+r:n+r.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}},6058:function(e,t,i){e.exports=i.p+"./css/iconfont/iconfont.ttf"},289:function(e,t,i){e.exports=i.p+"./css/iconfont/iconfont.woff2"},5266:function(e,t,i){e.exports=i.p+"./css/iconfont/iconfont.woff"},631:function(e,t,i){e.exports=i.p+"./img/customBgImage/backGroundImg.jpg"},7411:function(e,t,i){e.exports=i.p+"./img/customBgImage/backGroundImg.png"},710:function(e,t,i){e.exports=i.p+"./img/earth/worldimage2.png"},7332:function(e,t,i){e.exports=i.p+"./img/excavate/excavate_bottom_min.jpg"},5094:function(e,t,i){e.exports=i.p+"./img/excavate/excavate_side_min.jpg"},8658:function(e,t,i){e.exports=i.p+"./img/hotspotboard/home_icon_18.png"},4655:function(e,t,i){e.exports=i.p+"./img/hotspotboard/home_icon_19.png"},230:function(e,t,i){e.exports=i.p+"./img/hotspotboard/home_icon_20.png"},3639:function(e,t,i){e.exports=i.p+"./img/hotspotboard/home_icon_21.png"},8709:function(e,t,i){e.exports=i.p+"./img/icon.png"},9734:function(e,t,i){e.exports=i.p+"./img/marker/mark3.png"},4739:function(e,t,i){e.exports=i.p+"./img/pathPlaning/end.png"},8465:function(e,t,i){e.exports=i.p+"./img/pathPlaning/start.png"},2015:function(e,t,i){e.exports=i.p+"./img/pathPlaning/tjd.png"},9561:function(e,t,i){e.exports=i.p+"./img/polyLineMaterial/传输线材质.png"},8425:function(e,t,i){e.exports=i.p+"./img/polyLineMaterial/箭头线材质.png"},2257:function(e,t,i){e.exports=i.p+"./img/polyLineMaterial/脉冲线材质.png"},6613:function(e,t,i){e.exports=i.p+"./img/skybox/01/nx.png"},8598:function(e,t,i){e.exports=i.p+"./img/skybox/01/ny.png"},9729:function(e,t,i){e.exports=i.p+"./img/skybox/01/nz.png"},3324:function(e,t,i){e.exports=i.p+"./img/skybox/01/px.png"},6288:function(e,t,i){e.exports=i.p+"./img/skybox/01/py.png"},2954:function(e,t,i){e.exports=i.p+"./img/skybox/01/pz.png"},1185:function(e,t,i){e.exports=i.p+"./img/skybox/02/nx.jpg"},6029:function(e,t,i){e.exports=i.p+"./img/skybox/02/ny.jpg"},138:function(e,t,i){e.exports=i.p+"./img/skybox/02/nz.jpg"},632:function(e,t,i){e.exports=i.p+"./img/skybox/02/px.jpg"},8041:function(e,t,i){e.exports=i.p+"./img/skybox/02/py.jpg"},323:function(e,t,i){e.exports=i.p+"./img/skybox/02/pz.jpg"},4121:function(e,t,i){e.exports=i.p+"./img/skybox/03/nx.jpg"},7299:function(e,t,i){e.exports=i.p+"./img/skybox/03/ny.jpg"},291:function(e,t,i){e.exports=i.p+"./img/skybox/03/nz.jpg"},4575:function(e,t,i){e.exports=i.p+"./img/skybox/03/px.jpg"},1234:function(e,t,i){e.exports=i.p+"./img/skybox/03/py.jpg"},7284:function(e,t,i){e.exports=i.p+"./img/skybox/03/pz.jpg"},8473:function(e,t,i){e.exports=i.p+"./img/skybox/04/nx.jpg"},5378:function(e,t,i){e.exports=i.p+"./img/skybox/04/ny.jpg"},2084:function(e,t,i){e.exports=i.p+"./img/skybox/04/nz.jpg"},2634:function(e,t,i){e.exports=i.p+"./img/skybox/04/px.jpg"},5009:function(e,t,i){e.exports=i.p+"./img/skybox/04/py.jpg"},630:function(e,t,i){e.exports=i.p+"./img/skybox/04/pz.jpg"}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={id:n,exports:{}};return e[n](r,r.exports,i),r.exports}i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e}(),function(){"use strict";var e={};i.r(e),i.d(e,{cartesian3ObjToCartographicArr:function(){return k},cartesian3ObjToCartographicObj:function(){return I},cartographicArrToCartesian3Obj:function(){return L}}),i(4895);const t=window,n=t.Cesium,o=t.ol,r=t.turf,a=t.proj4,s=t.videojs,l=(t.$,t.html2canvas);var c,d,h,u,p,m={initRootDom(e="MapContainer"){let t=document.getElementById(e);if(t){t.style.cssText="",t.innerHTML="",t.style.position="absolute",t.style.height="100%",t.style.width="100%",t.style.display="flex",t.style.minWidth="500px",t.style.minHeight="400px";let e=document.createElement("div"),i=document.createElement("div");e.setAttribute("id","viewer3DDom"),i.setAttribute("id","viewer2DDom"),e.style.height="100%",i.style.height="100%",e.style.width="100%",i.style.width="100%",e.style.display="inline-block",i.style.display="none",t.appendChild(e),t.appendChild(i)}},initCesiumMapLink23d(){let e=document.getElementById("viewer2DDom"),t=document.getElementById("viewer3DDom");e&&(e.style.display="inline-block",e.style.width="50%"),t&&(t.style.display="inline-block",t.style.width="50%")},closeCesiumMapLink23d(){let e=document.getElementById("viewer2DDom"),t=document.getElementById("viewer3DDom");e&&(e.style.display="none",e.style.width="100%"),t&&(t.style.display="inline-block",t.style.width="100%")},initMapLink23d(){let e=document.getElementById("MapContainer"),t=document.getElementById("ol-container"),i=document.getElementById("viewer3DDom");t||(t=document.createElement("div"),t.id="ol-container",e&&e.appendChild(t)),t.style.cssText="\n            width: 50%;\n            height: 100%;\n            display: inline-block;\n            ",i.style.cssText="\n            width: 50%;\n            height: 100%;\n            "},closeOLMapLink23d(){let e=document.getElementById("ol-container"),t=document.getElementById("viewer3DDom");e&&(e.style.cssText="",e.style.display="none"),t&&(t.style.width="100%",t.style.display="inline-block")},initOverviewMapDom(){let e=document.getElementById("MapContainer"),t=document.getElementById("ol-container");t||(t=document.createElement("div"),t.id="ol-container",e&&e.appendChild(t)),t.style.cssText="\n            position: absolute;\n            z-index: 99999px;\n            bottom: 10px;\n            right: 30px;\n            height: 160px;\n            width: 300px;\n            border-radius: 8px;\n            padding: 5px;\n            border: 2px solid rgba(255, 255, 255, 0.637);",t.style.display="inline"},closeOverviewMapDom(){let e=document.getElementById("ol-container");e&&(e.style.display="none")}},g={animation:!1,homeButton:!1,geocoder:!1,baseLayerPicker:!1,timeline:!1,fullscreenButton:!1,scene3DOnly:!0,infoBox:!0,sceneModePicker:!1,navigationInstructionsInitiallyVisible:!1,navigationHelpButton:!1,selectionIndicator:!1,orderIndependentTranslucency:!1,shadows:!1,shouldAnimate:!0,contextOptions:{webgl:{alpha:!0,preserveDrawingBuffer:!0}}},v={homeButton:!1,fullscreenButton:!1,sceneModePicker:!1,clockViewModel:new n.ClockViewModel,infoBox:!1,geocoder:!1,sceneMode:n.SceneMode.SCENE2D,navigationHelpButton:!1,animation:!1,timeline:!1,baseLayerPicker:!1},f=function(){let e=(new Date).getTime();return"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){let i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?i:7&i|8).toString(16)}))},y={Version:"v0.17",Token:"",appName:"VGEEarth WebGL平台",appTitle:"VGEEarth",appIcon:i(8709),homeView:{lon:110,lat:40,height:15e6},GISResourcesUrl:"",AppBaseUrl:"",layerList:[{name:"基本图层",catalog:"基础数据",dataType:"layer",defaultLoad:!0,properties:{baseLayer:!0,scheme:"layer-singleTileImagery"}},{name:"mapbox影像",catalog:"基础数据",dataType:"layer",defaultLoad:!0,properties:{scheme:"layer-xyz-3857",url:"https://api.mapbox.com/styles/v1/mapbox/satellite-v9/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXFhYTA2bTMyeW44ZG0ybXBkMHkifQ.gUGbDOPUN1v1fTs5SeOR4A",minimumLevel:7,maximumLevel:15,legend:"",rectangle:{}}}],terrainList:[],modelList:[],cesium3DTileSetList:[],geoJsonList:[],poi:[]};!function(e){e[e.addData=0]="addData"}(c||(c={})),function(e){e[e.init=0]="init",e[e.hide=1]="hide",e[e.show=2]="show",e[e.destroy=3]="destroy"}(d||(d={})),function(e){e[e.LEFT_DOWN=0]="LEFT_DOWN",e[e.LEFT_UP=1]="LEFT_UP",e[e.LEFT_CLICK=2]="LEFT_CLICK",e[e.LEFT_DOUBLE_CLICK=3]="LEFT_DOUBLE_CLICK",e[e.RIGHT_DOWN=5]="RIGHT_DOWN",e[e.RIGHT_UP=6]="RIGHT_UP",e[e.RIGHT_CLICK=7]="RIGHT_CLICK",e[e.MIDDLE_DOWN=10]="MIDDLE_DOWN",e[e.MIDDLE_UP=11]="MIDDLE_UP",e[e.MIDDLE_CLICK=12]="MIDDLE_CLICK",e[e.MOUSE_MOVE=15]="MOUSE_MOVE",e[e.WHEEL=16]="WHEEL",e[e.PINCH_START=17]="PINCH_START",e[e.PINCH_END=18]="PINCH_END",e[e.PINCH_MOVE=19]="PINCH_MOVE"}(h||(h={})),function(e){e[e.LEFT_DRAG=0]="LEFT_DRAG",e[e.RIGHT_DRAG=1]="RIGHT_DRAG",e[e.MIDDLE_DRAG=2]="MIDDLE_DRAG",e[e.WHEEL=3]="WHEEL",e[e.PINCH=4]="PINCH"}(u||(u={})),function(e){e[e.addData=0]="addData",e[e.removeData=1]="removeData",e[e.changedData=2]="changedData"}(p||(p={}));var w,C={ConfigEventType:c,ViewerEventType:d,ScreenSpaceEventType:h,CameraEventType:u,DataEventType:p},b=class{constructor(){this.listenCallbacks=[]}addEventListener(e,t,i){return!this.listenCallbacks.find((n=>n.listenType===e&&n.scope===t&&n.callback===i))&&(this.listenCallbacks.push({listenType:e,callback:i,scope:t}),!0)}triggerEvent(e,t,i){this.listenCallbacks.forEach((n=>{n.listenType===e&&n.scope===t&&"function"==typeof n.callback&&n.callback(i)}))}removeEventListener(e){return!!this.listenCallbacks.find((t=>t.callback===e))&&(this.listenCallbacks=this.listenCallbacks.filter((t=>t.callback!==e)),!0)}},E=class extends b{constructor(){super()}},T={ListenType:C,configEvent:new class extends b{constructor(){super()}},screenEvent:new E,sourceEvent:new E,viewerEvent:new class extends b{constructor(){super()}}};!function(e){e[e.global=0]="global",e[e.Viewer3D=1]="Viewer3D",e[e.Viewer2D=2]="Viewer2D",e[e.initOL=3]="initOL"}(w||(w={}));var M=w;let S,x={getConfig(){if(window.document.title=S.appTitle,![...document.getElementsByTagName("link")].find((e=>"shortcut icon"===e.rel&&"image/x-icon"===e.type))){let e=document.createElement("link");e.href=S.appIcon,e.type="image/x-icon",e.rel="shortcut icon",document.getElementsByTagName("head")[0].appendChild(e)}return JSON.parse(JSON.stringify(S))},loadConfig(e){void 0===S?S=e:(e.Token&&(S.Token=e.Token),e.appName&&(S.appName=e.appName),e.appTitle&&(S.appTitle=e.appTitle),e.homeView&&(S.homeView=e.homeView),e.AppBaseUrl&&(S.AppBaseUrl=e.AppBaseUrl),e.GISResourcesUrl&&(S.GISResourcesUrl=e.GISResourcesUrl),e.layerList&&(S.layerList=e.layerList),e.terrainList&&(S.terrainList=e.terrainList),e.modelList&&(S.modelList=e.modelList),e.cesium3DTileSetList&&(S.cesium3DTileSetList=e.cesium3DTileSetList),e.geoJsonList&&(S.geoJsonList=e.geoJsonList),e.poi&&(S.poi=e.poi)),P(e),e.terrainList&&function(e){let t=!1;e.length>0&&e.map((e=>(t&&(e.defaultLoad=!1),e.defaultLoad&&(t=!0),e)))}(e.terrainList)},addSourcesItem(e){switch(e.dataType){case"layer":S.layerList.push(e);break;case"terrain":S.terrainList.push(e);break;case"model":S.modelList.push(e);break;case"cesium3DTileSet":S.cesium3DTileSetList.push(e);break;case"geoJson":S.geoJsonList.push(e);break;case"poi":S.poi.push(e)}P(S),T.configEvent.triggerEvent(C.ConfigEventType.addData,M.global,{})},getSourcesItem(e){return this.getAllSources().find((t=>t.pid===e))},getAllSources(){let e=this.getConfig();return[...e.layerList,...e.terrainList,...e.modelList,...e.cesium3DTileSetList,...e.geoJsonList,...e.poi]},getBaseLayer(){return this.getConfig().layerList.find((e=>"layer"===e.dataType&&e.defaultLoad&&e.properties.baseLayer))}};function P(e){function t(e=[]){return e.map((e=>{e.pid=e.pid||f(),e.disable=e.disable||!1,e.defaultLoad=e.defaultLoad||!1,e.show=e.defaultLoad||!1})),e.filter((e=>!e.disable))}return e.layerList=t(e.layerList),e.terrainList=t(e.terrainList),e.modelList=t(e.modelList),e.cesium3DTileSetList=t(e.cesium3DTileSetList),e.geoJsonList=t(e.geoJsonList),e.poi=t(e.poi),e}x.loadConfig(y);var D=x,_={getJson:function(e,t){return new Promise((function(i,n){let o=new XMLHttpRequest;o.open("GET",e,!1),o.onreadystatechange=function(){if(4==o.readyState){if(200==o.status||304==o.status){let n={};try{n=JSON.parse(o.responseText)}catch(t){console.log(e,"数据解析错误：",o.responseText)}"function"==typeof t&&t(n),i(n)}n()}},o.send()}))},getText:function(e,t){return new Promise((function(i,n){let o=new XMLHttpRequest;o.open("GET",e,!1),o.onreadystatechange=function(){4==o.readyState&&(200!=o.status&&304!=o.status||("function"==typeof t&&t(o.responseText),i(o.responseText)),n())},o.send()}))},post:function(e,t,i){let n=new XMLHttpRequest;n.open("POST",e,!1),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){4==n.readyState&&(200!=n.status&&304!=n.status||i(n.responseText))},n.send(t)}},A=function(){return new n.Viewer(document.createElement("div"))};function I(e){let t=A(),i=[];for(let o=0;o<e.length;o++){let r=t.scene.globe.ellipsoid,a=new n.Cartesian3(e[o].x,e[o].y,e[o].z),s=r.cartesianToCartographic(a),l={longitude:n.Math.toDegrees(s.longitude),latitude:n.Math.toDegrees(s.latitude),height:s.height};i.push(l)}return i}function k(e){let t=A(),i=[];for(let o=0;o<e.length;o++){let r=t.scene.globe.ellipsoid,a=new n.Cartesian3(e[o].x,e[o].y,e[o].z),s=r.cartesianToCartographic(a);i.push([s.longitude/Math.PI*180,s.latitude/Math.PI*180,s.height])}return i}function L(e){let t=[];for(let i=0;i<e.length;i++)t.push(new n.Cartesian3.fromDegrees(e[i].longitude,e[i].latitude,e[i].height));return t}var R={Bjax:_,CoordinateTool:e,sleep:async function(e){return new Promise((t=>setTimeout(t,e)))},uuid:f},O=function(e){let t=D.getConfig();e.scene.globe.baseColor=n.Color.BLACK,e._cesiumWidget._creditContainer.style.display="none",e.camera.DEFAULT_VIEW_RECTANGLE=new n.Cartographic(t.homeView.lon,t.homeView.lat,t.homeView.height),e.scene.camera.setView({destination:n.Cartesian3.fromDegrees(t.homeView.lon,t.homeView.lat,t.homeView.height)}),e.scene.fxaa=!0,e.scene.postProcessStages.fxaa.enabled=!0},B=function(){return window?.earth?.viewer3D};let F={open(e){!e&&(e=B()),e.scene.debugShowFramesPerSecond=!0},close(e){!e&&(e=B()),e.scene.debugShowFramesPerSecond=!1}};var W=F;let N={state:!1,open(){this.state=!0;let e=B();W.open(e)},close(){this.state=!1;let e=B();W.close(e)}};var H=N,V=function(e){e||(e=B());let t=e.scene.canvas.width,i=e.scene.canvas.height,o=[];return[{x:10,y:10},{x:10,y:i/10},{x:10,y:i/10*2},{x:10,y:i/10*3},{x:10,y:i/10*4},{x:10,y:i/10*5},{x:10,y:i/10*6},{x:10,y:i/10*7},{x:10,y:i/10*8},{x:10,y:i/10*9},{x:10,y:i-10},{x:t/10,y:i-10},{x:t/10*2,y:i-10},{x:t/10*3,y:i-10},{x:t/10*4,y:i-10},{x:t/10*5,y:i-10},{x:t/10*6,y:i-10},{x:t/10*7,y:i-10},{x:t/10*8,y:i-10},{x:t/10*9,y:i-10},{x:t-10,y:i-10},{x:t-10,y:i/10*9},{x:t-10,y:i/10*8},{x:t-10,y:i/10*7},{x:t-10,y:i/10*6},{x:t-10,y:i/10*5},{x:t-10,y:i/10*4},{x:t-10,y:i/10*3},{x:t-10,y:i/10*2},{x:t-10,y:i/10},{x:t-10,y:10},{x:t/10*9,y:10},{x:t/10*8,y:10},{x:t/10*7,y:10},{x:t/10*6,y:10},{x:t/10*5,y:10},{x:t/10*4,y:10},{x:t/10*3,y:10},{x:t/10*2,y:10},{x:t/10,y:10}].forEach((t=>{let i=new n.Cartesian2(t.x,t.y),r=e.scene.globe.pick(e.camera.getPickRay(i),e.scene);if(r){let e=n.Cartographic.fromCartesian(r),t=[e.longitude/Math.PI*180,e.latitude/Math.PI*180];o.push(t)}})),o.length>0&&o.push(o[0]),o};let z={getCameraHeight:function(e){let t=(e=e||B()).scene,i=t.canvas.clientWidth,o=t.canvas.clientHeight,r=t.camera.getPickRay(new n.Cartesian2(i/2|0,o-1)),a=t.camera.getPickRay(new n.Cartesian2(1+i/2|0,o-1)),s=t.globe,l=s.pick(r,t),c=s.pick(a,t);function d(e){return null!=e}if(!d(l)||!d(c))return NaN;let h=s.ellipsoid.cartesianToCartographic(l),u=s.ellipsoid.cartesianToCartographic(c),p=new n.EllipsoidGeodesic;return p.setEndPoints(h,u),100*p.surfaceDistance},getCameraInfo:function(e){e=e||B();let{position:t,heading:i,pitch:n,roll:o}=e.camera;return{destination:t,orientation:{heading:i,pitch:n,roll:o}}},getCameraRectangle:function(e="Radian"){let t=B().scene.camera.computeViewRectangle(),i={west:0,south:0,east:0,north:0};return t&&("Degree"===e?(i.west=180/Math.PI*t,i.south=180/Math.PI*t,i.east=180/Math.PI*t,i.north=180/Math.PI*t):i=JSON.parse(JSON.stringify(t))),i},getCameraRectanglePoint:V,getCameraRectangleGeoJson:function(e){let t=V(e),i=r.polygon([t]);return{rectGeoJson:i,area:r.area(i)/1e6+"平方千米"}}};var G=z;let U={AroundPoint:class{constructor(e,t,i){this.viewer=e,this.position=t,this.rAngle=i||.05,this.heading=0}activate(){this.entity&&this.deactivate(),this.heading=0,this.offset=new n.HeadingPitchRange(n.Math.toRadians(this.heading),n.Math.toRadians(-45),2e3),this.entity=this.viewer.entities.add({position:this.position,point:{pixelSize:10,color:n.Color.RED.withAlpha(.01)}}),this.viewer.zoomTo(this.entity,this.offset).then((()=>{this.viewer.scene.screenSpaceCameraController.enableInputs=!1,this.viewer.clock.onTick.addEventListener(this.postRenderEvent,this)}))}postRenderEvent(){this.heading-=this.rAngle,this.offset=new n.HeadingPitchRange(n.Math.toRadians(this.heading),n.Math.toRadians(-45),2e3),this.entity&&this.viewer.zoomTo(this.entity,this.offset)}deactivate(){this.viewer.clock.onTick.removeEventListener(this.postRenderEvent,this),this.viewer.scene.screenSpaceCameraController.enableInputs=!0,this.entity&&this.viewer.entities.remove(this.entity),this.entity=void 0}},BookmarkManager:class{constructor(e,t){this._viewer=e,this._bookmarkList=t}add(e){this._bookmarkList.push(e)}getBookmarkList(){return this._bookmarkList}_getSceneImage(e,t){let i=this._viewer.scene.canvas,n=new Image;return n.src=i.toDataURL("image/png"),new Promise(((o,r)=>{n.onload=function(){i=document.createElement("canvas"),i.width=t,i.height=e,i.getContext("2d").drawImage(n,0,0,i.width,i.height),o(i.toDataURL("image/jpeg"))}}))}createBookmark(e,t,i){let n=this._viewer.scene;return new Promise(((o,r)=>{this._getSceneImage(t,i).then((t=>{o({id:(new Date).getTime(),img:t,name:e,cameraView:{destination:{x:n.camera.position.x,y:n.camera.position.y,z:n.camera.position.z},orientation:{heading:n.camera.heading,pitch:n.camera.pitch,roll:n.camera.roll}}})}))}))}getBookmark(e){for(let t=0;t<this._bookmarkList.length;t++)if(this._bookmarkList[t].id===e)return this._bookmarkList[t]}removeBookmark(e){for(let t=0;t<this._bookmarkList.length;t++)if(this._bookmarkList[t].id===e){this._bookmarkList.splice(t,1);break}}},CameraLimit:class{constructor(e,t,i,o={destination:e.scene.camera.position,orientation:{heading:e.scene.camera.heading,pitch:e.scene.camera.pitch,roll:e.scene.camera.roll},duration:1}){this._viewer=e,this._position=t,this._options=i||{},this._defaultView=o,this._ellipsoid=new n.Entity}initLimit(){this._options.debugExtent&&this._addLimitEllipsoid(this._position,this._options.radius||1e3),this._viewer.camera.moveEnd.addEventListener(this._cameraMoveEndEventHnadle,this)}destroy(){this._viewer.camera.moveEnd.removeEventListener(this._cameraMoveEndEventHnadle,this),this._viewer.entities.remove(this._ellipsoid)}_addLimitEllipsoid(e,t){this._ellipsoid=this._viewer.entities.add({position:e,show:this._options.debugExtent,ellipsoid:{radii:new n.Cartesian3(t,t,t),maximumCone:n.Math.toRadians(90),material:n.Color.RED.withAlpha(.1),subdivisions:128,stackPartitions:32,slicePartitions:32,outline:!0,outlineColor:n.Color.AQUA.withAlpha(1)}})}_cameraMoveEndEventHnadle(){let e=this._viewer.camera.position;n.Cartesian3.distance(e,this._defaultView.destination)>(this._options.radius||2e3)?this._viewer.camera.flyTo(this._defaultView):this._defaultView={destination:n.Cartesian3.clone(this._viewer.camera.position),orientation:{heading:this._viewer.camera.heading,pitch:this._viewer.camera.pitch,roll:this._viewer.camera.roll},duration:1}}},GlobeRotate:class{constructor(e,t){this.viewer=e,this.rAngle=Cesium.Math.toRadians(t||-.05)}activate(){this.removeEvent&&this.deactivate(),this.removeEvent=this.viewer.scene.postRender.addEventListener(this.postRenderEvent,this)}postRenderEvent(){this.viewer.scene.camera.rotate(Cesium.Cartesian3.UNIT_Z,this.rAngle)}deactivate(){this.viewer.scene.postRender.removeEventListener(this.postRenderEvent,this),this.removeEvent=void 0}},CenterPosition:class{constructor(e){this.viewer=e}getValue(){let e=new Cesium.Cartesian2(this.viewer.canvas.clientWidth/2,this.viewer.canvas.clientHeight/2),t=this.viewer.camera.pickEllipsoid(e);if(t||(t=this.viewer.scene.pickPosition(e)),!t)return;let i=Cesium.Ellipsoid.WGS84.cartesianToCartographic(t),n=180*i.longitude/Math.PI,o=180*i.latitude/Math.PI;return Cesium.Cartesian3.fromDegrees(n,o,i.height)}},StartAnimation:class{constructor(e,t){this.viewer=e,this.opts=t,this._isFlyAnimation=!1}activate(){let e=this.opts||{},t=this,i=this.viewer,o=e.center||this.getCameraView(this.viewer);this._isFlyAnimation=!0,i.camera.setView({destination:n.Cartesian3.fromDegrees(-85.16,13.71,23e6)}),i.camera.flyTo({destination:n.Cartesian3.fromDegrees(o.x,o.y,23e6),duration:e.duration1||2,easingFunction:n.EasingFunction.LINEAR_NONE,complete:function(){let r=n.defaultValue(o.z,9e4);r<2e5&&-90!=o.pitch?(r=1.2*r+8e3,i.camera.flyTo({destination:n.Cartesian3.fromDegrees(o.x,o.y,r),duration:e.duration2||2,easingFunction:e.easingFunction2,complete:function(){t.centerAt(o,{duration:e.duration3||2,easingFunction:e.easingFunction3,complete:function(){t._isFlyAnimation=!1,e.callback&&e.callback()}})}})):t.centerAt(o,{duration:e.duration3||2,easingFunction:e.easingFunction3,complete:function(){t._isFlyAnimation=!1,e.callback&&e.callback()}})}})}getCameraView(e){let t=e.camera,i=t.positionCartographic;return{y:n.Math.toDegrees(i.latitude),x:n.Math.toDegrees(i.longitude),z:i.height,heading:n.Math.toDegrees(t.heading||0)%360,pitch:n.Math.toDegrees(t.pitch||0)%360,roll:n.Math.toDegrees(t.roll||0)%360}}centerAt(e,t){if(null==t&&(t={}),null==e&&(t.isWgs84=!0,e=this.config.extent||this.config.center),null==e)return;let i={};for(let e in t)i[e]=t[e];if(e.xmin&&e.xmax&&e.ymin&&e.ymax){let t=e.xmin,o=e.xmax,r=e.ymin,a=e.ymax,s=(t+o)/2,l=(r+a)/2,c=n.Rectangle.fromDegrees(t,r,o,a),d=Math.max(c.height,c.width),h=n.Math.chordLength(d,this.viewer.scene.globe.ellipsoid.maximumRadius),u=n.defaultValue(e.height,0);0==u&&(u=point.getSurfaceHeight(this.viewer.scene,n.Cartesian3.fromDegrees(s,l))),i.destination=n.Cartesian3.fromDegrees(s,l,h+u),i.orientation={heading:n.Math.toRadians(n.defaultValue(e.heading,0)),pitch:n.Math.toRadians(n.defaultValue(e.pitch,-90)),roll:n.Math.toRadians(n.defaultValue(e.roll,0))},this.viewer.camera.flyTo(i)}else{let t=n.defaultValue(i.minz,2500);this.viewer.camera.positionCartographic.height<t&&(t=this.viewer.camera.positionCartographic.height),null!=e.z&&0!=e.z&&(t=e.z),i.destination=n.Cartesian3.fromDegrees(e.x,e.y,t),i.orientation={heading:n.Math.toRadians(n.defaultValue(e.heading,0)),pitch:n.Math.toRadians(n.defaultValue(e.pitch,-90)),roll:n.Math.toRadians(n.defaultValue(e.roll,0))},this.viewer.camera.flyTo(i)}}deactivate(){this.viewer.camera.cancelFlight()}}};var j=U;let Z;var Y={addSnowEffect(){this.removeEffect(),Z=new n.PostProcessStage({fragmentShader:this.getSnow_fs()}),B().scene.postProcessStages.add(Z)},addRainEffect(){this.removeEffect(),Z=new n.PostProcessStage({fragmentShader:this.getRain_fs()}),B().scene.postProcessStages.add(Z)},addFogEffect(){this.removeEffect(),Z=new n.PostProcessStage({fragmentShader:this.getFog_fs()}),B().scene.postProcessStages.add(Z)},removeEffect(){Z&&(B().scene.postProcessStages.remove(Z),Z=void 0)},getSnow_fs:()=>"uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\nfloat snow(vec2 uv,float scale)\n{\n    float time = czm_frameNumber / 60.0;\n    float w=smoothstep(1.,0.,-uv.y*(scale/10.));if(w<.1)return 0.;\n    uv+=time/scale;uv.y+=time*2./scale;uv.x+=sin(uv.y+time*.5)/scale;\n    uv*=scale;vec2 s=floor(uv),f=fract(uv),p;float k=3.,d;\n    p=.5+.35*sin(11.*fract(sin((s+p+scale)*mat2(7,3,6,5))*5.))-f;d=length(p);k=min(d,k);\n    k=smoothstep(0.,k,sin(f.x+f.y)*0.01);\n    return k*w;\n}\nvoid main(void){\n     vec2 resolution = czm_viewport.zw;\n     vec2 uv=(gl_FragCoord.xy*2.-resolution.xy)/min(resolution.x,resolution.y);\n     vec3 finalColor=vec3(0);\n     float c = 0.0;\n     c+=snow(uv,30.)*.0;\n     c+=snow(uv,20.)*.0;\n     c+=snow(uv,15.)*.0;\n     c+=snow(uv,10.);\n     c+=snow(uv,8.);\n     c+=snow(uv,6.);\n     c+=snow(uv,5.);\n     finalColor=(vec3(c));\n     gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), vec4(finalColor,1), 0.5);\n}",getRain_fs:()=>"uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\n\tfloat hash(float x){\n\t     return fract(sin(x*133.3)*13.13);\n\t }\n\tvoid main(void){\n\t     float time = czm_frameNumber / 600.0;\n\t     vec2 resolution = czm_viewport.zw; \n\t     vec2 uv=(gl_FragCoord.xy*2.-resolution.xy)/min(resolution.x,resolution.y);\n\t     vec3 c=vec3(.6,.7,.8); \n\t     float a=-.4;\n\t     float si=sin(a),co=cos(a);\n\t     uv*=mat2(co,-si,si,co);\n\t     uv*=length(uv+vec2(0,4.9))*.3+1.;\n\t     float v=1.-sin(hash(floor(uv.x*100.))*2.);\n\t     float b=clamp(abs(sin(20.*time*v+uv.y*(5./(2.+v))))-.95,0.,1.)*20.;\n\t     c*=v*b; \n\t     gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), vec4(c,1), 0.5); \n\t}",getFog_fs:()=>"uniform sampler2D colorTexture;\n  uniform sampler2D depthTexture;\n  varying vec2 v_textureCoordinates;\n  void main(void)\n  {\n      vec4 origcolor=texture2D(colorTexture, v_textureCoordinates);\n      vec4 fogcolor=vec4(0.8,0.8,0.8,0.5);\n      float depth = czm_readDepth(depthTexture, v_textureCoordinates);\n      vec4 depthcolor=texture2D(depthTexture, v_textureCoordinates);\n      float f=(depthcolor.r-0.7)/0.2;\n      if(f<0.0) f=0.0;\n      else if(f>1.0) f=1.0;\n      gl_FragColor = mix(origcolor,fogcolor,f);\n   }"};let J,Q,X,q;function K(){let e=J.camera.positionCartographic.height,t=Date.now(),i=(t-X)/1e3*5/180*Math.PI*(e/24678990.67414785);X=t,J.scene.camera.rotate(n.Cartesian3.UNIT_Z,-i)}function ee(){(new Date).getTime()-Q.getTime()>6e4&&te()}function te(){X=Date.now(),J.clock.onTick.addEventListener(K),window.clearInterval(q),q=null}var ie={rotateInit(e){let t=this;J=e||B();let i=new n.ScreenSpaceEventHandler(J.scene.canvas);te(),i.setInputAction((function(){t.endRote(),i.removeInputAction(n.ScreenSpaceEventType.LEFT_CLICK)}),n.ScreenSpaceEventType.LEFT_CLICK)},endRote(){J&&(J.clock.onTick.removeEventListener(K),q||(q=window.setInterval(ee,500)),Q=new Date)}};class ne{constructor(e,t){this.viewer=e;let n=[i(631),i(7411)];this.bgUrl=t||n[0],this.init()}init(){this.viewer.scene.skyBox.show=!1,this.viewer.scene.backgroundColor=new n.Color(0,0,0,0),this.viewer.container.style.backgroundImage=" url("+this.bgUrl+")",this.viewer.container.style.backgroundSize="cover"}remove(){this.viewer.scene.skyBox.show=!0,this.viewer.scene.backgroundColor=new n.Color(0,0,0,0),this.viewer.container.style.backgroundImage="",this.viewer.container.style.backgroundSize="auto"}}var oe=class{constructor(e,t){this.viewer=e,this.map=t,this.activateContainer="",this.initEvent(),this.activate(),this.addMapData()}initEvent(){this.viewer.scene.postRender.addEventListener((e=>{if("viewer"!==this.activateContainer)return;let t=this.viewer.camera.computeViewRectangle();if(!t)return void console.log("rec is undefined");let i=[n.Math.toDegrees(t.west),n.Math.toDegrees(t.south),n.Math.toDegrees(t.east),n.Math.toDegrees(t.north)];if(o.extent.isEmpty(i))return void console.log("extent is empty");const r=this.getPolygonByBbox(i);this.feature.setGeometry(new o.geom.Polygon(r)),this.map.getView().fit(i,{padding:[50,50,50,50]})}))}getPolygonByBbox(e){return[[[e[0],e[1]],[e[2],e[1]],[e[2],e[3]],[e[0],e[3]],[e[0],e[1]]]]}addMapData(){this.feature=new o.Feature(new o.geom.Polygon([[[75,20],[75,40],[120,40],[120,20],[75,20]]]));let e=new o.source.Vector({features:[this.feature]});this.layer=new o.layer.Vector({source:e,style:new o.style.Style({stroke:new o.style.Stroke({color:"red",width:1}),fill:new o.style.Fill({color:"rgba(255, 0, 0, 0.2)"})})}),this.map.addLayer(this.layer)}activate(){this.viewer.container.onmouseenter=e=>{this.activateContainer="viewer"},this.map.getViewport().onmouseenter=e=>{this.activateContainer="map"}}deactivate(){this.viewer.container.onmouseenter=void 0,this.map.getViewport().onmouseenter=void 0,this.activateContainer="",this.map.removeLayer(this.layer)}destroy(){this.deactivate()}};let re={OverviewMap:oe,PositionInfoStatusBar:class{constructor(e){this.viewer=e,this.createDom(),this.initEvent()}createDom(){this.container=document.createElement("div"),this.container.className="position-info-status-bar",this.viewer.cesiumWidget.container.appendChild(this.container),this.divLng=document.createElement("div"),this.container.appendChild(this.divLng),this.divLat=document.createElement("div"),this.container.appendChild(this.divLat),this.divH=document.createElement("div"),this.container.appendChild(this.divH),this.divHeading=document.createElement("div"),this.container.appendChild(this.divHeading),this.divPitch=document.createElement("div"),this.container.appendChild(this.divPitch),this.divcH=document.createElement("div"),this.container.appendChild(this.divcH)}initEvent(){this.eventHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.eventHandler.setInputAction((e=>{let t=this.viewer.scene.pickPosition(e.startPosition);t||(t=this.viewer.scene.camera.pickEllipsoid(e.startPosition,this.viewer.scene.globe.ellipsoid)),t&&this.handleMouseMoveEvent(t)}),Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.viewer.scene.camera.moveEnd.addEventListener(this.handleCameraMoveEvent,this)}handleMouseMoveEvent(e){let t=this.catesian3ToDegrees(e);this.divLng.innerHTML="经度："+t.x.toFixed(6),this.divLat.innerHTML="纬度："+t.y.toFixed(6),this.divH.innerHTML="高度："+t.z.toFixed(6)}handleCameraMoveEvent(){this.divHeading.innerHTML="方向："+Cesium.Math.toDegrees(this.viewer.scene.camera.heading).toFixed(0)+"度",this.divPitch.innerHTML="俯仰角："+Cesium.Math.toDegrees(this.viewer.scene.camera.pitch).toFixed(0)+"度";let e=this.catesian3ToDegrees(this.viewer.scene.camera.position);this.divcH.innerHTML="视高："+e.z.toFixed(6)+"米"}catesian3ToDegrees(e){const t=Cesium.Cartographic.fromCartesian(e);return{x:Cesium.Math.toDegrees(t.longitude),y:Cesium.Math.toDegrees(t.latitude),z:t.height}}show(){this.container.style.display="block"}hide(){this.container.style.display="none"}remove(){this.eventHandler.destroy(),this.viewer.scene.camera.moveEnd.removeEventListener(this.handleCameraMoveEvent,this),this.container.remove()}},SceneTooltip:class{constructor(e){this.viewer=e,this.initEvent()}initEvent(){this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas).setInputAction((e=>{let t=this.viewer.scene.pick(e.endPosition);if(!t||!t.id)return void this.hide();if(!t.id.tooltip)return;let i=this.viewer.scene.pickPosition(e.endPosition);i||(i=this.viewer.scene.camera.pickEllipsoid(e.endPosition,this.viewer.scene.globe.ellipsoid)),i&&this.show(t.id.tooltip,i)}),Cesium.ScreenSpaceEventType.MOUSE_MOVE)}initDom(){this.$htmlContainer=document.createElement("div"),this.$htmlContainer.classList.add("tooltip-container"),this.viewer.cesiumWidget.container.appendChild(this.$htmlContainer)}show(e,t){this.$htmlContainer||this.initDom(),this.$htmlContainer.style.display="block",this.$htmlContainer.innerHTML=e,this.setPosition(t)}setPosition(e){const t=this.viewer.scene.canvas.height,i=new Cesium.Cartesian2;Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,e,i),this.$htmlContainer.style.bottom=t-i.y+20+"px";const n=this.$htmlContainer.offsetWidth;this.$htmlContainer.style.left=i.x-n/2+"px"}hide(){this.$htmlContainer&&(this.$htmlContainer.style.display="none")}remove(){this.handler.destroy(),this.$htmlContainer.remove()}},ViewerLink:class{constructor(e,t){this.viewer1=e,this.viewer2=t,this.focusIndex=0}activate(){this.cancelSync(),this.isSync=!0,this.startSync()}deactivate(){this.isSync=!1,this.cancelSync()}startSync(){this.viewer1.scene.postRender.addEventListener(this.syncVEventHandle,this);let e=this;this.viewer1.container.onmouseenter=t=>{e.focusIndex=0},e.viewer2.container.onmouseenter=t=>{e.focusIndex=1}}cancelSync(){this.viewer1.container.onmouseenter=void 0,this.viewer2.container.onmouseenter=void 0,this.viewer1.scene.postRender.removeEventListener(this.syncVEventHandle,this)}syncVEventHandle(){this.isSync&&(0==this.focusIndex?this.syncV2ToV1():this.syncV1ToV2())}syncV2ToV1(){this.viewer2.camera.setView({destination:this.viewer1.camera.position,orientation:{direction:this.viewer1.camera._direction,up:this.viewer1.camera.up,heading:this.viewer1.camera.heading,pitch:this.viewer1.camera.pitch,roll:this.viewer1.camera.roll}})}syncV1ToV2(){this.viewer1.camera.setView({destination:this.viewer2.camera.position,orientation:{direction:this.viewer2.camera._direction,up:this.viewer2.camera.up,heading:this.viewer2.camera.heading,pitch:this.viewer2.camera.pitch,roll:this.viewer2.camera.roll}})}},ImageLayerSplit:class{constructor(e,t,i){this.viewer=e,this.splitLayer=e.imageryLayers.addImageryProvider(t),this.splitLayer.splitDirection=i,this.initSlider()}initSlider(){let e,t=document.getElementById("cesium-image-layer-split");t?e=t:(e=document.createElement("div"),e.id="cesium-image-layer-split",e.classList.add("cesium-image-layer-split"),e.style.cssText="\n            position: absolute;\n            left: 50%;\n            top: 0px;\n            background-color: #d3d3d3;\n            width: 5px;\n            height: 100%;\n            z-index: 9999;",this.viewer.cesiumWidget.container.appendChild(e)),this.registEvent(e),this.viewer.scene.imagerySplitPosition=e.offsetLeft/e.parentElement.offsetWidth}registEvent(e){let t=new n.ScreenSpaceEventHandler(e),i=!1;t.setInputAction((()=>{i=!0}),n.ScreenSpaceEventType.LEFT_DOWN),t.setInputAction((t=>{if(!i)return;let n=(e.offsetLeft+t.endPosition.x)/e.parentElement.offsetWidth;e.style.left=100*n+"%",this.viewer.scene.imagerySplitPosition=n}),n.ScreenSpaceEventType.MOUSE_MOVE),t.setInputAction((()=>{i=!1}),n.ScreenSpaceEventType.LEFT_UP),this.handler=t,this.slider=e}removeSplitLayer(){this.viewer.imageryLayers.remove(this.splitLayer),this.splitLayer=void 0,this.slider&&this.slider.remove(),this.handler&&this.handler.destroy()}destroy(){this.removeSplitLayer()}remove(){this.removeSplitLayer()}}};var ae=re;i(1572),function(){const e=n.BoxGeometry,t=n.Cartesian3,i=n.defaultValue,o=n.defined,r=n.destroyObject,a=n.DeveloperError,s=n.GeometryPipeline,l=n.Matrix3,c=n.Matrix4,d=n.Transforms,h=n.VertexFormat,u=n.BufferUsage,p=n.CubeMap,m=n.DrawCommand,g=n.loadCubeMap,v=n.RenderState,f=n.VertexArray,y=n.BlendingState,w=n.SceneMode,C=n.ShaderProgram,b=n.ShaderSource;function E(e){this.sources=e.sources,this._sources=void 0,this.show=i(e.show,!0),this._command=new m({modelMatrix:c.clone(c.IDENTITY),owner:this}),this._cubeMap=void 0,this._attributeLocations=void 0,this._useHdr=void 0}n.defined(n.Matrix4.getRotation)||(n.Matrix4.getRotation=n.Matrix4.getMatrix3);const T=new l;E.prototype.update=function(i,n){const r=this;if(!this.show)return;if(i.mode!==w.SCENE3D&&i.mode!==w.MORPHING)return;if(!i.passes.render)return;const l=i.context;if(this._sources!==this.sources){this._sources=this.sources;const e=this.sources;if(!(o(e.positiveX)&&o(e.negativeX)&&o(e.positiveY)&&o(e.negativeY)&&o(e.positiveZ)&&o(e.negativeZ)))throw new a("this.sources is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");if(typeof e.positiveX!=typeof e.negativeX||typeof e.positiveX!=typeof e.positiveY||typeof e.positiveX!=typeof e.negativeY||typeof e.positiveX!=typeof e.positiveZ||typeof e.positiveX!=typeof e.negativeZ)throw new a("this.sources properties must all be the same type.");"string"==typeof e.positiveX?g(l,this._sources).then((function(e){r._cubeMap=r._cubeMap&&r._cubeMap.destroy(),r._cubeMap=e})):(this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),this._cubeMap=new p({context:l,source:e}))}const m=this._command;if(m.modelMatrix=d.eastNorthUpToFixedFrame(i.camera._positionWC),!o(m.vertexArray)){m.uniformMap={u_cubeMap:function(){return r._cubeMap},u_rotateMatrix:function(){return c.getRotation(m.modelMatrix,T)}};const i=e.createGeometry(e.fromDimensions({dimensions:new t(2,2,2),vertexFormat:h.POSITION_ONLY})),n=this._attributeLocations=s.createAttributeLocations(i);m.vertexArray=f.fromGeometry({context:l,geometry:i,attributeLocations:n,bufferUsage:u._DRAW}),m.renderState=v.fromCache({blending:y.ALPHA_BLEND})}if(!o(m.shaderProgram)||this._useHdr!==n){const e=new b({defines:[n?"HDR":""],sources:["uniform samplerCube u_cubeMap;\n    varying vec3 v_texCoord;\n    void main()\n    {\n    vec4 color = textureCube(u_cubeMap, normalize(v_texCoord));\n    gl_FragColor = vec4(czm_gammaCorrect(color).rgb, czm_morphTime);\n    }\n    "]});m.shaderProgram=C.fromCache({context:l,vertexShaderSource:"attribute vec3 position;\n    varying vec3 v_texCoord;\n    uniform mat3 u_rotateMatrix;\n    void main()\n    {\n    vec3 p = czm_viewRotation * u_rotateMatrix * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\n    gl_Position = czm_projection * vec4(p, 1.0);\n    v_texCoord = position.xyz;\n    }\n    ",fragmentShaderSource:e,attributeLocations:this._attributeLocations}),this._useHdr=n}return o(this._cubeMap)?m:void 0},E.prototype.isDestroyed=function(){return!1},E.prototype.destroy=function(){const e=this._command;return e.vertexArray=e.vertexArray&&e.vertexArray.destroy(),e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy(),this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),r(this)},n.GroundSkyBox=E}();let se={ExportFile:class{constructor(e){this.viewer=e}exportImage(){let e=this.viewer.scene.canvas.toDataURL("image/png").replace("image/png","image/octet-stream"),t=document.createElement("a"),i=this.dataURLtoBlob(e),n=URL.createObjectURL(i);t.download="scene.png",t.href=n,t.click()}dataURLtoBlob(e){let t=e.split(","),i=t[0].match(/:(.*?);/)[1],n=atob(t[1]),o=n.length,r=new Uint8Array(o);for(;o--;)r[o]=n.charCodeAt(o);return new Blob([r],{type:i})}exportSmallImage(){let e=this.viewer.scene.canvas,t=new Image;t.src=e.toDataURL("image/png");let i=this;t.onload=function(){let e=i.imageToCanvas(t).toDataURL("image/jpeg"),n=document.createElement("a"),o=new MouseEvent("click");n.download="scene.png",n.href=e,n.dispatchEvent(o)}}imageToCanvas(e){let t=document.createElement("canvas");return t.width=e.width/3,t.height=e.height/3,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t}},MouseDownView:class{constructor(e){this.viewer=e,this.init()}init(){this.createDom(),this.addEvent()}createDom(){let e=document.createElement("div");e.classList.add("scene3d-mousedownview");let t=document.createElement("div");t.classList.add("scene3d-mousedownview-img"),e.appendChild(t),this.$container=e,this.viewer.cesiumWidget.container.append(e)}addEvent(){this.viewer.scene.postRender.addEventListener(this.postRenderEvent,this);let e=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas);e.setInputAction((e=>{if(1==this.midDown)return;let t=e.endPosition;this.$container.style.top=t.y+"px",this.$container.style.left=t.x+"px",this.$container.classList.remove("scene3d-mousedownview-show")}),Cesium.ScreenSpaceEventType.MOUSE_MOVE),e.setInputAction(((e,t)=>{this.$container.classList.add("scene3d-mousedownview-show")}),Cesium.ScreenSpaceEventType.WHEEL),e.setInputAction((e=>{this.$container.classList.add("scene3d-mousedownview-show"),this.midDown=!0;let t=e.position;this.$container.style.top=t.y+"px",this.$container.style.left=t.x+"px"}),Cesium.ScreenSpaceEventType.MIDDLE_DOWN),e.setInputAction((e=>{this.$container.classList.remove("scene3d-mousedownview-show"),this.midDown=!1}),Cesium.ScreenSpaceEventType.MIDDLE_UP),this.viewer.camera.moveEnd.addEventListener(this.cameraMoveEndHanle,this),this.handler=e}cameraMoveEndHanle(){this.$container.classList.remove("scene3d-mousedownview-show")}remove(){this.viewer.camera.moveEnd.addEventListener(this.cameraMoveEndHanle),this.$container.remove(),this.handler.destroy()}},UnderGround:class{constructor(e){this.viewer=e}setAlpha(e){this.viewer.scene.globe.translucency.frontFaceAlpha=e}activate(){this.viewer.scene.screenSpaceCameraController.enableCollisionDetection=!1,this.viewer.scene.globe.translucency.enabled=!0,this.viewer.scene.globe.translucency.frontFaceAlpha=.8}deactivate(){this.viewer.scene.screenSpaceCameraController.enableCollisionDetection=!0,this.viewer.scene.globe.translucency.enabled=!1}},CustomBgImage:ne,WeatherEffect:class{constructor(e){this.viewer=e}addSnowEffect(){this.removeEffect(),this.wfStage=new Cesium.PostProcessStage({fragmentShader:this.getSnow_fs()}),this.viewer.scene.postProcessStages.add(this.wfStage)}addRainEffect(){this.removeEffect(),this.wfStage=new Cesium.PostProcessStage({fragmentShader:this.getRain_fs()}),this.viewer.scene.postProcessStages.add(this.wfStage)}addFogEffect(){this.removeEffect(),this.wfStage=new Cesium.PostProcessStage({fragmentShader:this.getFog_fs()}),this.viewer.scene.postProcessStages.add(this.wfStage)}removeEffect(){this.wfStage&&(this.viewer.scene.postProcessStages.remove(this.wfStage),this.wfStage=void 0)}getSnow_fs(){return"uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\nfloat snow(vec2 uv,float scale)\n{\n    float time = czm_frameNumber / 60.0;\n    float w=smoothstep(1.,0.,-uv.y*(scale/10.));if(w<.1)return 0.;\n    uv+=time/scale;uv.y+=time*2./scale;uv.x+=sin(uv.y+time*.5)/scale;\n    uv*=scale;vec2 s=floor(uv),f=fract(uv),p;float k=3.,d;\n    p=.5+.35*sin(11.*fract(sin((s+p+scale)*mat2(7,3,6,5))*5.))-f;d=length(p);k=min(d,k);\n    k=smoothstep(0.,k,sin(f.x+f.y)*0.01);\n    return k*w;\n}\nvoid main(void){\n     vec2 resolution = czm_viewport.zw;\n     vec2 uv=(gl_FragCoord.xy*2.-resolution.xy)/min(resolution.x,resolution.y);\n     vec3 finalColor=vec3(0);\n     float c = 0.0;\n     c+=snow(uv,30.)*.0;\n     c+=snow(uv,20.)*.0;\n     c+=snow(uv,15.)*.0;\n     c+=snow(uv,10.);\n     c+=snow(uv,8.);\n     c+=snow(uv,6.);\n     c+=snow(uv,5.);\n     finalColor=(vec3(c));\n     gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), vec4(finalColor,1), 0.5);\n}"}getRain_fs(){return"uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\n\tfloat hash(float x){\n\t     return fract(sin(x*133.3)*13.13);\n\t }\n\tvoid main(void){\n\t     float time = czm_frameNumber / 600.0;\n\t     vec2 resolution = czm_viewport.zw; \n\t     vec2 uv=(gl_FragCoord.xy*2.-resolution.xy)/min(resolution.x,resolution.y);\n\t     vec3 c=vec3(.6,.7,.8); \n\t     float a=-.4;\n\t     float si=sin(a),co=cos(a);\n\t     uv*=mat2(co,-si,si,co);\n\t     uv*=length(uv+vec2(0,4.9))*.3+1.;\n\t     float v=1.-sin(hash(floor(uv.x*100.))*2.);\n\t     float b=clamp(abs(sin(20.*time*v+uv.y*(5./(2.+v))))-.95,0.,1.)*20.;\n\t     c*=v*b; \n\t     gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), vec4(c,1), 0.5); \n\t}"}getFog_fs(){return"uniform sampler2D colorTexture;\n  uniform sampler2D depthTexture;\n  varying vec2 v_textureCoordinates;\n  void main(void)\n  {\n      vec4 origcolor=texture2D(colorTexture, v_textureCoordinates);\n      vec4 fogcolor=vec4(0.8,0.8,0.8,0.5);\n      float depth = czm_readDepth(depthTexture, v_textureCoordinates);\n      vec4 depthcolor=texture2D(depthTexture, v_textureCoordinates);\n      float f=(depthcolor.r-0.7)/0.2;\n      if(f<0.0) f=0.0;\n      else if(f>1.0) f=1.0;\n      gl_FragColor = mix(origcolor,fogcolor,f);\n   }"}},DynamicCloud:class{constructor(e,t){this.viewer=e,this.options=t,this.addCloudEntity()}addCloudEntity(){this.cloudEntity=this.viewer.entities.add({rectangle:{coordinates:Cesium.Rectangle.fromDegrees(-180,-90,180,90),material:new Cesium.CloudMaterialProperty({color:Cesium.Color.WHITE.withAlpha(.8),duration:this.options.duration||1e5,imgUrl:this.options.imgUrl}),height:this.options.height||8e3,distanceDisplayCondition:new Cesium.DistanceDisplayCondition(3e6,1e8)}})}remove(){this.viewer.entities.remove(this.cloudEntity)}},DivMask:class{constructor(e,t){this.viewer=e,this.style=t||{},this.container=document.createElement("div"),this.container.classList.add("div-mask"),this.viewer.cesiumWidget.container.appendChild(this.container),this.style.color&&(this.container.style.boxShadow="inset 1px 0px 500px 170px "+this.style.color,this.container.style.zIndex=this.style.zIndex||999)}remove(){this.viewer.cesiumWidget.container.removeChild(this.container)}},GroundSkyBox:n.GroundSkyBox,SkyBoxOnGround:class{constructor(e){this.viewer=e,this.farSkyBox=null,this.groundSkyBox=null,this.groundSkyBoxs=[],this.initSkyBox(),this.viewer.scene.postRender.addEventListener((()=>{let e=this.viewer.camera.position;n.Cartographic.fromCartesian(e).height<2500&&this.groundSkyBox?this.viewer.scene.skyBox=this.groundSkyBox:this.farSkyBox&&(this.viewer.scene.skyBox=this.farSkyBox)}))}changeSkyBox(e){this.viewer.scene.camera.flyTo({destination:new n.Cartesian3(-1573556.399109955,5327839.961767385,3123210.094581469),orientation:{heading:2.8892116353659993,pitch:-.1270872675001098,roll:.000723327810702834}}),this.groundSkyBox=this.groundSkyBoxs[e],this.viewer.scene.skyBox=this.groundSkyBox}initSkyBox(){this.farSkyBox=new n.SkyBox({sources:{positiveX:i(2634),positiveY:i(5009),positiveZ:i(630),negativeX:i(8473),negativeY:i(5378),negativeZ:i(2084)}}),this.groundSkyBoxs=[];let e=new n.GroundSkyBox({sources:{positiveX:i(3324),positiveY:i(6288),positiveZ:i(2954),negativeX:i(6613),negativeY:i(8598),negativeZ:i(9729)}});this.groundSkyBoxs.push(e);let t=new n.GroundSkyBox({sources:{positiveX:i(632),positiveY:i(8041),positiveZ:i(323),negativeX:i(1185),negativeY:i(6029),negativeZ:i(138)}});this.groundSkyBoxs.push(t);let o=new n.GroundSkyBox({sources:{positiveX:i(4575),positiveY:i(1234),positiveZ:i(7284),negativeX:i(4121),negativeY:i(7299),negativeZ:i(291)}});this.groundSkyBoxs.push(o),this.groundSkyBox=e}flyToHome(){this.viewer.scene.camera.flyTo({destination:new n.Cartesian3(-45802988.9566341,-41512897.1313383,42860387.48041018),orientation:{heading:1.2536256744910776,pitch:-1.49857771791951,roll:.03727351623405806}})}destroy(){this.viewer.entities.removeAll(),this.viewer.imageryLayers.removeAll(!0),this.viewer.destroy()}}},le={Camera:G,CameraDominate:j,CustomBgImage:ne,WeatherEffect:Y,GlobalRotation:ie,SceneControl:ae,SceneDominate:se,getTerrainMostDetailedHeight(e,t){let i=B().terrainProvider._scheme?B().terrainProvider:n.createWorldTerrain(),o=n.sampleTerrainMostDetailed(i,[e]);return o.then((function(e){"function"==typeof t&&t(e[0])})),o},async getTerrainMostDetailedHeightArea(e,t){let i=B().terrainProvider._scheme?B().terrainProvider:n.createWorldTerrain(),o=[];for(let t=1;t<23;t++)o.push(n.sampleTerrain(i,t,[n.Cartographic.fromDegrees(e.longitude,e.latitude,e.height)]));let r=(await Promise.all(o)).filter((e=>e.length>0)).map((e=>e[0].height)).filter((e=>void 0!==e)).pop()||0;return"function"==typeof t&&t(r),r},viewerFlyToLonLat(e,t,i=2e5){B().camera.flyTo({destination:n.Cartesian3.fromDegrees(e,t,i)})},fullScreen(){n.Fullscreen.requestFullscreen(document.body)},globalView(){B().camera.flyHome(1)},trueNorth(){let e=B(),t=n.Cartographic.fromCartesian(e.camera.position,n.Ellipsoid.WGS84,new n.Cartographic),i=e.scene.pickPosition(new n.Cartesian2(e.canvas.clientWidth/2,e.canvas.clientHeight/2)),o=n.Cartographic.fromCartesian(i,n.Ellipsoid.WGS84,new n.Cartographic);o.height=t.height;let r=n.Cartographic.toCartesian(o,n.Ellipsoid.WGS84,new n.Cartesian3);e.camera.setView({destination:r,orientation:{heading:n.Math.toRadians(0),pitch:e.camera.pitch,roll:e.camera.roll}})},verticalView(){let e=B(),t=n.Cartographic.fromCartesian(e.camera.position,n.Ellipsoid.WGS84,new n.Cartographic),i=e.scene.pickPosition(new n.Cartesian2(e.canvas.clientWidth/2,e.canvas.clientHeight/2)),o=n.Cartographic.fromCartesian(i,n.Ellipsoid.WGS84,new n.Cartographic);o.height=t.height;let r=n.Cartographic.toCartesian(o,n.Ellipsoid.WGS84,new n.Cartesian3);e.camera.setView({destination:r,orientation:{heading:e.camera.heading,pitch:n.Math.toRadians(-90),roll:e.camera.roll}})},lockVerticalView(){let e=B();!0===e.scene.screenSpaceCameraController.enableTilt?(this.verticalView(),e.scene.screenSpaceCameraController.enableTilt=!1):e.scene.screenSpaceCameraController.enableTilt=!0},doubleViewer(){},shutterView(){},viewPointManage(){},flyView(){},viewShed(){},openPDF(){window.open("_blank").location.href="用户手册.pdf"},viewerCapture(e){"jpg"===e&&function(e="",t="导出图片",i){let n=document.getElementById(e);const o=window.devicePixelRatio;l(n,{scale:o,useCORS:!0,allowTaint:!1}).then((e=>{let n=e.toDataURL("image/jpeg"),o=document.createElement("a");o.download=t,o.href=n,o.click(),"function"==typeof i&&i()}))}("MapContainer");let t=B().scene.canvas.toDataURL("image/png"),i=atob(t.split(",")[1]),n=i.length,o=new Uint8Array(n);for(let e=0;e<n;e++)o[e]=i.charCodeAt(e);let r=document.createElement("a");r.download="scene.png",r.href=URL.createObjectURL(new Blob([o])),r.click()},runFunByName(e){"fullScreen"===e?this.fullScreen():"trueNorth"===e?this.trueNorth():"verticalView"===e?this.verticalView():"lockVerticalView"===e?this.lockVerticalView():"doubleViewer"===e?this.doubleViewer():"shutterView"===e?this.shutterView():"viewPointManage"===e?this.viewPointManage():"surroundBrowse"===e||("flyView"===e?this.flyView():"viewShed"===e?this.viewShed():"surfaceTransparent"===e||("openPDF"===e?this.openPDF():"viewerCapture"===e?this.viewerCapture(""):"resetMap"===e||console.log("未识别的操作")))}};var ce=le,de=function(e,t){!e&&(e=B());let i=e.scene.canvas,o=e.scene.globe.ellipsoid,r=new n.ScreenSpaceEventHandler(i),a=0,s=0,l=0,c=0,d=!0,h=!0;r.setInputAction((function(i){let r=e.camera.pickEllipsoid(i.endPosition,o);if(r){let t=e.scene.globe.ellipsoid.cartesianToCartographic(r);a=n.Math.toDegrees(t.longitude),s=n.Math.toDegrees(t.latitude),d=!0}else d=!1;e.terrainProvider instanceof n.EllipsoidTerrainProvider||h&&(h=!1,ce.getTerrainMostDetailedHeight(n.Cartographic.fromDegrees(a,s),(function(e){h=!0,l=e.height}))),c=ce.Camera.getCameraHeight(e)||3e6,d&&"function"==typeof t&&t(a,s,l,c)}),n.ScreenSpaceEventType.MOUSE_MOVE),r.setInputAction((function(){c=ce.Camera.getCameraHeight(e)||3e6,d&&"function"==typeof t&&t(a,s,l,c)}),n.ScreenSpaceEventType.WHEEL)},he=function(){return new o.Map({target:"ol-container",layers:[new o.layer.Tile({source:new o.source.XYZ({url:"https://t5.tianditu.gov.cn/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=1814d83db8edd8e5b799a0d2128a9685"})}),new o.layer.Tile({source:new o.source.XYZ({url:"https://webst02.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scale=1&style=8"})})],view:new o.View({center:[108.41,34],zoom:4,projection:"EPSG:4326"}),controls:o.control.defaults({zoom:!1})})};class ue{constructor(e,t){this.viewer=e,this.map=t,this.activateContainer=void 0,this.initEvent(),this.activate()}initEvent(){this.map.updateSize(),this.map.getView().on("change:center",(e=>{"map"==this.activateContainer&&this.scene2map()})),this.viewer.scene.postRender.addEventListener((e=>{"viewer"==this.activateContainer&&this.map2scene()}))}activate(){this.viewer.container.onmouseenter=e=>{this.activateContainer="viewer"},this.map.getViewport().onmouseenter=e=>{this.activateContainer="map"}}deactivate(){this.viewer.container.onmouseenter=void 0,this.map.getViewport().onmouseenter=void 0,this.activateContainer=void 0}map2scene(){let e=this.viewer.camera.computeViewRectangle();if(!e)return console.log("rec is undefined"),void this.setMapCenterByCameraPosition();let t=[n.Math.toDegrees(e.west),n.Math.toDegrees(e.south),n.Math.toDegrees(e.east),n.Math.toDegrees(e.north)];if(o.extent.isEmpty(t))return console.log("extent is empty"),void this.setMapCenterByCameraPosition();this.map.getView().fit(t)}scene2map(){let e=this.map.getView().calculateExtent(this.map.getSize());this.viewer.camera.setView({destination:n.Rectangle.fromDegrees(e[0],e[1],e[2],e[3])})}setMapCenterByCameraPosition(){let e=this.viewer.camera.position;const t=n.Cartographic.fromCartesian(e),i=n.Math.toDegrees(t.longitude),o=n.Math.toDegrees(t.latitude);this.map.getView().setCenter([i,o])}}var pe=class{constructor(e,t){this.viewer=e||B(),this.dataSourceToo=t||new n.CustomDataSource}createPoint(e){let t=new n.Entity({position:e,point:{color:n.Color.CORNSILK,pixelSize:8,heightReference:n.HeightReference.NONE,disableDepthTestDistance:1e5}});return this.dataSourceToo.entities.add(t)}PolyLinePrimitive(e){return this.dataSourceToo.entities.add({polyline:{positions:new n.CallbackProperty((function(){return e}),!1),clampToGround:!0,material:new n.PolylineOutlineMaterialProperty({color:n.Color.CHARTREUSE}),width:2}})}PointLabelEntity(e,t){return this.dataSourceToo.entities.add({name:t,position:e,point:{pixelSize:5,color:n.Color.RED,outlineColor:n.Color.WHITE,outlineWidth:2,heightReference:n.HeightReference.NONE},label:{showBackground:!0,horizontalOrigin:n.HorizontalOrigin.LEFT,verticalOrigin:n.VerticalOrigin.BOTTOM,text:t,font:"18px sans-serif",fillColor:n.Color.GOLD,outlineWidth:2,disableDepthTestDistance:1e4}})}lineLabelEntity(e,t){return this.dataSourceToo.entities.add({polyline:{show:!0,positions:e,material:new n.PolylineOutlineMaterialProperty({color:n.Color.RED}),depthFailMaterial:new n.PolylineOutlineMaterialProperty({color:n.Color.RED}),width:2},label:{text:t,font:"14pt monospace",fillColor:n.Color.RED,backgroundColor:n.Color.RED,style:n.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,heightReference:n.HeightReference.NONE,verticalOrigin:n.VerticalOrigin.TOP,pixelOffset:new n.Cartesian2(40,-40)}})}spaceDistanceLabel(e,t){let i=this,o=i.viewer,r=new n.Cartesian3;r.x=(e.x+t.x)/2,r.y=(e.y+t.y)/2,r.z=(e.z+t.z)/2;let a=n.Cartographic.fromCartesian(r,n.Ellipsoid.WGS84,new n.Cartographic),s=n.Cartographic.fromCartesian(e,n.Ellipsoid.WGS84,new n.Cartographic),l=n.Cartographic.fromCartesian(t,n.Ellipsoid.WGS84,new n.Cartographic),c=new n.EllipsoidGeodesic;c.setEndPoints(s,l);let d=Number(c.surfaceDistance.toFixed(3)),h=d>1e3?(d/1e3).toFixed(3)+"km":d+"m";o.scene.sampleHeightMostDetailed([a]).then((function(e){e[0].height||(e[0].height=0),i.dataSourceToo.entities.add({position:n.Cartographic.toCartesian(e[0],n.Ellipsoid.WGS84,new n.Cartesian3),label:{text:h,font:"21px SimSun",style:n.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,fillColor:n.Color.WHITE,disableDepthTestDistance:5e5}})}))}polygonCenterLabel(e,t="周长"){let i=r.center(e),o="";switch(t){case"周长":{let t=r.length(e,{units:"kilometers"});o=t<5?"周长："+(1e3*t).toFixed(3)+" m":"周长："+t.toFixed(3)+" km"}break;case"面积":{let t=r.area(e);o=t<2e5?"面积："+t.toFixed(3)+" m2":"面积："+(1e-6*t).toFixed(3)+" km2"}}this.dataSourceToo.entities.add({position:n.Cartesian3.fromDegrees(i.geometry.coordinates[0],i.geometry.coordinates[1]),label:{text:o,font:"21px SimSun",style:n.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,fillColor:n.Color.WHITE,disableDepthTestDistance:5e5}})}buildLabel(e,t){return new n.Entity({position:e,label:{text:t,font:"16pt monospace",color:n.Color.RED,backgroundColor:n.Color.RED,style:n.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,heightReference:n.HeightReference.NONE,verticalOrigin:n.VerticalOrigin.TOP,pixelOffset:new n.Cartesian2(30,-30)}})}buildLabelByDegrees(e,t,i={}){let o={position:n.Cartesian3.fromDegrees(e.longitude,e.latitude),label:{text:t,font:"12pt bold monospace",fillColor:n.Color.WHITE,outlineColor:n.Color.BLACK,outlineWidth:4,style:n.LabelStyle.FILL_AND_OUTLINE,horizontalOrigin:n.HorizontalOrigin.LEFT,verticalOrigin:n.VerticalOrigin.BOTTOM,disableDepthTestDistance:Number.POSITIVE_INFINITY,heightReference:n.HeightReference.RELATIVE_TO_GROUND}};for(const e in i)"id"===e?o[e]=i[e]:o.label[e]=i[e];return new n.Entity(o)}},me=function(e,t,i){let o=n.JulianDate.fromDate(new Date),a=r.length(t,{units:"meters"})/i;e.position=new n.CallbackProperty((function(e){let s=e.secondsOfDay-o.secondsOfDay;if(s<0)return;let l=i*(s%a),c=r.along(t,l,{units:"meters"}).geometry.coordinates;return n.Cartesian3.fromDegrees(c[0],c[1],400)}))},ge=class extends b{constructor(){super()}},ve=class{constructor(e,t){this.name=t,this.viewer=e,this.nodes=[],this.dataSourceToo=new n.CustomDataSource("工作区-实体集合"),this.viewer.dataSources.add(this.dataSourceToo),this.terrainMana=new class{constructor(e){this.viewer=e,this.sourcesItems=[]}addData(e){let t,i=this.viewer.scene,o=e.properties,r=o.url,a=o.queryParameters||{},s=o.scheme||"CesiumTerrainProvider";if("default"===r)t=n.createWorldTerrain(),i.terrainProvider=t;else{let e=new n.Resource({url:r,queryParameters:a});t="VRTheWorldTerrainProvider"===s?new n.VRTheWorldTerrainProvider({url:e,credit:"Terrain data courtesy VT M?K"}):new n.CesiumTerrainProvider({url:e,requestVertexNormals:!1,requestWaterMask:!1,credit:void 0}),i.terrainProvider=t}return!0}flyToByPid(e){}getByPid(e){}removeByPid(e){return this.removeAll()}removeAll(){return this.viewer.scene.terrainProvider=new n.EllipsoidTerrainProvider({}),!0}}(e),this.layerMana=new class{constructor(e){this.viewer=e,this.sourcesItems=[]}addData(e){let t=e.properties,i=t.url,n=null;switch(t.scheme){case"wms":case"layer-wmts":n=this.addWebMapTileServiceImageryProvider(i,e);break;case"layer-singleTileImagery":n=this.addSingleTileImagery(i,e);break;case"layer-xyz-3857":n=this.addImageryXYZ_3857_Provider(i,e);break;case"layer-xyz-4326":n=this.addImageryXYZ_4326_Provider(i,e);break;case"layer-arcgisMapServer":n=this.addArcGisMapServerImagery(i,e);break;case"layer-geoserver":n=this.addGeoserverWMS(i,e);break;default:return console.log("数据项，缺少图层类型标识符",t),!1}return this.sourcesItems.push(e),!0}getByPid(e){return this.sourcesItems.find((t=>t.pid===e))}flyToByPid(e){let t=this,i=this.getByPid(e),o=i?.param?.properties?.rectangle;if(i)if(o)this.viewer.camera.flyTo({destination:n.Rectangle.fromDegrees(o.west,o.south,o.east,o.north)});else{let i=t.viewer.imageryLayers._layers.find((t=>t.pid===e));i&&this.viewer.camera.flyTo({destination:i.rectangle})}}removeByPid(e){let t=this,i=!1,n=t.sourcesItems.find((t=>t.pid===e));return n?(t.sourcesItems.filter((t=>t!==e)),i=t.viewer.imageryLayers.remove(n),n.isDestroyed()||n.destroy(),i):i}removeAll(){return!1}addSingleTileImagery(e,t={}){return e=e||i(710),this.addImageryProvider(new n.SingleTileImageryProvider({url:e}),t)}addWebMapTileServiceImageryProvider(e,t){let i=t.properties.queryParameters||{},o=new n.Resource({url:e,queryParameters:i}),r=new n.WebMapTileServiceImageryProvider({layer:"",style:"",tileMatrixSetID:"",url:o,format:"image/jpeg"});return this.addImageryProvider(r,t)}addImageryXYZ_3857_Provider(e,t){let i=t.properties.queryParameters||{},o=new n.Resource({url:e,queryParameters:i}),r=new n.UrlTemplateImageryProvider({url:o,tilingScheme:new n.WebMercatorTilingScheme});return this.addImageryProvider(r,t)}addImageryXYZ_4326_Provider(e,t){let i=t.properties.queryParameters||{},o=new n.Resource({url:e,queryParameters:i}),r=new n.UrlTemplateImageryProvider({url:o,tilingScheme:new n.GeographicTilingScheme({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:1})});return this.addImageryProvider(r,t)}addArcGisMapServerImagery(e,t){let i=t.properties.queryParameters||{},o=new n.Resource({url:e,queryParameters:i}),r=new n.ArcGisMapServerImageryProvider({url:o,enablePickFeatures:!1});return this.addImageryProvider(r,t)}addGeoserverWMS(e,t){let i=t.properties.queryParameters||{},o=new n.Resource({url:e,queryParameters:i});const r=new n.WebMapServiceImageryProvider({url:o,layers:t.layers,parameters:{service:"WMS",format:"image/png",transparent:!0}});return this.addImageryProvider(r,t)}addImageryProvider(e,t){const i=this.viewer.imageryLayers.addImageryProvider(e);return i.pid=t.pid,i.param=t,t.properties.baseLayer&&this.viewer.imageryLayers.lowerToBottom(i),this.sourcesItems.unshift(i),i}}(e),this.gltfMana=new class{constructor(e){this.viewer=e,this.sourcesItems=[],this.dataSourceToo=new n.CustomDataSource("工作区 GLTF - 附加实体集合"),this.viewer.dataSources.add(this.dataSourceToo)}addData(e){let t=e.properties,i=t.url,o=t.queryParameters||{},a=t.scale||1;this.viewer.scene.globe.depthTestAgainstTerrain=!0;let s=new n.Resource({url:i,queryParameters:o}),l=n.Cartesian3.fromDegrees(t.position.longitude,t.position.latitude,t.position.height||0),c=n.Math.toRadians(135),d=new n.HeadingPitchRoll(c,0,0),h=n.Transforms.headingPitchRollQuaternion(l,d),u={id:e.pid,name:e.name,position:l,orientation:h,model:{uri:s,scale:a}};if(null===t.position.height&&(u.model.heightReference=n.HeightReference.CLAMP_TO_GROUND),t.DistanceDisplayCondition){let e=t.DistanceDisplayCondition.near,i=t.DistanceDisplayCondition.far;u.model.distanceDisplayCondition=new n.DistanceDisplayCondition(e,i)}t.minimumPixelSize&&(u.model.minimumPixelSize=t.minimumPixelSize);let p=this.dataSourceToo.entities.add(u);return t?.motion?.path&&t?.motion?.speed&&me(p,r.lineString(t.motion.path),t.motion.speed),this.sourcesItems.unshift(p),p}getByPid(e){return this.sourcesItems.find((t=>t.id===e))}flyToByPid(e){let t=this.sourcesItems.find((t=>t.id===e));this.viewer.flyTo(t,{offset:new n.HeadingPitchRange(0,-1.57,0)})}removeByPid(e){let t=this.viewer.dataSources.remove(this.getByPid(e));return this.sourcesItems=this.sourcesItems.filter((t=>t.id!==e)),this.dataSourceToo.entities.removeById(e),t}removeAll(){return this.sourcesItems.forEach((e=>{this.viewer.dataSources.remove(this.getByPid(e.pid))})),this.sourcesItems=[],!1}}(e),this.poiMana=new class{constructor(e){this.viewer=e,this.sourcesItems=[],this.dataSourceToo=new n.CustomDataSource("工作区 geoJson - 标注点"),this.viewer.dataSources.add(this.dataSourceToo)}addData(e){let t=e.pid,{longitude:i,latitude:o,height:r}=e.properties.position,a=e.properties.text_string,s=e.properties.image_path,l=this.dataSourceToo.entities.add({id:t,name:" mark",position:n.Cartesian3.fromDegrees(i,o),billboard:{show:!0,image:s,width:15,height:15,scaleByDistance:new n.NearFarScalar(150,2,15e6,.5),disableDepthTestDistance:Number.POSITIVE_INFINITY,heightReference:n.HeightReference.RELATIVE_TO_GROUND,verticalOrigin:n.VerticalOrigin.BOTTOM},label:{text:a,font:"12pt bold monospace",fillColor:n.Color.WHITE,outlineColor:n.Color.BLACK,outlineWidth:4,style:n.LabelStyle.FILL_AND_OUTLINE,horizontalOrigin:n.HorizontalOrigin.LEFT,verticalOrigin:n.VerticalOrigin.BOTTOM,pixelOffset:new n.Cartesian2(20,0),disableDepthTestDistance:Number.POSITIVE_INFINITY,heightReference:n.HeightReference.RELATIVE_TO_GROUND}});return this.sourcesItems.push(l),l}getByPid(e){return this.sourcesItems.find((t=>t.id===e))}flyToByPid(e){let t=this.sourcesItems.find((t=>t.id===e));this.viewer.flyTo(t,{offset:new n.HeadingPitchRange(0,-1.57,0)})}removeByPid(e){return this.sourcesItems=this.sourcesItems.filter((t=>t.id!==e)),this.dataSourceToo.entities.removeById(e),!0}removeAll(){return this.dataSourceToo.removeAll(),this.sourcesItems=[],!1}}(e),this._3DTileMana=new class{constructor(e){this.viewer=e,this.sourcesItems=[]}addData(e){let t=e.properties,i=t.url,o=t.queryParameters||{};this.viewer.scene.globe.depthTestAgainstTerrain=!0;let r=new n.Resource({url:i,queryParameters:o}),a=new n.Cesium3DTileset({url:r,show:!0,maximumScreenSpaceError:2,maximumMemoryUsage:4e3,cullWithChildrenBounds:!0,cullRequestsWhileMoving:!1,cullRequestsWhileMovingMultiplier:60,preloadWhenHidden:!0,preloadFlightDestinations:!0,preferLeaves:!0,dynamicScreenSpaceError:!0,dynamicScreenSpaceErrorDensity:.00278,dynamicScreenSpaceErrorFactor:8,dynamicScreenSpaceErrorHeightFalloff:.1,progressiveResolutionHeightFraction:.5,foveatedScreenSpaceError:!0,foveatedConeSize:.1,foveatedMinimumScreenSpaceErrorRelaxation:0,foveatedTimeDelay:.2,skipLevelOfDetail:!0,baseScreenSpaceError:1024,skipScreenSpaceErrorFactor:16,skipLevels:0,immediatelyLoadDesiredLevelOfDetail:!1,loadSiblings:!1,luminanceAtZenith:.2,backFaceCulling:!0,showOutline:!0,vectorClassificationOnly:!1,vectorKeepDecodedPositions:!0,debugFreezeFrame:!1,debugColorizeTiles:!1,debugWireframe:!1,debugShowBoundingVolume:!1,debugShowContentBoundingVolume:!1,debugShowViewerRequestVolume:!1,debugShowGeometricError:!1,debugShowRenderingStatistics:!1,debugShowMemoryUsage:!1,debugShowUrl:!1});return a.pid=e.pid,a.param=t,this.sourcesItems.unshift(a),a=this.viewer.scene.primitives.add(a),a.readyPromise.then((function(e){let i=t.offset;i&&function(e,t){if(t.longitude&&!isNaN(t.longitude)&&t.latitude&&!isNaN(t.latitude)&&t.height&&!isNaN(t.height)){let i=e.boundingSphere.center,o=n.Cartesian3.fromDegrees(t.longitude,t.latitude,t.height),r=n.Transforms.eastNorthUpToFixedFrame(i),a=n.Matrix4.getMatrix3(r,new n.Matrix3),s=n.Matrix3.inverse(a,new n.Matrix3),l=new n.Cartesian3(-i.x,-i.y,-i.z),c=n.Transforms.eastNorthUpToFixedFrame(o);c=n.Matrix4.multiplyByMatrix3(c,s,new n.Matrix4),c=n.Matrix4.multiplyByTranslation(c,l,new n.Matrix4),e.modelMatrix=c}if(!t.longitude&&!t.latitude&&t.height&&!isNaN(t.height)){let i=n.Cartographic.fromCartesian(e.boundingSphere.center),o=n.Cartesian3.fromRadians(i.longitude,i.latitude,t.height),r=e.boundingSphere.center,a=new n.Cartesian3;n.Cartesian3.subtract(o,r,a),e.modelMatrix=n.Matrix4.fromTranslation(a)}}(e,i)})),!0}flyToByPid(e){let t=this.sourcesItems.find((t=>t.pid===e));this.viewer.flyTo(t,{offset:new n.HeadingPitchRange(0,-1.57,0)})}getByPid(e){return this.sourcesItems.find((t=>t.pid===e))}removeByPid(e){let t=this.sourcesItems.find((t=>t.pid===e));return t&&!t.isDestroyed()&&t.destroy(),this.sourcesItems=this.sourcesItems.filter((t=>t.pid!==e)),this.viewer.scene.primitives.remove(t)}removeAll(){return this.sourcesItems.forEach((e=>{this.viewer.dataSources.remove(this.getByPid(e.pid))})),this.sourcesItems=[],!1}}(e),this.geoJsonMana=new class{constructor(e){this.viewer=e,this.sourcesItems=[],this.dataSourceToo=new n.CustomDataSource("工作区 geoJson - 附加实体集合"),this.entityFactory=new pe(e,this.dataSourceToo),this.viewer.dataSources.add(this.dataSourceToo)}addData(e){let t=this,i=e.properties,o=i.url,a=e.pid;return _.getJson(o,(o=>{if(i.label){let e=r.center(o).geometry.coordinates,s={id:a};i.label.pixelOffset&&(s.pixelOffset=new n.Cartesian2(i.label.pixelOffset.x,i.label.pixelOffset.y));let l=t.entityFactory.buildLabelByDegrees({longitude:e[0],latitude:e[1],height:0},i.label.text,s);this.dataSourceToo.entities.add(l)}let s=new n.GeoJsonDataSource;s.id=a,s.load(o,{clampToGround:!0}).then((function(t){s.name=e.pid,s.nikeName=e.name,t.entities.values.forEach((e=>{i.symbol.lineArrow&&e.polyline&&(e.polyline.material=new n.PolylineArrowMaterialProperty(n.Color.RED),e.polyline.width=15)}))})),s.name=e.pid,s.nikeName=e.name,t.sourcesItems.push(s),t.viewer.dataSources.add(s)})),!0}getByPid(e){return this.sourcesItems.find((t=>t.id===e))}flyToByPid(e){let t=this.sourcesItems.find((t=>t.id===e));this.viewer.flyTo(t,{offset:new n.HeadingPitchRange(0,-1.57,0)})}removeByPid(e){let t=this.viewer.dataSources.remove(this.getByPid(e));return this.sourcesItems=this.sourcesItems.filter((t=>t.id!==e)),this.dataSourceToo.entities.removeById(e),t}removeAll(){return this.sourcesItems.forEach((e=>{this.viewer.dataSources.remove(this.getByPid(e.pid))})),this.sourcesItems=[],!1}}(e),this.waterMana=new class{constructor(e){this.viewer=e,this.sourcesItems=[],this.options={color_r:0,color_g:62/255,color_b:75/255,color_a:1,water_freq:100,water_animationspeed:.01,water_amplitude:2},this.primitives=[],this.bboxPolygon=[]}addData(e){let t=this,i=e.properties,n=JSON.parse(JSON.stringify(i.waterOptions));return!n.color_r&&(n.color_r=t.options.color_r),!n.color_g&&(n.color_g=t.options.color_g),!n.color_b&&(n.color_b=t.options.color_b),!n.color_a&&(n.color_a=t.options.color_a),!n.water_freq&&(n.water_freq=t.options.water_freq),!n.water_animationspeed&&(n.water_animationspeed=t.options.water_animationspeed),!n.water_amplitude&&(n.water_amplitude=t.options.water_amplitude),n.geoJsonUrl,n.textureUrl,this.getByPid(e.pid)?(console.log("不允许重复添加"),!1):(t.sourcesItems.push(e),!0)}reLoad(){let e=JSON.parse(JSON.stringify(this.sourcesItems));this.removeAll(),e.forEach((e=>{this.addData(e)}))}flyToByPid(e){4===this.bboxPolygon.length&&this.viewer.camera.flyTo({destination:n.Rectangle.fromDegrees(...this.bboxPolygon)})}getByPid(e){return this.sourcesItems.find((t=>t.pid===e))}removeAll(){let e=this;return e.primitives.forEach((t=>e.viewer.scene.primitives.remove(t))),e.sourcesItems=[],!0}removeByPid(e){let t=this;return t.primitives.filter((t=>t.pid===e)).forEach((e=>t.viewer.scene.primitives.remove(e))),this.sourcesItems=this.sourcesItems.filter((t=>t.pid!==e)),!0}}(e),this.sourceEvent=new ge,this.listenSource()}listenSource(){let e=this;e.viewer.scene.globe.imageryLayersUpdatedEvent.addEventListener((function(){setTimeout((()=>{e.nodes.forEach((t=>{"layer"===t.dataType&&!e.viewer.imageryLayers._layers.find((e=>(e.param||{}).pid===t.pid))&&e.removeData(t)}))}),50)}))}addData(e){let t=this,i=null;if(!t.checkSourceItem(e))return console.log("该资源项不合法",e),i;if(e.pid||(e.pid=f()),e=JSON.parse(JSON.stringify(e)),this.nodes.find((t=>e.pid===t.pid)))return console.warn("工作区已加载该数据!不允许重复加载：",e.name),i;switch(console.log("%c"+t.name+"正在加载数据："+e.name,"color:green"),e.dataType){case"layer":i=t.layerMana.addData(e);break;case"dem":i=t.terrainMana.addData(e);break;case"gltf":i=t.gltfMana.addData(e);break;case"3DTiles":i=t._3DTileMana.addData(e);break;case"geoJson":i=t.geoJsonMana.addData(e);break;case"water":i=t.waterMana.addData(e);break;case"poi":i=t.poiMana.addData(e)}return this.nodes.push(e),t.sourceEvent.triggerEvent(C.DataEventType.addData,M.Viewer3D,e),i}removeData(e){let t=this,i=!1;if(e){switch(e.dataType){case"layer":i=t.layerMana.removeByPid(e.pid);break;case"dem":t.terrainMana.removeByPid(e.pid);break;case"3DTiles":i=t._3DTileMana.removeByPid(e.pid);break;case"geoJson":i=t.geoJsonMana.removeByPid(e.pid);break;case"water":i=t.waterMana.removeByPid(e.pid);break;case"gltf":i=t.gltfMana.removeByPid(e.pid);break;case"poi":i=t.poiMana.removeByPid(e.pid)}t.nodes=t.nodes.filter((t=>t.pid!==e.pid)),t.sourceEvent.triggerEvent(C.DataEventType.removeData,t.name,e)}}flyToData(e){let t=this;if(this.nodes.find((t=>e.pid===t.pid)))switch(e.dataType){case"layer":t.layerMana.flyToByPid(e.pid);break;case"dem":t.terrainMana.flyToByPid(e.pid);break;case"3DTiles":t._3DTileMana.flyToByPid(e.pid);break;case"geoJson":t.geoJsonMana.flyToByPid(e.pid);break;case"water":t.waterMana.flyToByPid(e.pid);break;case"gltf":t.gltfMana.flyToByPid(e.pid);break;case"poi":t.poiMana.flyToByPid(e.pid)}}checkSourceItem(e){let t=!0;return t=t&&!!e,t=t&&!!e.properties,t}getNameByPid(e){return(this.nodes.find((t=>e===t.pid))||{}).name}};const fe={getHandle:(e,t)=>({handler:new n.ScreenSpaceEventHandler(e.canvas),errCallback:t||function(){console.log("默认事件监听器，被重置！")}})};var ye=fe;let we={DeltaDegree:1e-5,DeltaRadian:1e-5*Math.PI/180,lat_to_meter:e=>e/1.57891e-7,lon_to_meter:(e,t)=>e/1.56785e-7*Math.cos(t),meter_to_lat:e=>1.57891e-7*e,meter_to_long:(e,t)=>1.56785e-7*e/Math.cos(t),pointProjectLine:function(e,t,i,n,o,r,a){if(Ce(i,n,o,r,1e-7))return a[0]=i,a[1]=n,0;if(Ce(i,n,e,t,1e-7)||Ce(o,r,e,t,1e-7))return a[0]=e,a[1]=t,0;let s=this.TwoPointsDistance(i,n,e,t),l=this.vecAngle(i,n,o,r),c=this.TwoPointsDistance(i,n,o,r),d=l-this.vecAngle(i,n,e,t),h=Math.cos(d)*s;return a[0]=i+Math.cos(l)*h,a[1]=n+Math.sin(l)*h,h<0?-1:h<=c?0:1},TwoPointsDistance:(e,t,i,n)=>Math.sqrt((e-i)*(e-i)+(t-n)*(t-n)),vecAngle:function(e,t,i,n){let o,r;return o=i-e,r=n-t,this.normalizeVecAngle(Math.atan2(r,o))},normalizeVecAngle:e=>e-~~(e/(2*Math.PI))*(2*Math.PI),polarPoint:function(e,t,i,n){let o=new Array(2);return o[0]=e+n*Math.cos(i),o[1]=t+n*Math.sin(i),o},polygonRefDot:function(e){let t=e.coordinates;"MultiPolygon"==e.type&&(t=e.coordinates[0]);let i=new Float64Array([9999,9999,-9999,-9999]);for(let e=0;e<t.length;e++){let n=t[e];for(let e=0;e<n.length;e++)n[e][0]<i[0]&&(i[0]=n[e][0]),n[e][0]>i[2]&&(i[2]=n[e][0]),n[e][1]<i[1]&&(i[1]=n[e][1]),n[e][1]>i[3]&&(i[3]=n[e][1])}if(i[2]-i[0]<1e-13||i[3]-i[1]<1e-13)return new Float64Array([(i[0]+i[2])/2,(i[1]+i[3])/2]);let n,o=(i[0]+i[2])/2,r=[];for(let e=0;e<t.length;e++){let i=t[e];for(let e=0;e<i.length-1;e++){if(i[e][0]<=i[e+1][0]){if(o<i[e][0]||o>=i[e+1][0])continue}else if(o<=i[e+1][0]||o>i[e][0])continue;n=i[e][1]+(i[e+1][1]-i[e][1])*(o-i[e][0])/(i[e+1][0]-i[e][0]),r.push(n)}}return r.sort(),n=(r[0]+r[1])/2,new Float64Array([o,n])},deltaAngle:function(e,t){return this.normalizeVecAngle(t-e)},InterpolateLineLonlat:function(e,t){if(!e||!t)return null;if(!(e.lon&&e.lat&&t.lon&&t.lat))return null;if(!(be(e.lon)&&be(t.lon)&&Ee(e.lat)&&Ee(t.lat)))return null;let i=[];i.push([e.lon,e.lat]);let n=Math.sqrt(Math.pow(t.lon-e.lon,2)+Math.pow(t.lat-e.lat,2));if(n<=this.DeltaDegree)return i.push([t.lon,t.lat]),i;{let o=n/this.DeltaDegree,r=(t.lon-e.lon)/o,a=(t.lat-e.lat)/o;for(let t=0;t<o;t++){let n=e.lon+(t+1)*r,o=e.lat+(t+1)*a;i.push([n,o])}}return i},InterpolateLineCartographic:function(e,t,i){if(!e||!t)return null;if(!(e.longitude&&e.latitude&&t.longitude&&t.latitude))return null;let o=[];o.push(new n.Cartographic(e.longitude,e.latitude));let r=Math.sqrt(Math.pow(t.longitude-e.longitude,2)+Math.pow(t.latitude-e.latitude,2)),a=i&&"number"==typeof i?i:this.DeltaRadian;if(r<=a)return o.push(new n.Cartographic(t.longitude,t.latitude)),o;{let i=r/a,s=(t.longitude-e.longitude)/i,l=(t.latitude-e.latitude)/i;for(let t=0;t<i;t++){let i=e.longitude+(t+1)*s,r=e.latitude+(t+1)*l;o.push(new n.Cartographic(i,r))}o.push(new n.Cartographic(t.longitude,t.latitude,t.height))}return o},InterpolateLineHeightCartographic:function(e,t){if(!e||!t)return null;if(!(e.longitude&&e.latitude&&t.longitude&&t.latitude))return null;let i=[];i.push(new n.Cartographic(e.longitude,e.latitude,e.height));let o=Math.sqrt(Math.pow(t.longitude-e.longitude,2)+Math.pow(t.latitude-e.latitude,2));if(o<=this.DeltaRadian)return i.push(new n.Cartographic(t.longitude,t.latitude,t.height)),i;{let r=o/this.DeltaRadian,a=(t.longitude-e.longitude)/r,s=(t.latitude-e.latitude)/r,l=(t.height-e.height)/r;for(let t=0;t<r;t++){let o=e.longitude+(t+1)*a,r=e.latitude+(t+1)*s,c=e.height+(t+1)*l;i.push(new n.Cartographic(o,r,c))}i.push(new n.Cartographic(t.longitude,t.latitude,t.height))}return i},interpolate2IndexLineHeightCartographic:function(e,t,i,o){if(!e||!t)return null;if(!(e.longitude&&e.latitude&&t.longitude&&t.latitude))return null;let r=[];r.push(new n.Cartographic(e.longitude,e.latitude,e.height));let a=(t.longitude-e.longitude)/i,s=(t.latitude-e.latitude)/i,l=(t.height-e.height)/i;for(let t=0;t<o;t++){let i=e.longitude+(t+1)*a,o=e.latitude+(t+1)*s,c=e.height+(t+1)*l;r.push(new n.Cartographic(i,o,c))}return r},interpolateIndexLineHeightCartographic:function(e,t,i,o){if(!e||!t)return null;if(!(e.longitude&&e.latitude&&t.longitude&&t.latitude))return null;let r=(t.longitude-e.longitude)/i,a=(t.latitude-e.latitude)/i,s=(t.height-e.height)/i,l=e.longitude+o*r,c=e.latitude+o*a,d=e.height+o*s;return new n.Cartographic(l,c,d)},lonLat2WebMercator:function(e,t,i){return i||(i=[]),i[0]=20037508.34*e/180,i[1]=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180),i[1]=20037508.34*i[1]/180,i},webMercator2LonLat:function(e,t,i){return i||(i=[]),i[0]=e/20037508.34*180,i[1]=t/20037508.34*180,i[1]=180/Math.PI*(2*Math.atan(Math.exp(i[1]*Math.PI/180))-Math.PI/2),i},lonLat2GaussKruger3:function(e,t){let i=Math.floor(e/3);return a("+proj=longlat +datum=WGS84 +no_defs ","+proj=tmerc +lat_0=0 +lon_0="+3*i+" +k=1 +x_0=500000 +y_0=0 +ellps=GRS80 +units=m +no_defs").forward([e,t])},computeLineNormal:function(e,t,i,o,r){let a=this.lon_to_meter(e,t),s=this.lat_to_meter(t),l=this.lon_to_meter(i,o),c=this.lat_to_meter(o),d=(a+l)/2,h=(s+c)/2,u=this.vecAngle(a,s,l,c)-Math.PI/2,p=this.polarPoint(d,h,u,1),m=this.meter_to_lat(h),g=this.meter_to_long(d,m),v=this.meter_to_lat(p[1]),f=this.meter_to_long(p[0],v),y=n.Cartesian3.fromDegrees(g,m,0),w=n.Cartesian3.fromDegrees(f,v,0),C=new n.Cartesian3(w.x-y.x,w.y-y.y,w.z-y.z);return n.Cartesian3.normalize(C,r)},degree2rad:function(e){return e*Math.PI/180},rad2degree:function(e){return 180*e/Math.PI},computeArea:function(e){let t=e.length;if(t<3)return 0;let i=e[0][1]*(e[t-1][0]-e[1][0]);for(let n=1;n<t;n++)i+=e[n][1]*(e[n-1][0]-e[(n+1)%t][0]);return Math.abs(i/2)},calculationDistance:function(e,t){let i=e.y,n=t.y,o=e.x,r=t.x;return Math.sqrt((r-o)*(r-o)+(n-i)*(n-i))},douglasPeucker:function(e,t,i){if(!(e&&e.length>2))return null;e.forEach(((e,t)=>{e.id=t}));let n=Me(e,[],0,e.length-1,t,i);n.push(e[0]),n.push(e[e.length-1]);let o=n.sort(((e,t)=>e.id<t.id?-1:e.id>t.id?1:0));return o.forEach((e=>{e.id=void 0})),o},guid:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+e()+e()+e()+e()+e()+e()},BLHConvertToXYZ:function(e,t){e=n.Cartesian3.fromDegreesArrayHeights(e),t=n.Cartesian3.fromDegrees(t[0],t[1],t[2]);let i=n.Transforms.eastNorthUpToFixedFrame(t),o=n.Matrix4.inverse(i,new n.Matrix4),r=new Float64Array(3*e.length);for(let t=0;t<e.length;t++){let i=n.Matrix4.multiplyByPoint(o,e[t],new n.Cartesian3);r[3*t+0]=i.x,r[3*t+1]=i.y,r[3*t+2]=i.z}return r},calculationIntersection:function(e,t,i){i[0]?i[1]=e[1]+(i[0]-e[0])*(t[1]-e[1])/(t[0]-e[0]):i[0]=e[0]+(t[0]-e[0])*(i[1]-e[1])/(t[1]-e[1])},calculateTriangle:function(e){let t={x:e[0].x-e[1].x,y:e[0].y-e[1].y,z:e[0].z-e[1].z},i={x:e[1].x-e[2].x,y:e[1].y-e[2].y,z:e[1].z-e[2].z},o={x:e[0].x-e[2].x,y:e[0].y-e[2].y,z:e[0].z-e[2].z},r=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)+Math.pow(t.z,2)),a=Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2)+Math.pow(i.z,2)),s=Math.sqrt(Math.pow(o.x,2)+Math.pow(o.y,2)+Math.pow(o.z,2)),l=Math.acos((r**2+a**2-s**2)/(2*a*s));return n.Math.toDegrees(l)}};function Ce(e,t,i,n,o){return Math.abs(e-i)<o&&Math.abs(t-n)<o}function be(e){return!(e>180||e<-180)}function Ee(e){return!(e>90||e<-90)}function Te(e,t,i){let n=Math.abs(we.calculationDistance(e,t)),o=Math.abs(we.calculationDistance(e,i)),r=Math.abs(we.calculationDistance(t,i)),a=(n+o+r)/2;return 2*Math.sqrt(Math.abs(a*(a-n)*(a-o)*(a-r)))/n}function Me(e,t,i,n,o,r){if(i<n){let a=0,s=e[i],l=e[n];if(Math.abs(s.x-l.x)>r||Math.abs(s.y-l.y)>r){let c=0;for(let t=i+1;t<n;t++){let i=Te(s,l,e[t]);i>c&&(c=i,a=t)}c>=o&&(t.push(e[a]),Me(e,t,i,a,o,r),Me(e,t,a,n,o,r))}else a=Math.floor((i+n)/2),a>i&&a<n&&(t.push(e[a]),Me(e,t,i,a,o,r),Me(e,t,a,n,o,r))}return t}var Se=we;class xe{constructor(e){this._definitionChanged=new Cesium.Event,this._color=void 0,this._colorSubscription=void 0,this.color=e}}function Pe(e,t,i,o,r){let a=n.Cartographic.fromCartesian(e),s=n.Cartographic.fromCartesian(t),l=n.Cartographic.fromCartesian(i),c=(a.longitude+s.longitude)/2,d=(a.latitude+s.latitude)/2,h=Se.lon_to_meter(a.longitude-c,a.latitude),u=Se.lat_to_meter(a.latitude-d),p=Se.lon_to_meter(s.longitude-c,s.latitude),m=Se.lat_to_meter(s.latitude-d),g=Se.lon_to_meter(l.longitude-c,l.latitude),v=Se.lat_to_meter(l.latitude-d),f=[];Se.pointProjectLine(g,v,h,u,p,m,f);let y=Se.TwoPointsDistance(g,v,f[0],f[1]),w=Se.vecAngle(f[0],f[1],g,v),C=Se.polarPoint(h,u,w,y),b=Se.polarPoint(p,m,w,y),E=Se.meter_to_lat(C[1])+d,T=Se.meter_to_long(C[0],E)+c,M=Se.meter_to_lat(b[1])+d,S=Se.meter_to_long(b[0],M)+c;a.longitude=T,a.latitude=E,s.longitude=S,s.latitude=M,n.Cartographic.toCartesian(a,n.Ellipsoid.WGS84,r),n.Cartographic.toCartesian(s,n.Ellipsoid.WGS84,o)}function De(e,t){let i=B().scene.globe.ellipsoid.cartesianToCartographic(e),o=n.Math.toDegrees(i.longitude),r=n.Math.toDegrees(i.latitude),a=B().scene.globe.ellipsoid.cartesianToCartographic(t),s=n.Math.toDegrees(a.longitude),l=n.Math.toDegrees(a.latitude),c=Math.min(o,s),d=Math.max(o,s),h=Math.min(r,l),u=Math.max(r,l),p=n.Cartesian3.fromDegrees(c,u);return[p,n.Cartesian3.fromDegrees(d,u),n.Cartesian3.fromDegrees(d,h),n.Cartesian3.fromDegrees(c,h),p]}function _e(e="cartesian",t,i){"function"==typeof t&&t("cartographicObj"===e?I(i):"cartographicPoiArr"===e?k(i):i)}Object.defineProperties(xe.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color")}),xe.prototype.getType=function(e){return"PolylineLighting"},xe.prototype.getValue=function(e,t){return Cesium.defined(t)||(t={}),t.color=Cesium.Property.getValueOrClonedDefault(this._color,e,Cesium.Color.WHITE,t.color),t.image=Cesium.Material.PolylineLightingImage,t},xe.prototype.equals=function(e){return this===e||e instanceof xe&&Cesium.Property.equals(this._color,e._color)},Cesium.Material.PolylineLightingType="PolylineLighting",Cesium.Material.PolylineLightingImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAACYCAYAAACS0lH9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAJ0GlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDIgMTE2LjE2NDY1NSwgMjAyMS8wMS8yNi0xNTo0MToyMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDplODY0YmNmNy1lZGIyLWIyNDQtYWI0NC04OWZkNmMwOTQ4MDYiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NjIyOGMxMDUtODFmZS00MjAxLWIwOTEtZDkwMGI0NTI0NWMwIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9IjcxNzA5OEJGODAwODNEREJGRDQyQzAzMzQ5NDlDRDFDIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9IiIgdGlmZjpJbWFnZVdpZHRoPSI1MTIiIHRpZmY6SW1hZ2VMZW5ndGg9IjE1MiIgdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPSIyIiB0aWZmOlNhbXBsZXNQZXJQaXhlbD0iMyIgdGlmZjpYUmVzb2x1dGlvbj0iMS8xIiB0aWZmOllSZXNvbHV0aW9uPSIxLzEiIHRpZmY6UmVzb2x1dGlvblVuaXQ9IjEiIGV4aWY6RXhpZlZlcnNpb249IjAyMzEiIGV4aWY6Q29sb3JTcGFjZT0iNjU1MzUiIGV4aWY6UGl4ZWxYRGltZW5zaW9uPSI1MTIiIGV4aWY6UGl4ZWxZRGltZW5zaW9uPSIxNTIiIHhtcDpDcmVhdGVEYXRlPSIyMDIxLTAyLTIzVDEwOjAyOjQxKzA4OjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMS0wMi0yM1QxMDowODo0NCswODowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyMS0wMi0yM1QxMDowODo0NCswODowMCI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmZmYTk5ZjhhLTdiZmQtNDcxNi04MTgwLWJmZTUyMmFmNGUzNSIgc3RFdnQ6d2hlbj0iMjAyMS0wMi0yM1QxMDowODo0NCswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjIgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBpbWFnZS9qcGVnIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gaW1hZ2UvanBlZyB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjYyMjhjMTA1LTgxZmUtNDIwMS1iMDkxLWQ5MDBiNDUyNDVjMCIgc3RFdnQ6d2hlbj0iMjAyMS0wMi0yM1QxMDowODo0NCswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDIxLjIgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOmZmYTk5ZjhhLTdiZmQtNDcxNi04MTgwLWJmZTUyMmFmNGUzNSIgc3RSZWY6ZG9jdW1lbnRJRD0iNzE3MDk4QkY4MDA4M0REQkZENDJDMDMzNDk0OUNEMUMiIHN0UmVmOm9yaWdpbmFsRG9jdW1lbnRJRD0iNzE3MDk4QkY4MDA4M0REQkZENDJDMDMzNDk0OUNEMUMiLz4gPHBob3Rvc2hvcDpEb2N1bWVudEFuY2VzdG9ycz4gPHJkZjpCYWc+IDxyZGY6bGk+NzE3MDk4QkY4MDA4M0REQkZENDJDMDMzNDk0OUNEMUM8L3JkZjpsaT4gPC9yZGY6QmFnPiA8L3Bob3Rvc2hvcDpEb2N1bWVudEFuY2VzdG9ycz4gPHRpZmY6Qml0c1BlclNhbXBsZT4gPHJkZjpTZXE+IDxyZGY6bGk+ODwvcmRmOmxpPiA8cmRmOmxpPjg8L3JkZjpsaT4gPHJkZjpsaT44PC9yZGY6bGk+IDwvcmRmOlNlcT4gPC90aWZmOkJpdHNQZXJTYW1wbGU+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+h9EbuwAAA01JREFUeJzt3TuOFVkQBNDoJhmEkDBgZv8L5GMgIcRvHg5ryDTiHKn98Co67q16T4/HYwIAVHm+DgAA7FMAAKCQAgAAhSbJ03UIAGCXBQAACikAAFDIEQAAFLIAAEAhBQAACikAAFBoogQAQB0PfwAopAAAQCGvAQJAIQsAABSyAABAIQsAABSyAABAIQUAAAo5AgCAQr4ECACFPPwBoJACAACFHAEAQCEPfwAoZAEAgEIe/gBQyAIAAIU8/AGgkAUAAAr5LQAAKOS/fwAoZAEAgELuAABAIQsAABRSAACgkAIAAIXcAQCAQhYAAChkAQCAQgoAABRSAACgkIc/ABSaJC+uQwAAu7wFAACFFAAAKDR//wCAIhYAACjkEiAAFLIAAEChSfLyOgQAsMuXAAGgkLcAAKCQAgAAhbwFAACFFAAAKOQIAAAKTZJ/rkMAALsUAAAo5AgAAAr5EiAAFFIAAKCQOwAAUEgBAIBCk+TVdQgAYNckeXMdAgDYNUneXocAAHZNkvfXIQCAXZPkv+sQAMCuSfLvdQgAYNckeXcdAgDY5RIgABSaJK+vQwAAu/wWAAAUmiRP1yEAgF2T5HEdAgDYNUl+XocAAHZNkm/XIQCAXZPky3UIAGDXJPl8HQIA2DVJPl6HAAB2TZIP1yEAgF2T5NN1CABgl0uAAFBokny9DgEA7Jok369DAAC7JsmP6xAAwC4FAAAK+S0AACikAABAoUny6zoEALDLHQAAKKQAAEAhRwAAUGiS/L4OAQDsUgAAoJAjAAAopAAAQKFJ8v91CABgly8BAkChSfK4DgEA7PIWAAAUsgAAQCFvAQBAIQsAABRSAACgkEuAAFDo+ToAALDPlwABoJACAACFFAAAKOQtAAAoZAEAgEIWAAAopAAAQCEFAAAKuQMAAIUsAABQyKeAAaCQBQAACrkDAACFHAEAQCELAAAUsgAAQCELAAAUsgAAQCELAAAUsgAAQCEFAAAKOQIAgEIWAAAo5LcAAKCQAgAAhRwBAEAhCwAAFLIAAEAhCwAAFLIAAEAhBQAACvkSIAAUsgAAQCEFAAAKKQAAUMhrgABQyAIAAIUUAAAo5AgAAApZAACgkAIAAIUUAAAo5A4AABT6A6gaPQ6/wRIfAAAAAElFTkSuQmCC",Cesium.Material.PolylineLightingSource="czm_material czm_getMaterial(czm_materialInput materialInput)\n { czm_material material = czm_getDefaultMaterial(materialInput); vec2 st = materialInput.st;\n    vec4 colorImage = texture2D(image, vec2(fract(st.s), st.t));\n     material.alpha = colorImage.a * color.a;\n     material.diffuse = (colorImage.rgb + color.rgb)* 1.3 ;\n     return material;}",Cesium.Material._materialCache.addMaterial(Cesium.Material.PolylineLightingType,{fabric:{type:Cesium.Material.PolylineLightingType,uniforms:{color:new Cesium.Color(1,0,0,.5),image:Cesium.Material.PolylineLightingImage},source:Cesium.Material.PolylineLightingSource},translucent:function(e){return!0}});var Ae=class{constructor(e){this.viewer=e,this.dataSourceToo=new n.CustomDataSource("画图工具-实体集合"),e.dataSources.add(this.dataSourceToo).then(),this.entityFactory=new pe(e,this.dataSourceToo),this.handler=ye.getHandle(this.viewer,null).handler,this.coordinates=[],this.dynamicNodesPoint=[],this.drawEntities=null,this.isDepthTest=e.scene.globe.depthTestAgainstTerrain,this.errCallback=null}drawPoint({coordinateType:e,endCallback:t,moveCallback:i,errCallback:o}){let r=this,a=r.drawShapeStart();r.errCallback=o,a.setInputAction((function(i){let o=r.viewer.scene.pickPosition(i.position);n.defined(o)&&(r.drawShapeEnd(),_e(e,t,[o]))}),n.ScreenSpaceEventType.LEFT_CLICK),a.setInputAction((function(e){let t=r.viewer.scene.pickPosition(e.endPosition);"function"==typeof i&&i(t)}),n.ScreenSpaceEventType.MOUSE_MOVE),a.setInputAction((function(e){r.drawShapeErrorCallback(null)}),n.ScreenSpaceEventType.RIGHT_CLICK)}drawLine({coordinateType:e,endCallback:t,moveCallback:i,errCallback:o}){let r=this,a=r.drawShapeStart();r.errCallback=o;let s=[];a.setInputAction((function(i){let o=r.viewer.scene.pickPosition(i.position);n.defined(o)&&(r.dynamicNodesPoint.push(r.entityFactory.createPoint(o)),r.coordinates.push(o),s.push(o),r.drawEntities||(r.drawEntities=r.dataSourceToo.entities.add({polyline:{positions:new n.CallbackProperty((function(){return r.coordinates}),!1),width:12,clampToGround:!0,arcType:n.ArcType.RHUMB,material:new xe(n.Color.GREEN)}})),2===s.length&&(_e(e,t,s),r.drawShapeEnd()))}),n.ScreenSpaceEventType.LEFT_CLICK),a.setInputAction((function(e){let t=r.viewer.scene.pickPosition(e.endPosition);n.defined(t)&&(1===r.coordinates.length&&r.coordinates.push(t),2===r.coordinates.length&&(r.coordinates.pop(),r.coordinates.push(t)),"function"==typeof i&&i(r.coordinates))}),n.ScreenSpaceEventType.MOUSE_MOVE),a.setInputAction((function(e){r.drawShapeErrorCallback(null)}),n.ScreenSpaceEventType.RIGHT_CLICK)}drawPolyLine({coordinateType:e,endCallback:t,moveCallback:i,errCallback:o}){let r=this,a=r.drawShapeStart();r.errCallback=o,a.setInputAction((function(e){let t=r.viewer.scene.pickPosition(e.position);n.defined(t)&&(r.dynamicNodesPoint.push(r.entityFactory.createPoint(t)),r.coordinates.push(t),r.drawEntities||(r.drawEntities=r.dataSourceToo.entities.add({polyline:{positions:new n.CallbackProperty((function(){return r.coordinates}),!1),width:12,clampToGround:!0,arcType:n.ArcType.RHUMB,material:new xe(n.Color.GREEN)}})))}),n.ScreenSpaceEventType.LEFT_CLICK),a.setInputAction((function(e){let t=r.viewer.scene.pickPosition(e.endPosition);n.defined(t)&&(1===r.coordinates.length&&r.coordinates.push(t),r.coordinates.length>=2&&(r.coordinates.pop(),r.coordinates.push(t)),"function"==typeof i&&i(r.coordinates))}),n.ScreenSpaceEventType.MOUSE_MOVE),a.setInputAction((function(i){r.coordinates.length>=2?(_e(e,t,r.coordinates),r.drawShapeEnd()):r.drawShapeErrorCallback(null)}),n.ScreenSpaceEventType.RIGHT_CLICK)}drawTriangle({coordinateType:e,endCallback:t,moveCallback:i,errCallback:o}){let r=this,a=r.drawShapeStart();r.errCallback=o;let s,l=[];a.setInputAction((function(i){let o=r.viewer.scene.pickPosition(i.position);n.defined(o)&&(r.dynamicNodesPoint.push(r.entityFactory.createPoint(o)),l.push(o),r.coordinates.push(o),r.drawEntities||(s=new n.CallbackProperty((function(){return r.coordinates}),!1),r.drawEntities=r.dataSourceToo.entities.add({polyline:{positions:s,width:12,clampToGround:!0,arcType:n.ArcType.RHUMB,material:new xe(n.Color.GREEN)}})),3===l.length&&(_e(e,t,l),r.drawShapeEnd()))}),n.ScreenSpaceEventType.LEFT_CLICK),a.setInputAction((function(e){let t=r.viewer.scene.pickPosition(e.endPosition);n.defined(t)&&(1===r.coordinates.length&&r.coordinates.push(t),r.coordinates.length>=2&&(r.coordinates.pop(),r.coordinates.push(t)),"function"==typeof i&&i(r.coordinates))}),n.ScreenSpaceEventType.MOUSE_MOVE),a.setInputAction((function(i){r.drawShapeEnd(),l.length>=2?_e(e,t,l):r.drawShapeErrorCallback(null)}),n.ScreenSpaceEventType.RIGHT_CLICK)}drawPolygon({coordinateType:e,endCallback:t,moveCallback:i,errCallback:o}){let r=this,a=r.drawShapeStart();r.errCallback=o;let s=[];a.setInputAction((function(e){let t=r.viewer.scene.pickPosition(e.position);n.defined(t)&&(r.dynamicNodesPoint.push(r.entityFactory.createPoint(t)),s.push(JSON.parse(JSON.stringify(t))),r.coordinates.push(t),2===r.dynamicNodesPoint.length&&(r.drawEntities||(r.drawEntities=r.dataSourceToo.entities.add({polyline:{positions:new n.CallbackProperty((function(){let e=JSON.parse(JSON.stringify(r.coordinates));return e.push(e[0]),e}),!1),width:12,clampToGround:!0,arcType:n.ArcType.RHUMB,material:new xe(n.Color.GREEN)},polygon:{hierarchy:new n.CallbackProperty((function(){return new n.PolygonHierarchy(r.coordinates)}),!1),material:new n.ColorMaterialProperty(n.Color.LIGHTSKYBLUE.withAlpha(.3)),heightReference:n.HeightReference.NONE}}))))}),n.ScreenSpaceEventType.LEFT_CLICK),a.setInputAction((function(e){let t=r.viewer.scene.pickPosition(e.endPosition);if(n.defined(t)&&(r.coordinates.pop(),r.coordinates.push(t),"function"==typeof i)){let e=JSON.parse(JSON.stringify(s));e.push(JSON.parse(JSON.stringify(t))),i(e)}}),n.ScreenSpaceEventType.MOUSE_MOVE),a.setInputAction((function(){r.drawShapeEnd(),s.length>=2?(s.push(s[0]),_e(e,t,s)):r.drawShapeErrorCallback(null)}),n.ScreenSpaceEventType.RIGHT_CLICK)}drawCircle({endCallback:e,moveCallback:t,errCallback:i}){let o,r,a=this,s=a.drawShapeStart();a.errCallback=i;let l=0;s.setInputAction((function(t){let i=a.viewer.scene.pickPosition(t.position);n.defined(i)&&(a.dynamicNodesPoint.push(a.entityFactory.createPoint(i)),r?("function"==typeof e&&e({Center:r,EndPoint:i,Radius:l}),a.drawShapeEnd()):r=i)}),n.ScreenSpaceEventType.LEFT_CLICK),s.setInputAction((function(e){let i=a.viewer.scene.pickPosition(e.endPosition);if(n.defined(i)&&r){let e=a.viewer.scene.globe.ellipsoid.cartesianToCartographic(r),s=a.viewer.scene.globe.ellipsoid.cartesianToCartographic(i),c=new n.EllipsoidGeodesic(e,s);l=c.surfaceDistance,"function"==typeof t&&t({Center:r,EndPoint:i,Radius:l}),o||(o=new n.CallbackProperty((function(){return l}),!1)),a.drawEntities||(a.drawEntities=a.dataSourceToo.entities.add({position:r,name:"Red ellipse on surface",ellipse:{semiMinorAxis:o,semiMajorAxis:o,material:n.Color.RED.withAlpha(.5)}}))}}),n.ScreenSpaceEventType.MOUSE_MOVE),s.setInputAction((function(e){a.drawShapeErrorCallback(null)}),n.ScreenSpaceEventType.RIGHT_CLICK)}drawRectangle({coordinateType:e,endCallback:t,moveCallback:i,errCallback:o}){let r=this,a=r.drawShapeStart();r.errCallback=o;let s,l=[],c=[];a.setInputAction((function(i){let o=r.viewer.scene.pickPosition(i.position);n.defined(o)&&(r.dynamicNodesPoint.push(r.entityFactory.createPoint(o)),l.push(o),1===l.length&&(r.drawEntities||(s=new n.CallbackProperty((function(){return new n.PolygonHierarchy(c)}),!1),r.drawEntities=r.dataSourceToo.entities.add({polygon:{hierarchy:s,material:new n.ColorMaterialProperty(n.Color.LIGHTSKYBLUE.withAlpha(.3)),heightReference:n.HeightReference.NONE}}))),2===l.length&&(l[1]=o,c=De(l[0],l[1]),_e(e,t,c),r.drawShapeEnd()))}),n.ScreenSpaceEventType.LEFT_CLICK),a.setInputAction((function(e){let t=r.viewer.scene.pickPosition(e.endPosition);1===l.length&&t&&(c=c=De(l[0],t),"function"==typeof i&&i(r.coordinates))}),n.ScreenSpaceEventType.MOUSE_MOVE),a.setInputAction((function(){r.drawShapeErrorCallback(null)}),n.ScreenSpaceEventType.RIGHT_CLICK)}drawInclinedRectangle({coordinateType:e,endCallback:t,moveCallback:i,errCallback:o}){let r,a=this,s=a.drawShapeStart();a.errCallback=o,s.setInputAction((function(i){let o=a.viewer.scene.pickPosition(i.position);n.defined(o)&&(a.dynamicNodesPoint.push(a.entityFactory.createPoint(o)),a.coordinates.length<2&&a.coordinates.push(o),2===a.dynamicNodesPoint.length&&(a.drawEntities||(r=new n.CallbackProperty((function(){return new n.PolygonHierarchy(a.coordinates)}),!1),a.drawEntities=a.dataSourceToo.entities.add({polygon:{hierarchy:r,material:new n.ColorMaterialProperty(n.Color.LIGHTSKYBLUE.withAlpha(.3)),heightReference:n.HeightReference.NONE}}))),3===a.dynamicNodesPoint.length&&(_e(e,t,a.coordinates),a.drawShapeEnd()))}),n.ScreenSpaceEventType.LEFT_CLICK),s.setInputAction((function(e){let t=a.viewer.scene.pickPosition(e.endPosition);if(2===a.coordinates.length){let e=new n.Cartesian3,i=new n.Cartesian3;Pe(a.coordinates[0],a.coordinates[1],t,e,i),a.coordinates.push(e,i)}else if(a.coordinates.length>2){a.coordinates.pop(),a.coordinates.pop();let e=new n.Cartesian3,o=new n.Cartesian3;Pe(a.coordinates[0],a.coordinates[1],t,e,o),a.coordinates.push(e),a.coordinates.push(o),"function"==typeof i&&i(a.coordinates)}}),n.ScreenSpaceEventType.MOUSE_MOVE),s.setInputAction((function(){a.drawShapeErrorCallback(null)}),n.ScreenSpaceEventType.RIGHT_CLICK)}startDrawingeYPlan({position:e,normal:t,dimensions:i,endCallback:o,moveCallback:r,errCallback:a}){let s=this,l=s.drawShapeStart();var c;s.errCallback=a;var d=0,h=new n.ClippingPlane(t,0);s.drawEntities=s.dataSourceToo.entities.add({position:e,plane:{dimensions:i,material:n.Color.BLUE.withAlpha(.5),plane:new n.CallbackProperty(function(e){return function(){return e.distance=d,e}}(h),!1),outline:!0,outlineColor:n.Color.BLUE}}),s.drawEntities.startDrawingeYPlan="startDrawingeYPlan",l.setInputAction((function(e){var t=s.viewer.scene.pick(e.position);n.defined(t)&&n.defined(t.id)&&n.defined(t.id.plane)&&"startDrawingeYPlan"==t.id.startDrawingeYPlan&&((c=t.id.plane).material=n.Color.RED.withAlpha(.5),c.outlineColor=n.Color.RED,s.viewer.scene.screenSpaceCameraController.enableInputs=!1)}),n.ScreenSpaceEventType.LEFT_DOWN),l.setInputAction((function(){n.defined(c)&&(c.material=n.Color.BLUE.withAlpha(.5),c.outlineColor=n.Color.BLUE,c=void 0),"function"==typeof o&&o(d),s.viewer.scene.screenSpaceCameraController.enableInputs=!0}),n.ScreenSpaceEventType.LEFT_UP),l.setInputAction((function(e){if(n.defined(c)){var t=e.startPosition.y-e.endPosition.y;d+=t}}),n.ScreenSpaceEventType.MOUSE_MOVE),l.setInputAction((function(e){s.drawShapeErrorCallback(null)}),n.ScreenSpaceEventType.RIGHT_CLICK)}drawShapeErrorCallback(e){let t=this;t.drawShapeEnd(),"function"==typeof t.errCallback&&t.errCallback(e)}drawShapeStart(){let e=this;return window.document.body.style.cursor="crosshair",e.handler=ye.getHandle(e.viewer,e.drawShapeErrorCallback).handler,e.isDepthTest=e.viewer.scene.globe.depthTestAgainstTerrain,e.isDepthTest||(e.viewer.scene.globe.depthTestAgainstTerrain=!0,console.log("%c自动开启深度检测！","color: #43bb88;")),e.handler}drawShapeEnd(){let e=this;window.document.body.style.cursor="auto",e.clearDrawEntity(),e.viewer.scene.globe.depthTestAgainstTerrain=e.isDepthTest,e.handler.isDestroyed()||e.handler.destroy()}clearDrawEntity(){let e=this;e.coordinates=[];for(let t=0;t<e.dynamicNodesPoint.length;t++)e.dynamicNodesPoint[t]&&e.dataSourceToo.entities.remove(e.dynamicNodesPoint[t]);e.dynamicNodesPoint=[],e.drawEntities&&e.dataSourceToo.entities.remove(e.drawEntities),e.drawEntities=null}};let Ie={contents:[],startFlyCallbacks:[],endFlyCallbacks:[],start(e){let t=B();e&&(this.contents=[]),Ie.startFlyCallbacks.forEach((e=>{e()})),t.camera.flyTo({destination:this.contents[0],duration:2,complete:function(){t.camera.flyTo({destination:this.contents[1],complete:function(){Ie.endFlyCallbacks.forEach((e=>{e()}))}})}})},onStartFly(e){"function"==typeof e&&this.startFlyCallbacks.push(e)},onEndFly(e){"function"==typeof e&&this.endFlyCallbacks.push(e)}};var ke=Ie,Le=function(e){let t=new Map;return e.forEach((e=>{let i=t.get(e.catalog);i?i.push(e):t.set(e.catalog,[e])})),t},Re=function(){let e=window.earth;if(!e)throw"清先初始化 Earth";return e};function Oe(e,t){return t.font?t.font:{}}class Be{constructor(e){this._definitionChanged=new Cesium.Event,this._color=void 0,this._colorSubscription=void 0,this.color=e.color,this.duration=e.duration,this.url=e.url||i(8425),this.count=e.count,this._time=(new Date).getTime()}}Object.defineProperties(Be.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color")}),Be.prototype.getType=function(e){return"PolylineArrowOpacity"},Be.prototype.getValue=function(e,t){return Cesium.defined(t)||(t={}),t.color=Cesium.Property.getValueOrClonedDefault(this._color,e,Cesium.Color.WHITE,t.color),t.image=this.url,t.time=((new Date).getTime()-this._time)%this.duration/this.duration,t.count=this.count||4,t},Be.prototype.equals=function(e){return this===e||e instanceof Be&&Cesium.Property.equals(this._color,e._color)&&this.duration==e.duration&&this.count==e.count},Cesium.Material.PolylineArrowOpacityType="PolylineArrowOpacity",Cesium.Material.PolylineArrowOpacitySource="czm_material czm_getMaterial(czm_materialInput materialInput)\n { czm_material material = czm_getDefaultMaterial(materialInput); vec2 st = materialInput.st;\n    vec4 colorImage = texture2D(image, vec2(fract( count * st.s - time),fract(st.t)));\n     material.alpha =  colorImage.a * color.a;\n     material.diffuse =  color.rgb * 3.0 ;\n     return material;}",Cesium.Material._materialCache.addMaterial(Cesium.Material.PolylineArrowOpacityType,{fabric:{type:Cesium.Material.PolylineArrowOpacityType,uniforms:{color:new Cesium.Color(1,0,0,.5),image:"",time:20,count:4},source:Cesium.Material.PolylineArrowOpacitySource},translucent:function(e){return!0}});class Fe{constructor(e){this._definitionChanged=new Cesium.Event,this._color=void 0,this._colorSubscription=void 0,this.color=e.color,this.duration=e.duration,this.count=e.count,this.url=e.url||i(9561),this._time=(new Date).getTime()}}Object.defineProperties(Fe.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color")}),Fe.prototype.getType=function(e){return"PolylineEnergyTrans"},Fe.prototype.getValue=function(e,t){return Cesium.defined(t)||(t={}),t.color=Cesium.Property.getValueOrClonedDefault(this._color,e,Cesium.Color.WHITE,t.color),t.image=this.url,t.time=((new Date).getTime()-this._time)%this.duration/this.duration,t.count=this.count||4,t},Fe.prototype.equals=function(e){return this===e||e instanceof Fe&&Cesium.Property.equals(this._color,e._color)&&this.duration==e.duration&&this.count==e.count},Cesium.Material.PolylineEnergyTransType="PolylineEnergyTrans",Cesium.Material.PolylineEnergyTransSource="czm_material czm_getMaterial(czm_materialInput materialInput)\n { czm_material material = czm_getDefaultMaterial(materialInput); vec2 st = materialInput.st;\n    vec4 colorImage = texture2D(image, vec2(fract( count * st.s - time),fract(st.t)));\n     material.alpha =  colorImage.a * color.a;\n     material.diffuse =  color.rgb *3.0 ;\n     return material;}",Cesium.Material._materialCache.addMaterial(Cesium.Material.PolylineEnergyTransType,{fabric:{type:Cesium.Material.PolylineEnergyTransType,uniforms:{color:new Cesium.Color(1,0,0,.5),image:"",time:20,count:4},source:Cesium.Material.PolylineEnergyTransSource},translucent:function(e){return!0}});class We{constructor(e){this._definitionChanged=new Cesium.Event,this._color=void 0,this._colorSubscription=void 0,this.color=e.color,this.duration=e.duration,this.url=e.url||i(2257),this._time=(new Date).getTime()}}Object.defineProperties(We.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color")}),We.prototype.getType=function(e){return"PolylineLinkPulse"},We.prototype.getValue=function(e,t){return Cesium.defined(t)||(t={}),t.color=Cesium.Property.getValueOrClonedDefault(this._color,e,Cesium.Color.WHITE,t.color),t.image=this.url,t.time=((new Date).getTime()-this._time)%this.duration/this.duration,t},We.prototype.equals=function(e){return this===e||e instanceof We&&Cesium.Property.equals(this._color,e._color)},Cesium.Material.PolylineLinkPulseType="PolylineLinkPulse",Cesium.Material.PolylineLinkPulseSource="czm_material czm_getMaterial(czm_materialInput materialInput)\n { czm_material material = czm_getDefaultMaterial(materialInput); vec2 st = materialInput.st;\n    vec4 colorImage = texture2D(image, vec2(fract(st.s - time), st.t));\n     material.alpha = colorImage.a * color.a;\n     material.diffuse = (colorImage.rgb + color.rgb)* 2.5 ;\n     return material;}",Cesium.Material._materialCache.addMaterial(Cesium.Material.PolylineLinkPulseType,{fabric:{type:Cesium.Material.PolylineLinkPulseType,uniforms:{color:new Cesium.Color(1,0,0,.5),image:"",time:20},source:Cesium.Material.PolylineLinkPulseSource},translucent:function(e){return!0}});class Ne{constructor(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this._definitionChanged=new Cesium.Event,this._color=void 0,this._colorSubscription=void 0,this.color=e.color,this.duration=e.duration,this.url=e.url,this._time=performance.now()}}Object.defineProperties(Ne.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color")}),Ne.prototype.getType=function(e){return"PolylineMigrate"},Ne.prototype.getValue=function(e,t){return Cesium.defined(t)||(t={}),t.color=Cesium.Property.getValueOrClonedDefault(this._color,e,Cesium.Color.WHITE,t.color),t.image=this.url,t.time=(performance.now()-this._time)%this.duration/this.duration,t},Ne.prototype.equals=function(e){return this===e||e instanceof Ne&&Cesium.Property.equals(this._color,e._color)&&this.duration==e.duration},Cesium.Material.PolylineMigrateType="PolylineMigrate",Cesium.Material.PolylineMigrateSource="czm_material czm_getMaterial(czm_materialInput materialInput)\n       {\n             czm_material material = czm_getDefaultMaterial(materialInput);\n             vec2 st = materialInput.st;\n             vec4 colorImage = texture2D(image, vec2(fract(st.s - time), st.t));\n             material.alpha = colorImage.a * color.a;\n             material.diffuse = color.rgb*1.5;\n             return material;\n     }",Cesium.Material._materialCache.addMaterial(Cesium.Material.PolylineMigrateType,{fabric:{type:Cesium.Material.PolylineMigrateType,uniforms:{color:new Cesium.Color(1,0,0,.5),image:"",transparent:!0,time:20},source:Cesium.Material.PolylineMigrateSource},translucent:function(e){return!0}});class He{constructor(e){this._definitionChanged=new Cesium.Event,this.duration=e.duration,this.url=e.url,this._time=performance.now()}}Object.defineProperties(He.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color")}),He.prototype.getType=function(e){return"PolylineSprite"},He.prototype.getValue=function(e,t){return Cesium.defined(t)||(t={}),t.image=this.url,t.time=(performance.now()-this._time)%this.duration/this.duration,t},He.prototype.equals=function(e){return this===e||e instanceof He&&this.duration==e.duration},Cesium.Material.PolylineSpriteType="PolylineSprite",Cesium.Material.PolylineSpriteSource="czm_material czm_getMaterial(czm_materialInput materialInput)\n      {\n            czm_material material = czm_getDefaultMaterial(materialInput);\n            vec2 st = materialInput.st;\n            vec4 colorImage = texture2D(image, vec2(fract(st.s - time), st.t));\n            material.alpha = colorImage.a;\n            material.diffuse = colorImage.rgb * 1.5 ;\n            return material;\n    }",Cesium.Material._materialCache.addMaterial(Cesium.Material.PolylineSpriteType,{fabric:{type:Cesium.Material.PolylineSpriteType,uniforms:{color:new Cesium.Color(1,0,0,.5),image:"",transparent:!0,time:20},source:Cesium.Material.PolylineSpriteSource},translucent:function(e){return!0}});class Ve{constructor(e){this._definitionChanged=new Cesium.Event,this._color=void 0,this._colorSubscription=void 0,this.color=e.color,this.duration=e.duration,this.count=e.count,this.url=e.url,this._time=(new Date).getTime()}}Object.defineProperties(Ve.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color")}),Ve.prototype.getType=function(e){return"PolylineSuper"},Ve.prototype.getValue=function(e,t){return Cesium.defined(t)||(t={}),t.color=Cesium.Property.getValueOrClonedDefault(this._color,e,Cesium.Color.WHITE,t.color),t.image=this.url,t.time=((new Date).getTime()-this._time)%this.duration/this.duration,t.count=this.count||4,t},Ve.prototype.equals=function(e){return this===e||e instanceof Ve&&Cesium.Property.equals(this._color,e._color)&&this.duration==e.duration&&this.count==e.count&&this.url==e.url},Cesium.Material.PolylineSuperType="PolylineSuper",Cesium.Material.PolylineSuperSource="czm_material czm_getMaterial(czm_materialInput materialInput)\n { czm_material material = czm_getDefaultMaterial(materialInput); vec2 st = materialInput.st;\n    vec4 colorImage = texture2D(image, vec2(fract( count * st.s - time),fract(st.t)));\n     material.alpha =  colorImage.a * color.a;\n     material.diffuse =  color.rgb * 1.5 ;\n     return material;}",Cesium.Material._materialCache.addMaterial(Cesium.Material.PolylineSuperType,{fabric:{type:Cesium.Material.PolylineSuperType,uniforms:{color:new Cesium.Color(1,0,0,.5),image:"",time:20,count:4},source:Cesium.Material.PolylineSuperSource},translucent:function(e){return!0}});class ze{constructor(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this._definitionChanged=new Cesium.Event,this.colorSubscription=void 0,this.speed=e.speed||6*Math.random(),this.color=e.color||Cesium.Color.RED,this.percent=e.percent||.1,this.gradient=e.gradient||.01}}Object.defineProperties(ze.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color")}),ze.prototype.getType=function(e){return"PolylineTrail"},ze.prototype.getValue=function(e,t){return Cesium.defined(t)||(t={}),t.color=Cesium.Property.getValueOrClonedDefault(this.color,e,Cesium.Color.WHITE,t.color),t.speed=this.speed,t.gradient=this.gradient,t.percent=this.percent,t},ze.prototype.equals=function(e){return this===e||e instanceof ze&&this.speed==e.speed&&Cesium.Property.equals(this.color,e.color)},Cesium.Material.PolylineTrailType="PolylineTrail",Cesium.Material.PolylineTrailSource="uniform vec4 color;\nuniform float speed;\nuniform float percent;\nuniform float gradient;\n\nczm_material czm_getMaterial(czm_materialInput materialInput){\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    vec2 st = materialInput.st;\n    float t =fract(czm_frameNumber * speed / 1000.0);\n    t *= (1.0 + percent);\n    float alpha = smoothstep(t- percent, t, st.s) * step(-t, -st.s);\n    alpha += gradient;\n    material.diffuse = color.rgb;\n    material.alpha = alpha;\n    return material;\n}",Cesium.Material._materialCache.addMaterial(Cesium.Material.PolylineTrailType,{fabric:{type:Cesium.Material.PolylineTrailType,uniforms:{color:new Cesium.Color(1,0,0,.5),transparent:!0,speed:0,gradient:.01,percent:.1},source:Cesium.Material.PolylineTrailSource},translucent:function(e){return!0}});class Ge{constructor(e){e=Cesium.defaultValue(e,Cesium.defaultValue.EMPTY_OBJECT),this._definitionChanged=new Cesium.Event,this._color=void 0,this._colorSubscription=void 0,this.color=e.color,this.duration=e.duration,this._time=performance.now()}}Object.defineProperties(Ge.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color")}),Ge.prototype.getType=function(e){return"PolylineTrialFlow"},Ge.prototype.getValue=function(e,t){return Cesium.defined(t)||(t={}),t.color=Cesium.Property.getValueOrClonedDefault(this._color,e,Cesium.Color.WHITE,t.color),t.time=(performance.now()-this._time)%this.duration/this.duration,t},Ge.prototype.equals=function(e){return this===e||e instanceof Ge&&this.duration==e.duration&&Cesium.Property.equals(this._color,e._color)},Cesium.Material.PolylineTrialFlowType="PolylineTrialFlow",Cesium.Material.PolylineTrialFlowSource="czm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    vec2 st = materialInput.st;\n    float t = time;\n    t *= 1.03;\n    float alpha = smoothstep(t- 0.1, t, st.s) * step(-t, -st.s);\n    alpha += 0.1;\n    material.diffuse= color.rgb;\n    material.alpha = alpha;\n    return material;\n}\n",Cesium.Material._materialCache.addMaterial(Cesium.Material.PolylineTrialFlowType,{fabric:{type:Cesium.Material.PolylineTrialFlowType,uniforms:{color:new Cesium.Color(1,0,0,.5),transparent:!0,time:20},source:Cesium.Material.PolylineTrialFlowSource},translucent:function(e){return!0}});class Ue{constructor(e){this._definitionChanged=new Cesium.Event,this._color=void 0,this._colorSubscription=void 0,this.color=e.color,this.duration=e.duration,this.count=e.count,this.url=e.url,this._time=(new Date).getTime()}}Object.defineProperties(Ue.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:Cesium.createPropertyDescriptor("color")}),Ue.prototype.getType=function(e){return"PolylineVolumeTrial"},Ue.prototype.getValue=function(e,t){return Cesium.defined(t)||(t={}),t.color=Cesium.Property.getValueOrClonedDefault(this._color,e,Cesium.Color.WHITE,t.color),t.image=this.url,t.time=((new Date).getTime()-this._time)%this.duration/this.duration,t.count=this.count||4,t},Ue.prototype.equals=function(e){return this===e||e instanceof Ue&&Cesium.Property.equals(this._color,e._color)&&this.duration==e.duration&&this.count==e.count},Cesium.Material.PolylineVolumeTrialType="PolylineVolumeTrial",Cesium.Material.PolylineVolumeTrialSource="czm_material czm_getMaterial(czm_materialInput materialInput)\n { czm_material material = czm_getDefaultMaterial(materialInput); vec2 st = materialInput.st;\n    vec4 colorImage = texture2D(image, vec2(fract( count * st.s - time),fract(st.t)));\n     material.alpha =  colorImage.a * color.a;\n     material.diffuse =  color.rgb *1.5 ;\n     return material;}",Cesium.Material._materialCache.addMaterial(Cesium.Material.PolylineVolumeTrialType,{fabric:{type:Cesium.Material.PolylineVolumeTrialType,uniforms:{color:new Cesium.Color(1,0,0,.5),image:"",time:20,count:4},source:Cesium.Material.PolylineVolumeTrialSource},translucent:function(e){return!0}});var je={PolylineArrowMaterialProperty:Be,PolylineEnergyTransMaterialProperty:Fe,PolylineLightingMaterialProperty:xe,PolylineLinkPulseMaterialProperty:We,PolylineMigrateMaterialProperty:Ne,PolylineSpriteMaterialProperty:He,PolylineSuperMaterialProperty:Ve,PolylineTrailMaterialProperty:ze,PolylineTrialFlowMaterialProperty:Ge,PolylineVolumeTrialMaterialProperty:Ue,FlyCylinder:class{constructor(e,t,i){this.viewer=e,this.property=t,this.style=i||{},this.addCylinder()}addCylinder(){this.cylinder=this.viewer.entities.add({position:new n.CallbackProperty((e=>this.getPostion()),!1),cylinder:{length:this.style.length||100,topRadius:this.style.topRadius||0,bottomRadius:this.style.bottomRadius||20,material:this.style.material||n.Color.RED.withAlpha(.6)}})}getPostion(){let e=this.property.getValue(this.viewer.clock.currentTime),t=n.Cartographic.fromCartesian(e);return n.Cartesian3.fromRadians(t.longitude,t.latitude,t.height-(this.style.length||50))}remove(){this.viewer.scene.postRender.removeEventListener(this.postRenderHandler,this),this.viewer.entities.remove(this.cylinder)}},FlyPath:class{constructor(e,t){this.viewer=e,this.params=t||{},this.addPath()}addPath(){this.path=this.viewer.entities.add({position:this.params.position,orientation:this.params.orientation,model:this.params.model,label:this.params.label,path:new n.PathGraphics({show:!0,width:3,leadTime:0,trailTime:3600,material:n.Color.RED,...this.params.style})})}remove(){this.viewer.entities.remove(this.path)}}},Ze={Polyline:je},$e={bouncePoint:function(e){let t={image:i(9734),bounceHeight:100,increment:.05},o=n.Cartographic.fromCartesian(e),r=n.Math.toDegrees(o.longitude),a=n.Math.toDegrees(o.latitude),s=o.height+t.bounceHeight,l=0,c=0;return new n.Entity({position:new n.CallbackProperty((()=>(c+=t.increment,l+=c,l>t.bounceHeight&&(l=t.bounceHeight,c*=-1,c*=.55),n.Cartesian3.fromDegrees(r,a,s-l)))),billboard:{image:t.image}})}};class Ye{constructor(e,t){return this.positions=e,this.options=t,this.createPrimitive()}createPrimitive(){let e=new n.PolygonGeometry({polygonHierarchy:new n.PolygonHierarchy(this.positions),perPositionHeight:!0,vertexFormat:n.EllipsoidSurfaceAppearance.VERTEX_FORMAT});return new n.Primitive({geometryInstances:new n.GeometryInstance({geometry:e}),appearance:this.getApper(),show:!0})}getApper(){let e=new n.EllipsoidSurfaceAppearance({aboveGround:!0});return e.material=new n.Material({fabric:{type:"Water",uniforms:{baseWaterColor:this.options.baseWaterColor,normalMap:this.options.normalMap,frequency:this.options.frequency,animationSpeed:this.options.animationSpeed,amplitude:this.options.amplitude,specularIntensity:this.options.specularIntensity}}}),e}}let Je={DivPoint:class{constructor(e,t,i){this._position=t,this._viewer=e,this._label=i,this._$container=document.createElement("div")}init(){this._addDom(),this._addPostRender()}remove(){this._viewer.scene.postRender.removeEventListener(this._postRender,this),this._$container.remove()}getPosition(){return this._position}_addDom(){this._$container.innerHTML=' \n            <div class="div-point-container">\n                <div class="divpoint divpoint-theme">\n                    <div class="divpoint-wrap">\n                        <div class="divpoint-area">\n                            <div class="arrow-lt"></div>\n                            <div class="b-t"></div>\n                            <div class="b-r"></div>\n                            <div class="b-b"></div>\n                            <div class="b-l"></div>\n                            <div class="arrow-rb"></div>\n                        </div>\n                        <div class="b-t-l"></div>\n                        <div class="b-b-r"></div>\n                    </div>\n                    <div class="arrow"></div>\n                </div>\n            </div>\n        ',this._$container.querySelector(".arrow-rb").after(this._label),this._viewer.cesiumWidget.container.appendChild(this._$container)}_addPostRender(){this._viewer.scene.postRender.addEventListener(this._postRender,this)}_postRender(){if(!this._$container)return;const e=this._viewer.scene.canvas.height,t=new n.Cartesian2;n.SceneTransforms.wgs84ToWindowCoordinates(this._viewer.scene,this._position,t),this._$container.style.position="absolute",this._$container.style.bottom=e-t.y+"px",this._$container.style.left=t.x+"px",this._viewer.camera.positionCartographic.height>14e3?this._$container.style.display="none":this._$container.style.display="block"}},ErectLabelPoint:class{constructor(e,t,i){this._position=t,this._viewer=e,this._label=i,this._$container=document.createElement("div")}init(){this._addDom(),this._addPostRender()}remove(){this._viewer.scene.postRender.removeEventListener(this._postRender,this),this._viewer.cesiumWidget.container.removeChild(this._$container)}getPosition(){return this._position}_addDom(){this._$container.classList.add("is-shulie");let e=document.createElement("div");e.appendChild(this._label),e.classList.add("is-shulie-item"),this._$container.appendChild(e);let t=document.createElement("div");t.classList.add("pre-topCard-list-item-line"),this._$container.appendChild(t);let i=document.createElement("div");i.classList.add("pre-topCard-list-item-circle"),this._$container.appendChild(i),this._viewer.cesiumWidget.container.appendChild(this._$container)}_addPostRender(){this._viewer.scene.postRender.addEventListener(this._postRender,this)}_postRender(){if(!this._$container)return;if(!this._position)return;const e=this._viewer.scene.canvas.height,t=new n.Cartesian2;n.SceneTransforms.wgs84ToWindowCoordinates(this._viewer.scene,this._position,t),this._$container.style.bottom=e-t.y+10+"px";const i=this._$container.offsetWidth;this._$container.style.left=t.x-i/2+"px",this._viewer.camera.positionCartographic.height>4e3?this._$container.style.display="none":this._$container.style.display="block"}},GradientLabelPoint:class{constructor(e,t,i){this._position=t,this._viewer=e,this._label=i,this._$container=document.createElement("div")}init(){this._addDom(),this._addPostRender()}remove(){this._viewer.scene.postRender.removeEventListener(this._postRender,this),this._viewer.cesiumWidget.container.removeChild(this._$container)}getPosition(){return this._position}_addDom(){this._$container.classList.add("gradient-label");let e=document.createElement("div");e.appendChild(this._label),this._$container.appendChild(e),this._viewer.cesiumWidget.container.appendChild(this._$container)}_addPostRender(){this._viewer.scene.postRender.addEventListener(this._postRender,this)}_postRender(){if(!this._$container)return;if(!this._position)return;const e=this._viewer.scene.canvas.height,t=new n.Cartesian2;n.SceneTransforms.wgs84ToWindowCoordinates(this._viewer.scene,this._position,t),this._$container.style.bottom=e-t.y+60+"px";const i=this._$container.offsetWidth;this._$container.style.left=t.x-i/2+"px",this._viewer.camera.positionCartographic.height>4e3?this._$container.style.display="none":this._$container.style.display="block"}},HlsVideoWindow:class{constructor(e,t){this.viewer=e,this.position=n.Cartographic.fromDegrees(t.position.longitude,t.position.latitude),this.videoInfo=t,this.isDestroyWindow=!1,this.screenEvent=T.screenEvent}async load(){let e=this;await R.sleep(200);let t=await ce.getTerrainMostDetailedHeightArea(e.videoInfo.position,1);this.position=n.Cartographic.fromDegrees(e.videoInfo.position.longitude,e.videoInfo.position.latitude,t),e.entity=e.viewer.entities.add({id:e.videoInfo.id,name:e.videoInfo.name,position:n.Cartesian3.fromDegrees(e.videoInfo.position.longitude,e.videoInfo.position.latitude,t),billboard:{image:"https://vge-earth.oss-cn-beijing.aliyuncs.com/sdk/img/marker/bluecamera.png",scaleByDistance:new n.NearFarScalar(500,1,1200,.8),distanceDisplayCondition:new n.DistanceDisplayCondition(0,1e4),verticalOrigin:n.VerticalOrigin.BOTTOM}}),e.screenEvent.addEventListener("left",e.clickEntity.bind(e))}clickEntity(e){let t=e.id.id;this.videoInfo.id===t&&this.init()}init(){this.closeWindow(),this.createDom(),this.addEvent(),this.isDestroyWindow=!1}createDom(){let e=document.createElement("div");e.classList.add("video-popup3d-container");let t=document.createElement("div");t.classList.add("video-popup3d-header"),e.appendChild(t);let i=document.createElement("span");i.innerHTML=this.videoInfo.name,i.classList.add("video-popup3d-header-title"),t.appendChild(i);let n=document.createElement("span");n.innerHTML="×",n.classList.add("video-popup3d-close"),t.appendChild(n);let o=document.createElement("div");o.classList.add("video-popup3d-body"),e.appendChild(o),this.containerDom=e,this.popup3dDom=o,this.viewer.cesiumWidget.container.append(e),n.onclick=e=>{this.closeWindow()},this.createVideo()}createVideo(){let e=document.createElement("video");e.classList.add("video-js"),e.classList.add("vjs-default-skin"),e.setAttribute("controls",String(!0)),e.setAttribute("autoplay","autoplay"),e.setAttribute("preload","auto"),e.setAttribute("muted",String(!0)),this.popup3dDom.appendChild(e);let t="vid"+(new Date).getTime();e.setAttribute("id",t);let i=s(t);i.ready((()=>{let e=[{src:this.videoInfo.url,type:"application/x-mpegURL"}];i.src(e),i.load()})),this.player=i}addEvent(){this.viewer.scene.postRender.addEventListener(this.postRenderEvent,this)}postRenderEvent(){let e=this;const t=this.viewer.scene.canvas.height,i=new n.Cartesian2;n.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,n.Cartesian3.fromDegrees(e.videoInfo.position.longitude,e.videoInfo.position.latitude,e.position.height),i),this.containerDom.style.bottom=t-i.y+80+"px",this.containerDom.style.left=i.x+20+"px"}closeWindow(){this.isDestroyWindow||(this.player&&this.player.dispose(),this.viewer.scene.postRender.removeEventListener(this.postRenderEvent,this),this.containerDom&&this.containerDom.remove(),this.isDestroyWindow=!0)}destroy(){this.closeWindow(),this.viewer.entities.remove(this.entity)}},HotSpotBoard:class{constructor(e,t,i){this._position=t,this._viewer=e,this._label=i,this._$container=document.createElement("div")}init(){this._addDom(),this._addPostRender()}remove(){this._$container.remove(),this._viewer.scene.postRender.removeEventListener(this._postRender,this)}getPosition(){return this._position}_addDom(){this._$container.innerHTML='<div class="hot-spot">\n            <div class="hot-spot-board hot-spot-board-medium"></div>\n            <div class="hot-spot-line hot-spot-line-medium"></div>\n        </div>';let e=this._$container.querySelector(".hot-spot"),t=this._$container.querySelector(".hot-spot-board");t.appendChild(this._label),this._viewer.cesiumWidget.container.appendChild(this._$container),e.style.backgroundImage=`url(${i(8658)})`,t.style.backgroundImage=`url(${i(4655)})`,this._$container.onmouseover=n=>{e.style.backgroundImage=`url(${i(3639)})`,t.style.backgroundImage=`url(${i(230)})`},this._$container.onmouseout=n=>{e.style.backgroundImage=`url(${i(8658)})`,t.style.backgroundImage=`url(${i(4655)})`}}_addPostRender(){this._viewer.scene.postRender.addEventListener(this._postRender,this)}_postRender(){if(!this._$container)return;const e=this._viewer.scene.canvas.height,t=new n.Cartesian2;n.SceneTransforms.wgs84ToWindowCoordinates(this._viewer.scene,this._position,t),this._$container.style.position="absolute",this._$container.style.bottom=e-t.y+"px";const i=this._$container.offsetWidth;this._$container.style.left=t.x-i/2+"px",this._viewer.camera.positionCartographic.height>5e3?this._$container.style.display="none":this._$container.style.display="block"}},SimpleLabel:class{constructor(e,t,i){this.viewer=e,this.option=i,this.isDestroyWindow=!1,this.windowDom=document.createElement("div"),this.containerDom=t||document.createElement("div")}async initWindow(){let e=this;await R.sleep(1e3),e.option.height=await ce.getTerrainMostDetailedHeightArea({longitude:e.option.longitude,latitude:e.option.latitude},1),this.isDestroyWindow=!1,this.createDom(),this.addEvent()}destroyWindow(){this.isDestroyWindow||(this.viewer.scene.postRender.removeEventListener(this.postRenderEvent,this),this.windowDom.innerHTML="",this.windowDom.remove(),this.isDestroyWindow=!0)}createDom(){this.windowDom.classList.add("point-sample-label-container");let e=document.createElement("div");e.classList.add("point-sample-label-text"),e.appendChild(this.containerDom),this.windowDom.appendChild(e);let t=document.createElement("div");t.classList.add("point-sample-label-closeBtn"),t.innerHTML="×",t.addEventListener("click",this.destroyWindow.bind(this),!1),this.windowDom.appendChild(t),this.viewer.cesiumWidget.container.appendChild(this.windowDom)}addEvent(){this.viewer.scene.postRender.addEventListener(this.postRenderEvent,this)}postRenderEvent(){let e=this;const t=this.viewer.scene.canvas.height,i=new n.Cartesian2;n.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,n.Cartesian3.fromDegrees(e.option.longitude,e.option.latitude,e.option.height),i),this.windowDom.style.bottom=t-i.y+80+"px",this.windowDom.style.left=i.x+20+"px"}},WaterPolygon:class{constructor(e,t){let i=this;this.viewer=e,this.collection=new n.PrimitiveCollection,this.geoJsonUrl=t,this.geoJson={type:"Feature"},_.getJson(i.geoJsonUrl,null).then((e=>{i.geoJson=e,i.reLoad()}))}reLoad(){let e=this;e.collection.removeAll(),e.geoJson.features.map((t=>{let i=t.geometry.coordinates[0],o=[];i.map((e=>{o.push(n.Cartesian3.fromDegrees(e[0],e[1],0))}));let r=new Ye(o,{baseWaterColor:new n.Color(0,.2941177,.2078431,.8),normalMap:"./waterNormalsSmall.jpg",frequency:100,animationSpeed:.01,amplitude:2,specularIntensity:10});e.collection.add(r)})),e.viewer.scene.primitives.add(e.collection)}destroy(){this.viewer.scene.primitives.remove(this.collection)}},DeviceStatusWindow:class{constructor(e,t,i){this.viewer=e,this.position=t,this.infos=i,this.createDom(),e.cesiumWidget.container.appendChild(this.container),this.addPostRender()}createDom(){this.container=document.createElement("div"),this.container.classList.add("device-status-container"),this.infos.status?this.container.classList.add("device-status-container-green"):this.container.classList.add("device-status-container-yellow");let e=document.createElement("div");e.classList.add("device-title"),this.container.appendChild(e),e.innerHTML=this.infos.title;let t=document.createElement("div");t.classList.add("device-name"),t.innerHTML=this.infos.name,this.container.appendChild(t),t.innerHTML="\n        <span>设备名称：</span>\n        <span>"+this.infos.name+"</span>";let i=document.createElement("div");i.classList.add("device-num"),i.innerHTML=this.infos.num,this.container.appendChild(i),i.innerHTML="\n        <span>设备编号：</span>\n        <span>"+this.infos.num+"</span>";let n=document.createElement("div");n.classList.add("device-status"),this.container.appendChild(n);let o=document.createElement("span");o.innerHTML="设备状态：",n.appendChild(o);let r=document.createElement("span");r.innerHTML=this.infos.status?"在线":"离线",n.appendChild(r),this.infos.status?r.classList.add("device-status-t1"):r.classList.add("device-status-t0")}addPostRender(){this.viewer.scene.postRender.addEventListener(this.postRender,this)}postRender(){if(!this.container||!this.container.style)return;const e=this.viewer.scene.canvas.height,t=new n.Cartesian2;n.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,this.position,t),this.container.style.position="absolute",this.container.style.bottom=e-t.y+60+"px",this.container.scrollWidth,this.container.style.left=t.x-10+"px"}close(){this.container.remove(),this.viewer.scene.postRender.removeEventListener(this.postRender,this)}},LeafletPopup:class{constructor(e,t,i,n){this.viewer=e,this.position=t,this.fields=i,this.values=n,this.init()}init(){this.createDom(),this.addEvent()}createDom(){let e=document.createElement("div");e.classList.add("leaflet-popup-container");let t=document.createElement("span");t.innerHTML="×",t.classList.add("leaflet-popup-close-button"),e.appendChild(t);let i=document.createElement("div");i.classList.add("leaflet-popup-content-wrapper"),e.appendChild(i),this.createContent(i);let n=document.createElement("div");n.classList.add("leaflet-popup-tip-container"),e.appendChild(n);let o=document.createElement("div");o.classList.add("leaflet-popup-tip"),n.appendChild(o),this.$container=e,this.$body=i,this.viewer.cesiumWidget.container.append(e),t.onclick=e=>{this.close()}}createContent(e){let t="";for(let e=0;e<this.values.length;e++)t+=`\n                <tr>\n                  <td><label style="color:#e0f102;">${this.fields[e]}</label>：${this.values[e]}</td>\n                </tr>`;let i=` <table>${t}</table> `;e.innerHTML=i}addEvent(){this.viewer.scene.postRender.addEventListener(this.postRenderEvent,this)}postRenderEvent(){const e=this.viewer.scene.canvas.height,t=new n.Cartesian2;n.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,this.position,t),this.$container.style.bottom=e-t.y+30+"px";const i=this.$container.offsetWidth;this.$container.style.left=t.x-i/2+"px",this.viewer.camera.positionCartographic.height>4e3?this.$container.style.display="none":this.$container.style.display="block"}close(){this.viewer.scene.postRender.removeEventListener(this.postRenderEvent,this),this.$container.remove()}},MultFieldAdaptWindow:class{constructor(e,t,i,n,o){if(!Array.isArray(n)||!Array.isArray(o))throw"字段和值必须为数组类型";if(n.length!=o.length)throw"字段和值数组长度不一致！";this.viewer=e,this.position=t,this.title=i,this.fields=n,this.values=o,this.createDom(),e.cesiumWidget.container.appendChild(this.container),this.initDom(),this.initEvent(),this.addPostRender()}createDom(){this.container=document.createElement("div"),this.container.innerHTML='  <div class="MultiFieldAdaptWindow-container" v-if="show">\n          <div class="MultiFieldAdaptWindow-header">\n            <span class="MultiFieldAdaptWindow-title">  '+this.title+'</span>\n            <span class="MultiFieldAdaptWindow-close" title="关闭"  >×</span>\n          </div>\n          <div class="MultiFieldAdaptWindow-body">\n           \x3c!-- <div v-for="(field,index) in fields" :key="index" class="MultiFieldAdaptWindow-info-item">\n              <span class="MultiFieldAdaptWindow-ifno-label" :style="getFieldStyle()">{{field}}：</span>\n              <span class="MultiFieldAdaptWindow-ifno-text">{{formatValue(values[index])}}</span>\n            </div>--\x3e\n          </div>\n        </div>'}initDom(){for(let e=0;e<this.values.length;e++){let t=document.createElement("div");t.classList.add("MultiFieldAdaptWindow-info-item");let i=document.createElement("span");i.classList.add("MultiFieldAdaptWindow-ifno-label"),i.innerHTML=this.fields[e]+"：",t.appendChild(i),i=document.createElement("span"),i.classList.add("MultiFieldAdaptWindow-ifno-text"),i.innerHTML=this.values[e],t.appendChild(i),this.container.getElementsByClassName("MultiFieldAdaptWindow-body")[0].appendChild(t)}}initEvent(){this.container.getElementsByClassName("MultiFieldAdaptWindow-close")[0].onclick=e=>{this.close()}}addPostRender(){this.viewer.scene.postRender.addEventListener(this.postRender,this)}postRender(){if(!this.container||!this.container.style)return;const e=this.viewer.scene.canvas.height,t=new n.Cartesian2;n.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,this.position,t),this.container.style.position="absolute",this.container.style.bottom=e-t.y+80+"px";const i=this.container.scrollWidth;this.container.style.left=t.x-i/2+"px"}close(){this.container.remove(),this.viewer.scene.postRender.removeEventListener(this.postRender,this)}},PopupWindow1:class{constructor(e,t,i,n){this.viewer=e,this.position=t,this.title=i,this.html=n,this.createDom(),e.cesiumWidget.container.appendChild(this.container),this.initEvent(),this.addPostRender()}createDom(){this.container=document.createElement("div"),this.container.innerHTML='  <div class="popup3d1-container" v-if="show">\n          <div class="popup3d1-header">\n            <span class="popup3d1-header-title">  '+this.title+'</span>\n            <span class="popup3d1-close" title="关闭"  >×</span>\n          </div>\n          <div class="popup3d1-body">\n          '+this.html||0}initEvent(){this.container.getElementsByClassName("popup3d1-close")[0].onclick=e=>{this.close()}}addPostRender(){this.viewer.scene.postRender.addEventListener(this.postRender,this)}postRender(){if(!this.container||!this.container.style)return;const e=this.viewer.scene.canvas.height,t=new n.Cartesian2;n.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,this.position,t),this.container.style.position="absolute",this.container.style.bottom=e-t.y+80+"px",this.container.scrollWidth,this.container.style.left=t.x-170+"px"}close(){this.container.remove(),this.viewer.scene.postRender.removeEventListener(this.postRender,this)}},PopupWindow2:class{constructor(e,t,i,n){this.viewer=e,this.position=t,this.title=i,this.html=n,this.createDom(),e.cesiumWidget.container.appendChild(this.container),this.initEvent(),this.addPostRender()}createDom(){this.container=document.createElement("div"),this.container.innerHTML='  <div class="popup3d2-container" v-if="show">\n        <div class="popup3d2-header">\n        <span class="popup3d2-title">  '+this.title+'</span>\n        <span class="popup3d2-close" title="关闭"  >×</span>\n        </div>\n        <div class="popup3d1-body">\n        '+this.html||0}initEvent(){this.container.getElementsByClassName("popup3d2-close")[0].onclick=e=>{this.close()}}addPostRender(){this.viewer.scene.postRender.addEventListener(this.postRender,this)}postRender(){if(!this.container||!this.container.style)return;const e=this.viewer.scene.canvas.height,t=new n.Cartesian2;n.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,this.position,t),this.container.style.position="absolute",this.container.style.bottom=e-t.y+80+"px",this.container.style.left=t.x+30+"px",this.viewer.camera.positionCartographic.height>4e3?this.container.style.display="none":this.container.style.display="block"}close(){this.container.remove(),this.viewer.scene.postRender.removeEventListener(this.postRender,this)}},FloatMarker:class{constructor(e,t,i){this.position=t,this.viewer=e;let o=n.Cartographic.fromCartesian(t);this.lng=n.Math.toDegrees(o.longitude),this.lat=n.Math.toDegrees(o.latitude),this.height=o.height,this.style=i||{image:"../../../../../Src/sdk/img/marker/float.png",lineHeight:16,bounceHeight:1,increment:.008},this._add()}init(){this._add()}_add(){let e=this.height+this.style.lineHeight,t=e,i=!0,o=e+this.style.bounceHeight;this.floatMarker=this.viewer.entities.add({position:new n.CallbackProperty((r=>(i?(t+=this.style.increment,t>o&&(i=!1)):(t-=this.style.increment,t<e&&(i=!0)),n.Cartesian3.fromDegrees(this.lng,this.lat,t)))),billboard:{image:this.style.image,height:78,width:42,distanceDisplayCondition:new n.DistanceDisplayCondition(0,2e3)}}),this.line=this.viewer.entities.add({polyline:{positions:n.Cartesian3.fromDegreesArrayHeights([this.lng,this.lat,this.height,this.lng,this.lat,e]),material:new n.PolylineDashMaterialProperty({color:n.Color.AQUA}),width:2,distanceDisplayCondition:new n.DistanceDisplayCondition(0,2e3)}})}remove(){this.viewer.entities.remove(this.floatMarker),this.viewer.entities.remove(this.line)}},Liquidfill:class{constructor(e,t,i,n){this.viewer=e,this.position=t,this.option=n,this.domId="liquidfill_"+(new Date).getTime(),this.container=document.createElement("div"),this._addDom(),this.initChart(),this._addPostRender()}init(){this._addDom(),this._addPostRender(),this.initChart(),this.getOption()}getPosition(){return this.position}_addPostRender(){this.viewer.scene.postRender.addEventListener(this._postRender,this)}_postRender(){if(!this.container||!this.container.style)return;if(!this.position)return;const e=this.viewer.scene.canvas.height,t=new n.Cartesian2;n.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,this.position,t),this.container.style.bottom=e-t.y+10+"px";const i=this.container.offsetWidth;this.container.style.left=t.x-i/2+"px",this.viewer.camera.positionCartographic.height>1e3?this.container.style.display="none":this.container.style.display="block"}remove(){this.viewer.scene.postRender.removeEventListener(this._postRender,this),this.chart.dispose(),this.viewer.cesiumWidget.container.removeChild(this.container)}_addDom(){this.container=document.createElement("div"),this.container.style.cssText="position:absolute;height:80px;width:80px;pointer-events:none",this.container.setAttribute("id",this.domId),this.viewer.cesiumWidget.container.appendChild(this.container)}initChart(){this.chart=echarts.init(this.container),this.option||(this.option=this.getOption()),this.chart.setOption(this.option)}getOption(){return{series:[{type:"liquidFill",data:[.51],radius:"90%",outline:{show:!1},label:{position:["50%","65%"],textStyle:{fontSize:15,fontFamily:"Lobster Two"}},itemStyle:{color:"#ff9501"}}]}}},DynamicDivLabel:class{constructor(e,t,i){this.position=t,this.viewer=e,this.$label=i,this.label=i,this.$container=document.createElement("div"),this._addDom(),this.viewer.cesiumWidget.container.appendChild(this.$container),this._addPostRender()}init(){this._addDom(),this._addPoint(),this._addPostRender()}_addDom(){this.$container.classList.add("dynamic-divlabel-container"),this.$container.classList.add("dynamic-divlabel-container1"),this.$body=document.createElement("div"),this.$body.classList.add("sz-component-animate-marker__boder"),this.$label=document.createElement("span"),this.$label.classList.add("sz-component-animate-marker__text"),this.$label.innerHTML=this.label,this.$body.appendChild(this.$label),this.$container.appendChild(this.$body)}_addPoint(){this.viewer.entities.add({position:this.position,point:new n.PointGraphics({pixelSize:10,color:n.Color.RED,verticalOrigin:n.VerticalOrigin.BOTTOM})})}_addPostRender(){this.viewer.scene.postRender.addEventListener(this._postRender,this)}_postRender(){if(!this.$container||!this.$container.style)return;const e=this.viewer.scene.canvas.height,t=new n.Cartesian2;n.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,this.position,t);const i=this.$container.firstChild.offsetHeight;this.$container.style.bottom=e-t.y+i+"px";const o=this.$container.firstChild.offsetWidth;this.$container.style.left=t.x-o/2+"px",this.viewer.camera.positionCartographic.height>14e3?this.$container.style.display="none":this.$container.style.display="block"}remove(){this.$container.remove(),this.viewer.scene.postRender.removeEventListener(this._postRender,this)}},PrimitiveLabelCol:class{constructor(e,t,i,o){this.viewer=e,this.labels=i,this.billboards=o,this.billboards=this.viewer.scene.primitives.add(new n.BillboardCollection),this.labels=this.viewer.scene.primitives.add(new n.LabelCollection),this.position=t}init(){this._add(),this.addBillboard(),this.addLabel()}_add(e,t,i){this.addBillboard(e,i),this.addLabel(e,t)}addBillboard(e,t){this.billboards.add({position:e,image:t,scale:.6,verticalOrigin:n.VerticalOrigin.BOTTOM,scaleByDistance:new n.NearFarScalar(5e4,1,1e6,.4)})}addLabel(e,t){this.labels.add({position:e,text:t,fillColor:n.Color.WHITE,scale:.4,font:"normal 40px MicroSoft YaHei",distanceDisplayCondition:new n.DistanceDisplayCondition(0,5e5),scaleByDistance:new n.NearFarScalar(5e4,1,1e6,.4),verticalOrigin:n.VerticalOrigin.BOTTOM,style:n.LabelStyle.FILL_AND_OUTLINE,pixelOffset:new n.Cartesian2(14,-4),outlineWidth:20,outlineColor:n.Color.BLACK})}remove(){this.viewer.scene.primitives.remove(this.billboards),this.viewer.scene.primitives.remove(this.labels)}}};var Qe={Material:Ze,NormalEntity:$e,SuperiorEntity:Je,EntityFactory:pe},Xe={KeyboardCamera:class{constructor(e){this.viewer=e,this.initKeyEvent(),this.isActivate=!0}activate(){this.isActivate=!0}initKeyEvent(){let e=this.viewer.canvas;e.setAttribute("tabindex","0"),e.focus(),e.onclick=function(){e.focus()};let t={};e.addEventListener("keydown",(e=>{this.changeFlagForKeyCode(e.keyCode,t,!0)}),!1),e.addEventListener("keyup",(e=>{this.changeFlagForKeyCode(e.keyCode,t,!1)}),!1);let i=this.viewer.camera,n=this.viewer.scene.globe.ellipsoid;this.viewer.clock.onTick.addEventListener((e=>{this.isActivate&&this.setCamera(t,i,n)}))}setCamera(e,t,i){let n=i.cartesianToCartographic(t.position).height/100;e.moveForward&&t.moveForward(n),e.moveBackward&&t.moveBackward(n),e.moveUp&&t.moveUp(n),e.moveDown&&t.moveDown(n),e.moveLeft&&t.moveLeft(n),e.moveRight&&t.moveRight(n)}changeFlagForKeyCode(e,t,i){switch(e){case"W".charCodeAt(0):return void(t.moveForward=i);case"S".charCodeAt(0):return void(t.moveBackward=i);case"Q".charCodeAt(0):return void(t.moveUp=i);case"E".charCodeAt(0):return void(t.moveDown=i);case"D".charCodeAt(0):return void(t.moveRight=i);case"A".charCodeAt(0):return void(t.moveLeft=i);default:return}}deactivate(){this.isActivate=!1}},KeyboardModel:class{constructor(e,t,i){this.viewer=e,this.position=t,this.modelUrl=i.modelUrl,this.enable=!1,this.options=i,this.radian=n.Math.toRadians(i.angle||1),this.speed=i.speed||1,this.speedVector=new n.Cartesian3,this.flag={moveUp:!1,moveDown:!1,moveLeft:!1,moveRight:!1}}activate(){let e=this.viewer.canvas;e.setAttribute("tabindex","0"),e.focus(),this.enable||(this.hpRoll=new n.HeadingPitchRoll,this.fixedFrameTransforms=n.Transforms.localFrameToFixedFrameGenerator("north","west"),this.addModelPrimitive(),this.registerEvens(),this.enable=!0)}addModelPrimitive(){this.moveModel=this.viewer.scene.primitives.add(n.Model.fromGltf({url:this.modelUrl,modelMatrix:n.Transforms.headingPitchRollToFixedFrame(this.position,this.hpRoll,n.Ellipsoid.WGS84,this.fixedFrameTransforms),scale:this.options.scale,minimumPixelSize:this.options.minimumPixelSize}))}registerEvens(){let e=this.viewer.canvas;e.addEventListener("keydown",(e=>{this.setFlagStatus(e,!0)}),!1),e.addEventListener("keyup",(e=>{this.setFlagStatus(e,!1)}),!1),this.viewer.clock.onTick.addEventListener(this.tickEventHandler,this)}tickEventHandler(){const e=this.flag;let t=this.hpRoll;const i=this.radian;e.moveUp&&(e.moveLeft&&(t.heading-=i),e.moveRight&&(t.heading+=i),this.moveModelByKey(!0)),e.moveDown&&(e.moveLeft&&(t.heading-=i),e.moveRight&&(t.heading+=i),this.moveModelByKey(!1)),!e.moveLeft||e.moveDown||e.moveUp||e.moveRight||(t.heading-=i,n.Transforms.headingPitchRollToFixedFrame(this.position,t,n.Ellipsoid.WGS84,this.fixedFrameTransforms,this.moveModel.modelMatrix)),!e.moveRight||e.moveDown||e.moveUp||e.moveLeft||(t.heading+=i,n.Transforms.headingPitchRollToFixedFrame(this.position,t,n.Ellipsoid.WGS84,this.fixedFrameTransforms,this.moveModel.modelMatrix))}moveModelByKey(e){this.speedVector=e?n.Cartesian3.multiplyByScalar(n.Cartesian3.UNIT_X,this.speed,this.speedVector):n.Cartesian3.multiplyByScalar(n.Cartesian3.UNIT_X,-this.speed,this.speedVector);let t=n.Matrix4.multiplyByPoint(this.moveModel.modelMatrix,this.speedVector,this.position);n.Transforms.headingPitchRollToFixedFrame(t,this.hpRoll,n.Ellipsoid.WGS84,this.fixedFrameTransforms,this.moveModel.modelMatrix)}setFlagStatus(e,t){switch(e.keyCode){case 65:this.flag.moveLeft=t;break;case 87:this.flag.moveUp=t;break;case 68:this.flag.moveRight=t;break;case 83:this.flag.moveDown=t}}deactivate(){this.unRegisterEvents(),this.reomveModelPrimitive(),this.enable=!1}reomveModelPrimitive(){this.viewer.scene.primitives.remove(this.moveModel)}unRegisterEvents(){this.viewer.clock.onTick.removeEventListener(this.tickEventHandler,this)}},KeyboardModelExt:class{constructor(e,t,i){this.viewer=e,this.position=t,this.modelUrl=i.modelUrl,this.options=i,this.enable=!1,this.radian=n.Math.toRadians(i.angle||1),this.hpRange=new n.HeadingPitchRange,this.speed=i.speed||1,this.speedVector=new n.Cartesian3,this.role=i.role||0,this.aotuPickHeight=i.aotuPickHeight,this.flag={moveUp:!1,moveDown:!1,moveLeft:!1,moveRight:!1}}activate(){let e=this.viewer.canvas;e.setAttribute("tabindex","0"),e.focus(),this.enable||(this.hpRoll=new n.HeadingPitchRoll,this.fixedFrameTransforms=n.Transforms.localFrameToFixedFrameGenerator("north","west"),this.addModelPrimitive(),this.registerEvens(),this.enable=!0)}addModelPrimitive(){this.moveModel=this.viewer.scene.primitives.add(n.Model.fromGltf({url:this.modelUrl,modelMatrix:n.Transforms.headingPitchRollToFixedFrame(this.position,this.hpRoll,n.Ellipsoid.WGS84,this.fixedFrameTransforms),scale:this.options.scale,minimumPixelSize:this.options.minimumPixelSize}))}registerEvens(){let e=this.viewer.canvas;e.addEventListener("keydown",(e=>{this.setFlagStatus(e,!0)}),!1),e.addEventListener("keyup",(e=>{this.setFlagStatus(e,!1)}),!1),this.viewer.clock.onTick.addEventListener(this.tickEventHandler,this)}tickEventHandler(){const e=this.flag;let t=this.hpRoll;const i=this.radian;e.moveUp&&(e.moveLeft&&(t.heading-=i),e.moveRight&&(t.heading+=i),this.moveModelByKey(!0)),e.moveDown&&(e.moveLeft&&(t.heading-=i),e.moveRight&&(t.heading+=i),this.moveModelByKey(!1)),!e.moveLeft||e.moveDown||e.moveUp||e.moveRight||(t.heading-=i,n.Transforms.headingPitchRollToFixedFrame(this.position,t,n.Ellipsoid.WGS84,this.fixedFrameTransforms,this.moveModel.modelMatrix)),!e.moveRight||e.moveDown||e.moveUp||e.moveLeft||(t.heading+=i,n.Transforms.headingPitchRollToFixedFrame(this.position,t,n.Ellipsoid.WGS84,this.fixedFrameTransforms,this.moveModel.modelMatrix)),e.moveLeft||e.moveDown||e.moveUp||e.moveRight?this.lookAt():this.viewer.camera.lookAtTransform(n.Matrix4.IDENTITY)}lookAt(){if(!this.role)return;let e=2*Math.max(this.moveModel.boundingSphere.radius,this.viewer.camera.frustum.near),t=new n.Cartesian3;n.Matrix4.multiplyByPoint(this.moveModel.modelMatrix,t,this.position),this.hpRange.heading=this.hpRoll.heading,this.hpRange.pitch=this.hpRoll.pitch-n.Math.toRadians(30),this.hpRange.range=5*e,this.viewer.camera.lookAt(this.position,this.hpRange)}moveModelByKey(e){this.speedVector=e?n.Cartesian3.multiplyByScalar(n.Cartesian3.UNIT_X,this.speed,this.speedVector):n.Cartesian3.multiplyByScalar(n.Cartesian3.UNIT_X,-this.speed,this.speedVector);let t=n.Matrix4.multiplyByPoint(this.moveModel.modelMatrix,this.speedVector,this.position);this.options.aotuPickHeight&&(t=this.getPositionByHeight(t)),n.Transforms.headingPitchRollToFixedFrame(t,this.hpRoll,n.Ellipsoid.WGS84,this.fixedFrameTransforms,this.moveModel.modelMatrix)}getPositionByHeight(e){let t=n.Cartographic.fromCartesian(e),i=this.viewer.scene.sampleHeight(t,[this.moveModel]);return t.height=i,n.Cartographic.toCartesian(t,n.Ellipsoid.WGS84)}setFlagStatus(e,t){switch(e.keyCode){case 65:this.flag.moveLeft=t;break;case 87:this.flag.moveUp=t;break;case 68:this.flag.moveRight=t;break;case 83:this.flag.moveDown=t}}deactivate(){this.unRegisterEvents(),this.reomveModelPrimitive(),this.enable=!1}reomveModelPrimitive(){this.viewer.scene.primitives.remove(this.moveModel)}unRegisterEvents(){this.viewer.clock.onTick.removeEventListener(this.tickEventHandler,this)}}};function qe(e){return new n.Entity({position:e,point:{pixelSize:5,color:n.Color.RED,outlineColor:n.Color.WHITE,outlineWidth:2}})}var Ke={PI:3.141592653589793,x_pi:52.35987755982988,delta:function(e,t){let i=6378245,n=.006693421622965943,o=this.transformLat(t-105,e-35),r=this.transformLon(t-105,e-35),a=e/180*this.PI,s=Math.sin(a);s=1-n*s*s;let l=Math.sqrt(s);return o=180*o/(i*(1-n)/(s*l)*this.PI),r=180*r/(i/l*Math.cos(a)*this.PI),{lat:o,lon:r}},gcj_encrypt:function(e,t){if(this.outOfChina(e,t))return{lat:e,lon:t};let i=this.delta(e,t);return{lat:e+i.lat,lon:t+i.lon}},gcj_decrypt:function(e,t){if(this.outOfChina(e,t))return{lat:e,lon:t};let i=this.delta(e,t);return{lat:e-i.lat,lon:t-i.lon}},gcj_decrypt_exact:function(e,t){let i,n,o=.01,r=.01,a=e-o,s=t-r,l=e+o,c=t+r,d=0;for(;;){i=(a+l)/2,n=(s+c)/2;let h=this.gcj_encrypt(i,n);if(o=h.lat-e,r=h.lon-t,Math.abs(o)<1e-9&&Math.abs(r)<1e-9)break;if(o>0?l=i:a=i,r>0?c=n:s=n,++d>1e4)break}return{lat:i,lon:n}},bd_encrypt:function(e,t){let i=t,n=e,o=Math.sqrt(i*i+n*n)+2e-5*Math.sin(n*this.x_pi),r=Math.atan2(n,i)+3e-6*Math.cos(i*this.x_pi),a=o*Math.cos(r)+.0065;return{lat:o*Math.sin(r)+.006,lon:a}},bd_decrypt:function(e,t){let i=t-.0065,n=e-.006,o=Math.sqrt(i*i+n*n)-2e-5*Math.sin(n*this.x_pi),r=Math.atan2(n,i)-3e-6*Math.cos(i*this.x_pi),a=o*Math.cos(r);return{lat:o*Math.sin(r),lon:a}},mercator_encrypt:function(e,t){let i=20037508.34*t/180,n=Math.log(Math.tan((90+e)*this.PI/360))/(this.PI/180);return n=20037508.34*n/180,{lat:n,lon:i}},mercator_decrypt:function(e,t){let i=t/20037508.34*180,n=e/20037508.34*180;return n=180/this.PI*(2*Math.atan(Math.exp(n*this.PI/180))-this.PI/2),{lat:n,lon:i}},distance:function(e,t,i,n){let o=Math.cos(e*this.PI/180)*Math.cos(i*this.PI/180)*Math.cos((t-n)*this.PI/180)+Math.sin(e*this.PI/180)*Math.sin(i*this.PI/180);return o>1&&(o=1),o<-1&&(o=-1),6371e3*Math.acos(o)},outOfChina:function(e,t){return t<72.004||t>137.8347||e<.8293||e>55.8271},transformLat:function(e,t){let i=2*e-100+3*t+.2*t*t+.1*e*t+.2*Math.sqrt(Math.abs(e));return i+=2*(20*Math.sin(6*e*this.PI)+20*Math.sin(2*e*this.PI))/3,i+=2*(20*Math.sin(t*this.PI)+40*Math.sin(t/3*this.PI))/3,i+=2*(160*Math.sin(t/12*this.PI)+320*Math.sin(t*this.PI/30))/3,i},transformLon:function(e,t){let i=300+e+2*t+.1*e*e+.1*e*t+.1*Math.sqrt(Math.abs(e));return i+=2*(20*Math.sin(6*e*this.PI)+20*Math.sin(2*e*this.PI))/3,i+=2*(20*Math.sin(e*this.PI)+40*Math.sin(e/3*this.PI))/3,i+=2*(150*Math.sin(e/12*this.PI)+300*Math.sin(e/30*this.PI))/3,i}},et=function(e){let t=Ke.gcj_decrypt(e.latitude,e.longitude);return{longitude:t.lon,latitude:t.lat}},tt=function(e){let t=Ke.gcj_encrypt(e.latitude,e.longitude);return{longitude:t.lon,latitude:t.lat}},it={key:"745ba982f4eb68c773bd0cb3a2e51358",navigation:async function(e,t,i=[],n=[]){let o=tt(e||{longitude:108.46385538126562,latitude:30.7851146657642}),r=o.longitude+","+o.latitude,a=tt(t||{longitude:108.47119096640783,latitude:30.78348048735882}),s=a.longitude+","+a.latitude,l="";(i=i||[{longitude:108.46359783343034,latitude:30.783531080888885}]).forEach((e=>{let t=tt(e);l+=`${t.longitude},${t.latitude};`}));let c="";n.forEach((e=>{e.forEach((e=>{let t=tt(e);c+=`${t.longitude},${t.latitude};`})),c+="|"}));let d=`https://restapi.amap.com/v3/direction/driving?key=${this.key}&output=json&extensions=all&strategy=11&origin=${r}&destination=${s}&waypoints=${l};&avoidpolygons=${c}`,h=(await _.getJson(d,null)).route;return h.origin=et({longitude:h.origin.split(",")[0],latitude:h.origin.split(",")[0],height:0}),h.destination=et({longitude:h.destination.split(",")[0],latitude:h.destination.split(",")[0],height:0}),h.paths.forEach((e=>{e.steps.forEach((e=>{let t=[];t.push(...e.polyline.split(";")),t=t.map((e=>{let t=Ke.gcj_decrypt(1*e.split(",")[1],1*e.split(",")[0]);return{longitude:t.lon,latitude:t.lat}})),e.polyline=t}))})),h},entityNaviLine:function(e=[],t=""){const i=[];return e.forEach((e=>{i.push(e.longitude,e.latitude)})),new n.Entity({id:"路径规划-方案-"+t,name:"路径规划-方案-"+t,polyline:{positions:n.Cartesian3.fromDegreesArray(i),width:15,material:new je.PolylineLinkPulseMaterialProperty({color:n.Color.fromRandom(),duration:2e3}),clampToGround:!0}})},entityAvoidRange:function(e=[]){const t=[];return e.forEach((e=>{t.push(e.longitude,e.latitude)})),new n.Entity({name:"避让区",polygon:{hierarchy:n.Cartesian3.fromDegreesArray(t),material:n.Color.CRIMSON.withAlpha(.4)},polyline:{positions:n.Cartesian3.fromDegreesArray(t),width:2,material:new n.PolylineDashMaterialProperty({color:n.Color.WHITE}),clampToGround:!0}})}},nt=class{constructor(e){this.imgUrl=e;let t=document.createElement("img");this.mv=t,t.src=e,t.style.position="absolute",t.style.left="-100px",t.style.top="-100px",document.body.append(t),document.onmousemove=function(e){e=e||window.event,t.style.left=e.clientX-t.width/2+"px",t.style.top=e.clientY-t.height+"px"}}remove(){document.onmousemove=null,document.body.removeChild(this.mv)}};let ot=i(8465),rt=i(4739),at=i(2015);let st={SurfaceExcavate:class{constructor(e){this.viewer=e}add(e,t){t||(t={}),this.excavateDepth=t.excavateDepth||200,this.bottomImage=t.bottomImage||i(7332),this.sideImage=t.sideImage||i(5094),this.clear(),function(e){let t=[];e.map((e=>{t.push(function(e){let t=n.Cartographic.fromCartesian(e);return[n.Math.toDegrees(t.longitude),n.Math.toDegrees(t.latitude)]}(e))})),t.push(t[0]);let i=r.lineString(t);return r.booleanClockwise(i)}(e)&&(e=e.reverse());let o=function(e){let t=e.length,i=[];for(let o=0;o<t;++o){let r=(o+1)%t,a=n.Cartesian3.add(e[o],e[r],new n.Cartesian3);a=n.Cartesian3.multiplyByScalar(a,.5,a);let s=n.Cartesian3.normalize(a,new n.Cartesian3),l=n.Cartesian3.subtract(e[r],a,new n.Cartesian3);l=n.Cartesian3.normalize(l,l);let c=n.Cartesian3.cross(l,s,new n.Cartesian3);c=n.Cartesian3.normalize(c,c);let d=new n.Plane(c,0),h=n.Plane.getPointDistance(d,a);i.push(new n.ClippingPlane(c,h))}return i}(e);this.viewer.scene.globe.clippingPlanes=new n.ClippingPlaneCollection({planes:o,edgeWidth:1,edgeColor:n.Color.WHITE}),this.addBottomPolygon(e),this.addSideWall(e)}addBottomPolygon(e){this.bottomPolygon=this.viewer.entities.add({polygon:{hierarchy:e,material:this.bottomImage,height:-this.excavateDepth}})}addSideWall(e){e.push(e[0]);let t=new Array(e.length).fill(-this.excavateDepth);this.sideWall=this.viewer.entities.add({wall:{positions:e,minimumHeights:t,material:this.sideImage}})}clear(){this.viewer.scene.globe.clippingPlanes=void 0,this.viewer.entities.remove(this.bottomPolygon),this.viewer.entities.remove(this.sideWall)}},LimitHeight:class{constructor(e,t,i,n){this.viewer=e,this.degreesArray=t,this.height=i,this.style=n||{},this.init()}init(){this.viewer.scene.invertClassification=!0,this.viewer.scene.invertClassificationColor=this.style.color||new n.Color(1,1,1,1),this.addBottomPolygon(),this.addPrimitive()}addBottomPolygon(){this.bottomPolygon=this.viewer.entities.add({polygon:{hierarchy:new n.PolygonHierarchy(n.Cartesian3.fromDegreesArray(this.degreesArray)),height:new n.CallbackProperty((()=>this.height),!1),material:n.Color.YELLOW.withAlpha(.2),outline:!0,outlineColor:n.Color.RED}})}addPrimitive(){let e=this.createGeometry();this.addClassificationPrimitive(e)}setHeight(e){this.height=e||100,this.removePrimitive(),this.addPrimitive()}createGeometry(){return new n.PolygonGeometry({polygonHierarchy:new n.PolygonHierarchy(n.Cartesian3.fromDegreesArray(this.degreesArray)),perPositionHeight:!0,height:this.height,extrudedHeight:2e5})}addClassificationPrimitive(e){this.cPrimitive=this.viewer.scene.primitives.add(new n.ClassificationPrimitive({geometryInstances:new n.GeometryInstance({geometry:n.PolygonGeometry.createGeometry(e),attributes:{color:n.ColorGeometryInstanceAttribute.fromColor(n.Color.RED.withAlpha(.6)),show:new n.ShowGeometryInstanceAttribute(!0)}}),classificationType:n.ClassificationType.CESIUM_3D_TILE,asynchronous:!1}))}removePrimitive(){this.viewer.scene.primitives.remove(this.cPrimitive)}remove(){this.viewer.scene.invertClassification=!1,this.viewer.entities.remove(this.bottomPolygon)}}};var lt=st;let ct,dt=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},ht=function(){function e(e,t){for(let i=0;i<t.length;i++){let n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),ut=function e(t,i,n){null===t&&(t=Function.prototype);let o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){let o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if("value"in o)return o.value;{let e=o.get;if(void 0===e)return;return e.call(n)}},pt=Function;window.mapv&&(ct=function(e){function t(e,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);let r=dt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n));return pt?(r.map=e,r.scene=e.scene,r.dataSet=i,n=n||{},r.init(n),r.argCheck(n),r.initDevicePixelRatio(),r.canvasLayer=o,r.stopAniamation=!1,r.animation=n.animation,r.clickEvent=r.clickEvent.bind(r),r.mousemoveEvent=r.mousemoveEvent.bind(r),r.bindEvent(),r):dt(r)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,mapv.baseLayer),ht(t,[{key:"initDevicePixelRatio",value:function(){this.devicePixelRatio=window.devicePixelRatio||1}},{key:"clickEvent",value:function(e){let i=e.point,n=t.prototype.__proto__||Object.getPrototypeOf(t.prototype);ut(n,"clickEvent",this).call(this,i,e)}},{key:"mousemoveEvent",value:function(e){let i=e.point,n=t.prototype.__proto__||Object.getPrototypeOf(t.prototype);ut(n,"mousemoveEvent",this).call(this,i,e)}},{key:"addAnimatorEvent",value:function(){}},{key:"animatorMovestartEvent",value:function(){let e=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=e.stepsRange.start)}},{key:"animatorMoveendEvent",value:function(){this.isEnabledTime()&&this.animator}},{key:"bindEvent",value:function(){this.options.methods&&(this.options.methods.click,this.options.methods.mousemove)}},{key:"unbindEvent",value:function(){this.map}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"init",value:function(e){this.options=e,this.initDataRange(e),this.context=this.options.context||"2d",this.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex&&this.canvasLayer.setZIndex(this.options.zIndex),this.initAnimator()}},{key:"_canvasUpdate",value:function(e){let t=this.scene;if(this.canvasLayer&&!this.stopAniamation){let i=this.options.animation,n=this.getContext();if(this.isEnabledTime()){if(void 0===e)return void this.clear(n);"2d"===this.context&&(n.save(),n.globalCompositeOperation="destination-out",n.fillStyle="rgba(0, 0, 0, .1)",n.fillRect(0,0,n.canvas.width,n.canvas.height),n.restore())}else this.clear(n);if("2d"===this.context)for(let e in this.options)n[e]=this.options[e];else n.clear(n.COLOR_BUFFER_BIT);let o={transferCoordinate:function(e){let i=[99999,99999],n=Cesium.Cartesian3.fromDegrees(e[0],e[1]);if(!n)return i;let o=t.cartesianToCanvasCoordinates(n);return o?!(t.mode===Cesium.SceneMode.SCENE3D&&Cesium.Cartesian3.angleBetween(t.camera.position,n)>Cesium.Math.toRadians(80))&&[o.x,o.y]:i}};e&&(o.filter=function(t){let n=i.trails||10;return!!(e&&t.time>e-n&&t.time<e)});let r=this.dataSet.get(o);this.processData(r),"m"===this.options.unit&&this.options.size&&(this.options._size=this.options.size);let a=Cesium.SceneTransforms.wgs84ToWindowCoordinates(t,Cesium.Cartesian3.fromDegrees(0,0));this.drawContext(n,new mapv.DataSet(r),this.options,a),this.options.updateCallback&&this.options.updateCallback(e)}}},{key:"updateData",value:function(e,i){if(e){let n=e.get(),o=t.prototype.__proto__||Object.getPrototypeOf(t.prototype);this.dataSet.set(n),ut(o,"update",this).call(this,{options:i})}}},{key:"addData",value:function(e,t){if(e){let i=e.get;this.dataSet.add(i),this.update({options:t})}}},{key:"getData",value:function(){return this.dataSet}},{key:"removeData",value:function(e){if(this.dataSet){let t=this.dataSet.get({filter:function(t){return null==e||"function"!=typeof e||!e(t)}});this.dataSet.set(t),this.update({options:null})}}},{key:"clearData",value:function(){this.dataSet&&(this.dataSet.clear(),this.update({options:null}))}},{key:"draw",value:function(){this.canvasLayer.draw()}},{key:"clear",value:function(e){e&&e.hasOwnProperty("clearRect")&&e.clearRect(0,0,e.canvas.width,e.canvas.height)}},{key:"destroy",value:function(){this.unbindEvent(),this.clear(this.getContext()),this.clearData(),this.animator&&(this.animator.stop(),this.animator=null,this.canvasLayer=null)}}]),t}());var mt=ct;let gt=function(){function e(e,t){for(let i=0;i<t.length;i++){let n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),vt=function(){function e(t,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.map=t,this.scene=t.scene,this.mapvBaseLayer=new mt(t,i,n,this),this.mapVOptions=n,this.initDevicePixelRatio(),this.canvas=this._createCanvas(),this.render=this.render.bind(this),o?(this.container=o,o.appendChild(this.canvas)):(this.container=t.container,this.addInnerContainer()),this.bindEvent(),this._reset()}return gt(e,[{key:"initDevicePixelRatio",value:function(){this.devicePixelRatio=window.devicePixelRatio||1}},{key:"addInnerContainer",value:function(){this.container.appendChild(this.canvas)}},{key:"bindEvent",value:function(){let e=this;this.innerMoveStart=this.moveStartEvent.bind(this),this.innerMoveEnd=this.moveEndEvent.bind(this),this.scene.camera.moveStart.addEventListener(this.innerMoveStart,this),this.scene.camera.moveEnd.addEventListener(this.innerMoveEnd,this);let t=new Cesium.ScreenSpaceEventHandler(this.canvas);t.setInputAction((function(t){e.innerMoveEnd()}),Cesium.ScreenSpaceEventType.LEFT_UP),t.setInputAction((function(t){e.innerMoveEnd()}),Cesium.ScreenSpaceEventType.MIDDLE_UP),this.handler=t}},{key:"unbindEvent",value:function(){this.scene.camera.moveStart.removeEventListener(this.innerMoveStart,this),this.scene.camera.moveEnd.removeEventListener(this.innerMoveEnd,this),this.scene.postRender.removeEventListener(this._reset,this),this.handler&&(this.handler.destroy(),this.handler=null)}},{key:"moveStartEvent",value:function(){this.mapvBaseLayer&&(this.mapvBaseLayer.animatorMovestartEvent(),this.scene.postRender.addEventListener(this._reset,this))}},{key:"moveEndEvent",value:function(){this.scene.postRender.removeEventListener(this._reset,this),this.mapvBaseLayer&&this.mapvBaseLayer.animatorMoveendEvent(),this._reset()}},{key:"zoomStartEvent",value:function(){this._unvisiable()}},{key:"zoomEndEvent",value:function(){this._unvisiable()}},{key:"addData",value:function(e,t){this.mapvBaseLayer&&this.mapvBaseLayer.addData(e,t)}},{key:"updateData",value:function(e,t){this.mapvBaseLayer&&this.mapvBaseLayer.updateData(e,t)}},{key:"getData",value:function(){if(this.mapvBaseLayer)return this.dataSet=this.mapvBaseLayer.getData(),this.dataSet}},{key:"removeData",value:function(e){this.mapvBaseLayer&&this.mapvBaseLayer.removeData(e)}},{key:"removeAllData",value:function(){this.mapvBaseLayer&&this.mapvBaseLayer.clearData()}},{key:"_visiable",value:function(){return this.canvas.style.display="block"}},{key:"_unvisiable",value:function(){return this.canvas.style.display="none"}},{key:"_createCanvas",value:function(){let e=0,t=document.createElement("canvas");t.id=this.mapVOptions.layerid||"mapv"+e++,t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=this.mapVOptions.zIndex||100,t.width=parseInt(this.map.canvas.width),t.height=parseInt(this.map.canvas.height),t.style.width=this.map.canvas.style.width,t.style.height=this.map.canvas.style.height;let i=this.devicePixelRatio;return"2d"===this.mapVOptions.context&&t.getContext(this.mapVOptions.context).scale(i,i),t}},{key:"_reset",value:function(){this.resizeCanvas(),this.fixPosition(),this.onResize(),this.render()}},{key:"draw",value:function(){this._reset()}},{key:"show",value:function(){this._visiable()}},{key:"hide",value:function(){this._unvisiable()}},{key:"destroy",value:function(){this.unbindEvent(),this.remove()}},{key:"remove",value:function(){this.mapvBaseLayer&&(this.removeAllData(),this.mapvBaseLayer.destroy(),this.mapvBaseLayer=void 0,this.canvas.parentElement.removeChild(this.canvas))}},{key:"update",value:function(e){e&&this.updateData(e.data,e.options)}},{key:"resizeCanvas",value:function(){if(this.canvas){let e=this.canvas;e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.width=parseInt(this.map.canvas.width),e.height=parseInt(this.map.canvas.height),e.style.width=this.map.canvas.style.width,e.style.height=this.map.canvas.style.height}}},{key:"fixPosition",value:function(){}},{key:"onResize",value:function(){}},{key:"render",value:function(){this.mapvBaseLayer&&this.mapvBaseLayer._canvasUpdate()}}]),e}();var ft=vt;let yt,wt,Ct,bt={EchartsLayer:class{constructor(e,t){this._viewer=e,this.visible=!0,echarts.registerCoordinateSystem("cesium",this.getE3CoordinateSystem(e)),this.createLayer(),this.setChartOption(t)}setChartOption(e){this.chartOption=e,this.setCharts()}setVisible(e){this.box&&this.visible!==e&&(this.box.hidden=!e,this.visible=e,!0===e&&setCharts())}setCharts(){this.visible&&null!=this.chartOption&&"undefined"!=this.chartOption&&(this.chart.setOption(this.chartOption),this.chartOption.animation=!1)}createLayer(){const e=this._viewer.scene;e.canvas.setAttribute("tabIndex",0);const t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.width=e.canvas.width+"px",t.style.height=e.canvas.height+"px",t.style.pointerEvents="none",t.setAttribute("class","echartMap"),this.box=t,this._viewer.container.appendChild(t),this.chart=echarts.init(t),this.startSceneEventListeners()}remove(){this.box.outerHTML="",this.box=null,this.chart=null,this.chartOption=null,this._viewer.scene.postRender.removeEventListener(this.moveHandler,this),this._viewer=void 0}startSceneEventListeners(){this._viewer.scene.postRender.addEventListener(this.moveHandler,this)}moveHandler(){this.visible&&(this.setCharts(),this.chart.resize({width:this._viewer.canvas.width,height:this._viewer.canvas.height}),this.box.hidden=!1)}getE3CoordinateSystem(e){var t=function(e){this._viewer=e,this._mapOffset=[0,0]};return t.create=function(i){i.eachSeries((function(i){"cesium"===i.get("coordinateSystem")&&(i.coordinateSystem=new t(e))}))},t.getDimensionsInfo=function(){return["x","y"]},t.dimensions=["x","y"],t.prototype.dimensions=["x","y"],t.prototype.setMapOffset=function(e){this._mapOffset=e},t.prototype.dataToPoint=function(e){let t=this._viewer.scene,i=[0,0],n=Cesium.Cartesian3.fromDegrees(e[0],e[1]);if(!n)return i;if(t.mode===Cesium.SceneMode.SCENE3D&&Cesium.Cartesian3.angleBetween(t.camera.position,n)>Cesium.Math.toRadians(80))return!1;let o=t.cartesianToCanvasCoordinates(n);return o?[o.x-this._mapOffset[0],o.y-this._mapOffset[1]]:i},t.prototype.pointToData=function(t){let i=this._mapOffset,n=e.scene.globe.ellipsoid,o=new Cesium.cartesian3(t[1]+i[1],t[2]+i[2],0),r=n.cartesianToCartographic(o);return r?[r.lng,r.lat]:[0,0]},t.prototype.getviewerRect=function(){let e=this._viewer.canvas;return new echarts.graphic.BoundingRect(0,0,e.width,e.height)},t.prototype.getRoamTransform=function(){return matrix.create()},t}},MapVLayer:ft};var Et={ArrTool:{removeNoData:e=>e.filter(Boolean),getEleCount:(e,t)=>e.reduce(((e,i)=>i===t?e+1:e),0),difference:(e,t)=>{const i=new Set(t);return e.filter((e=>!i.has(e)))},removeRepeat:e=>[...new Set(e)],filterNonUnique:e=>e.filter((t=>e.indexOf(t)===e.lastIndexOf(t))),without:(e,...t)=>e.filter((e=>!t.includes(e))),removeArrayItem(e,t){let i=0;for(;i<e.length;)e[i]===t?e.splice(i,1):i++;return e},upsetArr(e){let t=e.length;for(;t;){let i=Math.floor(Math.random()*t--);[e[i],e[t]]=[e[t],e[i]]}return e},sumArr:e=>e.reduce(((e,t)=>e+t)),arrayAverage(e){return this.sumArr(e)/e.length},randomOne:e=>e[Math.floor(Math.random()*e.length)],popRandom(e){let t=this.randomOne(e);return this.removeArrayItem(e,t),t}},awaitWrap:e=>e.then((e=>[null,e])).catch((e=>[e,null])),BOMTool:{GetUA:function(){return navigator.userAgent}},ColorTool:{getRandomColor(){const e=[];for(let t=0;t<3;++t){let t=Math.floor(256*Math.random()).toString(16);t=1===t.length?"0"+t:t,e.push(t)}return"#"+e.join("")},hexToRGB(e){const t=3===e.slice(e.startsWith("#")?1:0).length?"#"+(i=e).slice(i.startsWith("#")?1:0).split("").map((e=>e+e)).join(""):e;var i;return`rgb(${parseInt(t.slice(1),16)>>16}, ${(65280&parseInt(t.slice(1),16))>>8}, ${255&parseInt(t.slice(1),16)})`},RGBToHex:(e,t,i)=>((e<<16)+(t<<8)+i).toString(16).padStart(6,"0")},DateTool:{fullFormat(e){let t=null;if(e instanceof Date)t=e;else{if("string"!=typeof e)return null;t=new Date(e)}return`${t.getFullYear()}年 ${t.getMonth()+1}月 ${t.getDate()}日 ${t.getHours()}时 ${t.getMinutes()}分 ${t.getSeconds()}秒 ${t.getMilliseconds()}毫秒`},simpleFormat(e){let t=null;if(e instanceof Date)t=e;else{if("string"!=typeof e)return null;t=new Date(e)}return`${t.getFullYear()}-${t.getMonth()+1} - ${t.getDate()}`},GetDaysOfMonth:(e,t)=>new Date(e,t,0).getDate(),GetWeekOfDay(e,t,i){let n="";switch(new Date(e,t-1,i).getDay()){case 0:n="星期天";break;case 1:n="星期一";break;case 2:n="星期二";break;case 3:n="星期三";break;case 4:n="星期四";break;case 5:n="星期五";break;case 6:n="星期六";break;default:n="输入数据不正确"}return n},ISODateString:e=>{let t=e=>e<10?"0"+e:e;return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"Z"},GetNumOfTheDate(e){let t=new Date(e),i=new Date(t.getTime());return i.setMonth(0),i.setDate(1),(t.getTime()-i.getTime())/864e5},GetDayDiffBetweenDates(e,t){let i=new Date(e),n=new Date(t);return(i.getTime()-n.getTime())/864e5}},GISTool:{viewer:yt,Cesium:wt,turf:Ct,xyzToCartographic(e){let t=[];for(let i=0;i<e.length;i++){let n=yt.scene.globe.ellipsoid,o=new wt.Cartesian3(e[i].x,e[i].y,e[i].z),r=n.cartesianToCartographic(o),a=[wt.Math.toDegrees(r.longitude),wt.Math.toDegrees(r.latitude),r.height];t.push(a)}return t},calcTriangleArea(e,t,i){if(e<0||t<0||i<0)return 0;if(!(e+t>i&&e+i>t&&t+i>e))return 0;if(!(e-t<i&&t-e<i&&e-i<t&&i-e<t&&t-i<e&&i-t<e))return 0;let n=(e+t+i)/2;return Math.sqrt(n*(n-e)*(n-t)*(n-i))},VecAngle(e,t,i,n){let o,r;return o=i-e,r=n-t,this.NormalizeVecAngle(Math.atan2(r,o))},NormalizeVecAngle:e=>e-~~(e/(2*Math.PI))*(2*Math.PI),GeoAlgorithm(e,t){return this.NormalizeVecAngle(t-e)},calcGrid(e,t){let i=Ct.bbox(t);i[0]-=.05,i[1]-=.05,i[2]+=.05,i[3]+=.05;let n=Ct.squareGrid(i,e,{units:"kilometers"}),o=[];console.log(n.features.length),Ct.featureEach(n,(function(e,i){i%100==0&&console.log(i+"/"+n.features.length+"   "+(i/n.features.length*100).toFixed(2)+"%");let r=Ct.center(e),a=Ct.booleanWithin(t,e),s=!Ct.booleanDisjoint(t,e);s&&(e=Ct.intersect(e,t)),e.properties.center={},e.properties.center.lon=r.geometry.coordinates[0],e.properties.center.lat=r.geometry.coordinates[1],(a||s)&&o.push(e)}));let r=Ct.featureCollection(o);wt.GeoJsonDataSource.load(r).then((function(e){yt.dataSources.add(e)})),console.log(JSON.stringify(r))}},HTTPTool:{setCookie:function(e,t,i){let n=new Date;n.setDate(n.getDate()+i),document.cookie=e+"="+t+";expires="+n},getCookie:function(e){let t=document.cookie.split("; ");for(let i=0;i<t.length;i++){let n=t[i].split("=");if(n[0]===e)return n[1]}return""},removeCookie:function(e){this.setCookie(e,"1",-1)},currentURL:()=>window.location.href,isPc:()=>!navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)},MathTool:{calcArr(e){let t=Math.min.apply(null,e),i=Math.max.apply(null,e),n=this.calcAve(e);e.sort((function(e,t){return e-t}));let o=e.length-1,r=Math.floor(o/2);return{arr:e,min:t,max:i,ave:n,median:(e[r]+e[o-r])/2,JenksBreaks:this.getJenksBreaks(e,4)}},calcAve:e=>e.reduce((function(e,t){return e+t})),calcMedian(e){e.sort((function(e,t){return e-t}));let t=e.length-1,i=Math.floor(t/2);return(e[i]+e[t-i])/2},getJenksBreaks:function(e,t){let i=(e=e.map((function(e){return 100*e}))).length;e.sort((function(e,t){return e-t}));let n=[],o=[],r=[];for(let e=0;e<=i;e++){n[e]=[],o[e]=[],r[e]=0;for(let i=0;i<=t;i++)n[e][i]=0,o[e][i]=0}for(let e=1;e<=t;e++){n[1][e]=1,o[1][e]=0;for(let t=2;t<=i;t++)o[t][e]=Number.MAX_VALUE}let a=0;for(let r=2;r<=i;r++){let i=0,s=0,l=0,c=0;for(let d=1;d<=r;d++){c=r-d+1;let h=parseInt(String(e[c-1]));s+=h*h,i+=h,l++,a=s-i*i/l;let u=c-1;if(0!=u)for(let e=2;e<=t;e++)o[r][e]>=a+o[u][e-1]&&(n[r][e]=c,o[r][e]=a+o[u][e-1])}n[r][1]=1,o[r][1]=a}let s=i,l=[];l[t-1]=parseInt(String(e[e.length-1]));for(let i=t;i>=2;i--){let t=parseInt(n[s][i])-2;l[i-2]=parseInt(String(e[t])),s=parseInt(String(n[s][i]-1))}return l=l.map((function(e){return e/100})),l},factorial1(e){let t=1;for(let i=1;i<=e;i++)t*=i;return t},fibonacci:e=>Array(e).fill(0).reduce((function(e,t,i){return[...e,i>1?e[i-1]+e[i-2]:i]}),[]).pop(),lcm:(e,t)=>{const i=(e,t)=>t?i(t,e%t):e;return Math.abs(e*t)/i(e,t)},median:e=>{const t=Math.floor(e.length/2),i=e.sort(((e,t)=>e-t));return e.length%2!=0?i[t]:(i[t-1]+i[t])/2},standardDeviation:(e,t=!1)=>{const i=e.reduce(((e,t)=>e+t),0)/e.length;return Math.sqrt(e.reduce(((e,t)=>[].concat(Math.pow(t-i,2))),[]).reduce(((e,t)=>e+t),0)/(e.length-(t?0:1)))},IsPrimeNum(e){for(let t=2;t<=e-1;t++)if(e%t==0)return!1;return!0},spliceNum2(e){let t=0,i=0,n=[],o=e;for(;o=parseInt(String(o/10)),t++,0!=o;);for(let o=t-1;o>=0;o--)i=e%10,e=Math.floor(e/10),n[o]=i;return n},spliceNum3(e){let t=[],i=e.toString().length;for(let n=0;n<i;n++){let i=e%10;if(e=parseInt(String(e/10)),t.push(i),0==e)break}return t.reverse()},TransferTenToOther:(e,t)=>e.toString(parseInt(t)),transfer:(e,t,i)=>parseInt(e+"",t).toString(i),gys(e,t){for(let i=e<t?e:t;i>=1;i--)if(e%i==0&&t%i==0)return i},rnd:(e,t)=>e+Math.random()*(t-e)},SafeTool:{randomString(e){e=e||8;let t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",i=t.length,n="";for(let o=0;o<e;o++)n+=t.charAt(Math.floor(Math.random()*i));return n},generateUUID(){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){let i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?i:7&i|8).toString(16)}))},checkPwd:function(e){let t=0;return e.length<6||(/[0-9]/.test(e)&&t++,/[a-z]/.test(e)&&t++,/[A-Z]/.test(e)&&t++,/[\.|-|_]/.test(e)&&t++),t}},StringTool:{trim(e,t){switch(t){case 1:return e.replace(/\s+/g,"");case 2:return e.replace(/(^\s*)|(\s*$)/g,"");case 3:return e.replace(/(^\s*)/g,"");case 4:return e.replace(/(\s*$)/g,"");default:return e}},changeCase(e,t){switch(t){case 1:return e.replace(/\b\w+\b/g,(function(e){return e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase()}));case 2:return e.replace(/\b\w+\b/g,(function(e){return e.substring(0,1).toLowerCase()+e.substring(1).toUpperCase()}));case 3:return function(e){let t="";return e.split("").forEach((function(e){/^([a-z]+)/.test(e)?t+=e.toUpperCase():/^([A-Z]+)/.test(e)?t+=e.toLowerCase():t+=e})),t}(e);case 4:return e.toUpperCase();case 5:return e.toLowerCase();default:return e}},checkType(e,t){switch(t){case"CardNo":return/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(e);case"email":return/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/.test(e);case"phone":return/^1[3|4|5|7|8][0-9]{9}$/.test(e);case"tel":return/^(0\d{2,3}-\d{7,8})(-\d{1,4})?$/.test(e);case"number":return/^[0-9]$/.test(e);case"english":return/^[a-zA-Z]+$/.test(e);case"text":return/^\w+$/.test(e);case"chinese":return/^[\u4E00-\u9FA5]+$/.test(e);case"lower":return/^[a-z]+$/.test(e);case"upper":return/^[A-Z]+$/.test(e);default:return!0}},countStr:(e,t)=>e.split(t).length-1,illegalFilter:e=>!/[`~!@#$%^&*()_+<>?:"{},.\/;'[\]]/im.test(e)&&!/[·！#￥（——）：；“”‘、，|《。》？、【】[\]]/im.test(e)},Util:{speechSynthesis:e=>{const t=new SpeechSynthesisUtterance(e);t.voice=window.speechSynthesis.getVoices()[0],window.speechSynthesis.speak(t)},timeTaken(e,...t){console.time("函数耗时");const i=e(...t);return console.timeEnd("函数耗时"),i},cloneMap(e){let t=Object.create(null);for(let[i,n]of e)t[i]=n;t=JSON.stringify(t),t=JSON.parse(t);let i=new Map;for(let e of Object.keys(t))i.set(e,t[e]);return i},MapToJson(e){let t={};for(let[i,n]of e)t[i]=n;return t}}};let Tt={Earth:class{constructor(e,t=!0,i={}){this.initMonitorCoordinates=de,m.initRootDom(e),Object.assign(g,i),this.viewer3D=new n.Viewer("viewer3DDom",g),this.viewer3DWorkSpace=new ve(this.viewer3D,M.Viewer3D),O(this.viewer3D),T.viewerEvent.triggerEvent(C.ViewerEventType.init,M.Viewer3D,{}),async function(e,t){e.imageryLayers.removeAll();let i=D.getBaseLayer();t.addData(i),D.getAllSources().forEach((e=>{e.pid!==i.pid&&e.defaultLoad&&"layer"===e.dataType&&t.addData(e)})),await R.sleep(4e3),D.getAllSources().forEach((e=>{e.defaultLoad&&"layer"!==e.dataType&&t.addData(e)}))}(this.viewer3D,this.viewer3DWorkSpace).then((()=>{this.loadComplete=!0})),this.is2D3D=!1,this.loadComplete=!1,window.earth=this}intViewer3DScreenEvent(){let e=this.viewer3D,t=new n.ScreenSpaceEventHandler(e.scene.canvas);for(const e in C.ScreenSpaceEventType)t.setInputAction((function(t){T.screenEvent.triggerEvent(Number(C.ScreenSpaceEventType[e]),M.Viewer3D,t)}),n.ScreenSpaceEventType[e])}openCesiumMapLink23d(){if(!this.viewer2D){let e=new n.Viewer("viewer2DDom",v),t=new ve(e,M.Viewer2D);O(e),this.viewer3D.camera.changed.addEventListener(function(e,t){let i,o;return function(){let r=new n.Cartesian2(Math.floor(e.canvas.clientWidth/2),Math.floor(e.canvas.clientHeight/2)),a=e.scene.camera.pickEllipsoid(r);n.defined(a)&&(i=a),i&&(o=n.Cartesian3.distance(i,e.scene.camera.positionWC),t.scene.camera.lookAt(i,new n.Cartesian3(0,0,o)))}}(this.viewer3D,e)),this.viewer3D.camera.percentageChanged=.01,function(e){let t=document.getElementById("viewer2DDom");t&&(t.style.display="none"),e.scene.screenSpaceCameraController.enableRotate=!1,e.scene.screenSpaceCameraController.enableTranslate=!1,e.scene.screenSpaceCameraController.enableZoom=!1,e.scene.screenSpaceCameraController.enableTilt=!1,e.scene.screenSpaceCameraController.enableLook=!1}(e),async function(e,t){let i=D.getBaseLayer();t.addData(i),D.getAllSources().forEach((e=>{e.pid!==i.pid&&e.defaultLoad&&"layer"===e.dataType&&t.addData(e)}))}(0,t).then(),T.viewerEvent.triggerEvent(C.ViewerEventType.init,M.Viewer2D,{}),this.viewer2DWorkSpace=t,this.viewer2D=e}m.initCesiumMapLink23d()}closeCesiumMapLink23d(){m.closeCesiumMapLink23d()}toggleCesiumMapLink23d(){this.is2D3D?this.closeCesiumMapLink23d():this.openCesiumMapLink23d(),this.is2D3D=!this.is2D3D}openOverviewMap(){m.initOverviewMapDom(),this.viewerOl||(this.viewerOl=he()),this.overviewMap||(this.overviewMap=new oe(this.viewer3D,this.viewerOl))}closeOverviewMap(){this.overviewMap&&(this.overviewMap.destroy(),this.overviewMap=void 0),m.closeOverviewMapDom()}openOLMapLink23d(){m.initMapLink23d(),this.viewerOl||(this.viewerOl=he()),this.linkOLMap23D||(this.linkOLMap23D=new ue(this.viewer3D,this.viewerOl)),this.linkOLMap23D.activate()}closeOLMapLink23d(){this.linkOLMap23D&&(m.closeOLMapLink23d(),this.linkOLMap23D.deactivate())}openDeBug(){H.open()}closeDeBug(){H.close()}createNavigation(){!function(e){!e&&(e=B());let t=D.getConfig(),i={defaultResetView:new n.Cartographic(n.Math.toRadians(t.homeView.lon),n.Math.toRadians(t.homeView.lat),t.homeView.height),enableCompass:!0,enableZoomControls:!0,enableDistanceLegend:!0,enableCompassOuterRing:!0};e.extend(n.viewerCesiumNavigationMixin,i)}(this.viewer3D)}},eventMana:T,HandlerMana:ye,DrawShape:Ae,FlyToWorkspace:ke,TreeMana:class{constructor(e){this.viewer=e,this.customOption={},this.treeNodes=[];let t=this.getConfigSourceList(),i=this.getWorkSourceList(e),n=Le(t);for(const[e,t]of n){let n=!0,o={name:e,open:!1,children:[],checked:!1};o={...o,...this.customOption},t.forEach((e=>{let t=i.find((t=>t.pid===e.pid)),r={id:e.pid,name:e.name,checked:!!t,nodeData:e};r={...r,...this.customOption},o.children.push(r),t||(n=!1)})),o.checked=n,this.treeNodes.push(o)}}getWorkSpace(e){let t=null;return t=e===Re().viewer2D?Re().viewer2DWorkSpace:t,t=e===Re().viewer3D?Re().viewer3DWorkSpace:t,t}getConfigSourceList(){return D.getAllSources()}getWorkSourceList(e){return this.getWorkSpace(e).nodes}getTreeNodeByTree(){let e=$.fn.zTree.getZTreeObj("treeDom").getNodes(),t=this.getConfigSourceList(),i=this.getWorkSourceList(this.viewer),n=Le(t);e=e.filter((e=>{let t=!1;for(const[i,o]of n)i===e.name&&(t=!0);return t}));for(const[t,i]of n)e.find((e=>t===e.name))||e.push({name:t,open:!1,children:[],checked:!1});return e=e.map((e=>(e.children.map((e=>(i.forEach((t=>{let i=!1;e.name,t.name})),e))),e))),e}getSetting(){let e=this.getWorkSpace(this.viewer);return{view:{fontCss:Oe,nameIsHTML:!0},check:{enable:!0,chkboxType:{Y:"ps",N:"ps"}},callback:{onCheck:function(t,i,n){let o=n.checked,r=this.getZTreeObj("treeDom").transformToArray(n);setTimeout((function(){o?r.forEach((t=>{t.children||e.addData(t.nodeData)})):r.forEach((t=>{t.children||e.removeData(t.nodeData)}))}))},onClick:function(t,i,n){n.children||e.flyToData(n.nodeData)}},data:{simpleData:{enable:!0}}}}initTree(e){this.customOption=e;let t=this.getWorkSpace(this.viewer);if(!t)return void console.log("请先初始化 Viewer");let i=setInterval((()=>{t&&(this.buildTree(),T.configEvent.addEventListener(C.ConfigEventType.addData,M.global,(()=>{setTimeout((()=>this.buildTree()),50)})),window.clearInterval(i))}),100)}buildTree(){let e=this.getSetting(),t=this.treeNodes||this.getTreeNodeByTree();$.fn.zTree.init($("#treeDom"),e,t)}},ExpandEntity:Qe,KeyboardDominate:Xe,restMap:function(){},SceneTool:ce,MeasureTool:class{constructor(e){this.viewer=e,this.dataSourceToo=new n.CustomDataSource("测量工具-实体集合"),e.dataSources.add(this.dataSourceToo),this.entityFactory=new pe(e,this.dataSourceToo),this.drawShape=new Ae(e)}CesiumTriangle(){}measureTriangle(){let e=this;e.drawShape.drawTriangle({endCallback:function(t){if(3===t.length){for(let i in t)e.dataSourceToo.entities.add(qe(t[i]));e.dataSourceToo.entities.add(function(e){return new n.Entity({polyline:{positions:e,width:3,clampToGround:!0,arcType:n.ArcType.RHUMB,material:n.Color.GREEN}})}(t));let i=Se.calculateTriangle(t).toFixed(3)+"度";e.dataSourceToo.entities.add(function(e,t){return new n.Entity({position:e,label:{text:t,font:"16pt monospace",color:n.Color.RED,backgroundColor:n.Color.RED,style:n.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,heightReference:n.HeightReference.NONE,verticalOrigin:n.VerticalOrigin.TOP,pixelOffset:new n.Cartesian2(30,-30)}})}(t[1],i))}}})}verticalDistance(){let e=this;e.removeAll();let t,i,o=[],r=null,a=null,{handler:s}=ye.getHandle(e.viewer,(function(){}));s.setInputAction((function(i){a=e.viewer.scene.pickPosition(i.endPosition),n.defined(a)&&o.length>=2&&(n.defined(r)?(o.pop(),o.push(a)):r=new l(o),t=function(e){let t=n.Cartographic.fromCartesian(e[0]);return(n.Cartographic.fromCartesian(e[1]).height-t.height).toFixed(2)}(o))}),n.ScreenSpaceEventType.MOUSE_MOVE),s.setInputAction((function(t){a=e.viewer.scene.pickPosition(t.position),n.defined(a)&&0==o.length&&(o.push(a.clone()),o.push(a),i=e.entityFactory.PointLabelEntity(o[0],"0米"))}),n.ScreenSpaceEventType.LEFT_CLICK),s.setInputAction((function(i){if(s.destroy(),2===o.length){let i=t+"米",s=n.Cartographic.fromCartesian(o[0]),l=n.Cartographic.fromCartesian(o[1]),c=n.Cartesian3.fromDegrees(n.Math.toDegrees(s.longitude),n.Math.toDegrees(s.latitude),l.height);e.entityFactory.PointLabelEntity(c,i),o=[],r=null,t="0米",a=null}}),n.ScreenSpaceEventType.RIGHT_CLICK);class l{constructor(e){this.options={name:"直线",polyline:{show:!0,positions:[],material:n.Color.AQUA,depthFailMaterial:new n.PolylineOutlineMaterialProperty({color:n.Color.RED}),width:2},ellipse:{show:!0,semiMinorAxis:5,semiMajorAxis:5,material:n.Color.GREEN.withAlpha(.7),outline:!0}},this.positions=e,this._init()}_init(){let t=this,i=function(){let e=n.Cartographic.fromCartesian(t.positions[0]),i=n.Cartographic.fromCartesian(t.positions[1]),o=new n.EllipsoidGeodesic;return o.setEndPoints(e,i),o.surfaceDistance};this.options.polyline.positions=new n.CallbackProperty((function(){let e=[];e.push(t.positions[0]);let i=n.Cartographic.fromCartesian(t.positions[0]),o=n.Cartographic.fromCartesian(t.positions[1]),r=n.Cartesian3.fromDegrees(n.Math.toDegrees(i.longitude),n.Math.toDegrees(i.latitude),o.height);return e.push(r),e}),!1),this.options.position=new n.CallbackProperty((function(){return t.positions[0]}),!1),this.options.ellipse.semiMinorAxis=new n.CallbackProperty(i,!1),this.options.ellipse.semiMajorAxis=new n.CallbackProperty(i,!1),this.options.ellipse.height=new n.CallbackProperty((function(){let e=function(e){return n.Cartographic.fromCartesian(e[1]).height.toFixed(2)}(t.positions);return e}),!1),e.dataSourceToo.entities.add(this.options)}}}spaceDistance(){let e=this,t=0;this.drawShape.drawPolyLine({endCallback:function(i){if(i.length>=2){for(let t in i)e.dataSourceToo.entities.add({position:i[t],point:{pixelSize:6,color:n.Color.WHITE}});if(e.dataSourceToo.entities.add({polyline:{positions:i,width:3,clampToGround:!0,arcType:n.ArcType.RHUMB,material:n.Color.GREEN}}),i.length>=2&&i.length-1>t){t++;let n=i[i.length-1],o=i[i.length-2];e.entityFactory.spaceDistanceLabel(n,o)}}},errCallback:function(i){if(i.length>2&&i.length-2>t){t++;let n=i[i.length-2],o=i[i.length-3];e.entityFactory.spaceDistanceLabel(n,o)}}})}measureHeight(){let e=this;e.drawShape.drawPoint({endCallback:function(t){let i=new n.Cartographic.fromCartesian(t[0]),o=(e.viewer.scene.sampleHeight(i)||0).toFixed(3)+" m",r=qe(t[0]),a=e.entityFactory.buildLabel(t[0],o);e.dataSourceToo.entities.add(r),e.dataSourceToo.entities.add(a)}})}surfaceArea(){let e=this;e.viewer,this.drawShape.drawPolygon({endCallback:function(t){if(t.length>3){e.dataSourceToo.entities.add({polygon:{hierarchy:t,material:n.Color.BLUEVIOLET.withAlpha(.5)}});for(let i=0;i<t.length-1;i++)e.dataSourceToo.entities.add({position:t[i],point:{pixelSize:5,color:n.Color.RED,outlineColor:n.Color.WHITE,outlineWidth:2}});let i=[];for(let e=0;e<t.length;e++)i.push(n.Cartographic.fromCartesian(new n.Cartesian3(t[e].x,t[e].y,t[e].z),n.Ellipsoid.WGS84,new n.Cartographic));let o=[];for(let e=0;e<i.length;e++){let t=i[e].longitude/Math.PI*180,n=i[e].latitude/Math.PI*180;o.push([t,n])}let r={type:"Polygon"};r.coordinates=[o],e.entityFactory.polygonCenterLabel(r,"面积")}else console.error("绘制失败")}})}perimeter(){let e=this;e.viewer,this.drawShape.drawPolygon({endCallback:function(t){if(t.length>3){e.dataSourceToo.entities.add({polygon:{hierarchy:t,material:n.Color.BLUEVIOLET.withAlpha(.5)}});for(let i=0;i<t.length-1;i++)e.dataSourceToo.entities.add(qe(t[i]));let i=[];for(let e=0;e<t.length;e++)i.push(n.Cartographic.fromCartesian(new n.Cartesian3(t[e].x,t[e].y,t[e].z),n.Ellipsoid.WGS84,new n.Cartographic));let o=[];for(let e=0;e<i.length;e++){let t=i[e].longitude/Math.PI*180,n=i[e].latitude/Math.PI*180;o.push([t,n])}let r={type:"Polygon"};r.coordinates=[o],e.entityFactory.polygonCenterLabel(r,"周长")}else console.error("绘制失败")}})}profileAnalysis(){}visiableSelectPoint(){}removeAll(){this.dataSourceToo.entities.removeAll()}},PathPlanning:class{constructor(e){this.dataSourceToo=new n.CustomDataSource("路径规划-实体集合"),this.drawShape=new Ae(e),this.startingPointEntity=null,this.endPointEntity=null,this.passPointEntityArr=[],this.avoidRangeEntityArr=[],this.roadEntityArr=[],this.startingPoint={longitude:0,latitude:0,height:0},this.endPoint={longitude:0,latitude:0,height:0},this.passPointArr=[],this.avoidRanges=[],e.dataSources.add(this.dataSourceToo)}takePoint(){return new Promise((e=>{this.drawShape.drawPoint({coordinateType:"cartographicObj",endCallback:t=>{let i=Math.floor(1e6*t[0].longitude)/1e6,n=Math.floor(1e6*t[0].latitude)/1e6;e({longitude:i,latitude:n})},errCallback:()=>{e(null)}})}))}addMarkEntity(e,t,i){return this.dataSourceToo.entities.add(function(e,t,i){let o={param:JSON.stringify(i),position:n.Cartesian3.fromDegrees(e,t),billboard:{image:i.imgUrl,width:void 0,height:void 0,scaleByDistance:new n.NearFarScalar(150,2,15e6,.5),disableDepthTestDistance:Number.POSITIVE_INFINITY,heightReference:n.HeightReference.RELATIVE_TO_GROUND,verticalOrigin:n.VerticalOrigin.BOTTOM}};return i.name&&(o.param=i.name),i.height&&(o.billboard.height=i.height),i.width&&(o.billboard.width=i.width),new n.Entity(o)}(e,t,{imgUrl:i,width:15,height:21}))}async takeStartingPoint(){let e=new nt(ot);this.clearRoads(),this.startingPointEntity&&this.dataSourceToo.entities.remove(this.startingPointEntity);let t=await this.takePoint();t&&(this.startingPoint=t,this.startingPointEntity=this.addMarkEntity(t.longitude,t.latitude,ot)),e.remove()}async takeEndPoint(){let e=new nt(rt);this.clearRoads(),this.endPointEntity&&this.dataSourceToo.entities.remove(this.endPointEntity);let t=await this.takePoint();t&&(this.endPoint=t,this.endPointEntity=this.addMarkEntity(t.longitude,t.latitude,rt)),e.remove()}async takePassPoint(){let e=new nt(at);this.clearRoads();let t=await this.takePoint();t&&(this.passPointArr.push(t),this.passPointEntityArr.push(this.addMarkEntity(t.longitude,t.latitude,at))),e.remove()}async takeAvoidRange(){this.clearRoads(),this.drawShape.drawPolygon({coordinateType:"cartographicObj",endCallback:e=>{this.avoidRanges.push(e);let t=this.dataSourceToo.entities.add(it.entityAvoidRange(e));this.avoidRangeEntityArr.push(t)}})}clearPassPoint(){this.passPointArr=[],this.passPointEntityArr.forEach((e=>{this.dataSourceToo.entities.remove(e)}))}clearAvoidRanges(){this.avoidRanges=[],this.avoidRangeEntityArr.forEach((e=>{this.dataSourceToo.entities.remove(e)}))}clearRoads(){this.roadEntityArr.forEach((e=>{this.dataSourceToo.entities.remove(e)}))}buildPathEntity(e){this.startingPointEntity=this.addMarkEntity(this.startingPoint.longitude,this.startingPoint.latitude,ot),this.endPointEntity=this.addMarkEntity(this.endPoint.longitude,this.endPoint.latitude,rt),this.passPointArr.forEach((e=>this.passPointEntityArr.push(this.addMarkEntity(e.longitude,e.latitude,at)))),this.avoidRanges.forEach((e=>{this.avoidRangeEntityArr.push(this.dataSourceToo.entities.add(it.entityAvoidRange(e)))})),e.paths.forEach(((e,t)=>{let i=[];e.steps.forEach((e=>{i.push(...e.polyline)}));let n=this.dataSourceToo.entities.add(it.entityNaviLine(i,String(t+1)));this.roadEntityArr.push(n)}))}async runNavigation(){let e=await it.navigation(this.startingPoint,this.endPoint,this.passPointArr,this.avoidRanges);this.dataSourceToo.entities.removeAll(),this.buildPathEntity(e)}resetNavigation(){this.clearRoads(),this.clearAvoidRanges(),this.clearPassPoint(),this.clearRoads(),this.avoidRanges=[],this.dataSourceToo.entities.removeAll(),this.startingPointEntity=null,this.endPointEntity=null}},ScreenEvent:E,MotionEntity:me,getMainViewer:B,SpatialAnalysis:lt,ConfigTool:D,Tool:R,ExtDataFormat:bt};window.VGEEarth=Tt,window.YaoDo=Et,console.log(`%cSDK版本：VGEEarth ${D.getConfig().Version}，基于 Cesium ${n.VERSION} `,"color: green;")}()}();