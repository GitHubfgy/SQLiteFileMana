webpackJsonp([3],{"+jGy":function(e,t,i){var n;self,n=function(){return function(){"use strict";var e={d:function(t,i){for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:function(){return a}});let i,n,o,r={ArrTool:{removeNoData:e=>e.filter(Boolean),getEleCount:(e,t)=>e.reduce((e,i)=>i===t?e+1:e,0),difference:(e,t)=>{const i=new Set(t);return e.filter(e=>!i.has(e))},removeRepeat:e=>[...new Set(e)],filterNonUnique:e=>e.filter(t=>e.indexOf(t)===e.lastIndexOf(t)),without:(e,...t)=>e.filter(e=>!t.includes(e)),removeArrayItem(e,t){let i=0;for(;i<e.length;)e[i]===t?e.splice(i,1):i++;return e},upsetArr:e=>e.sort(function(){return Math.random()-.5}),sumArr:e=>e.reduce((e,t)=>e+t),arrayAverage(e){return this.sumArr(e)/e.length},randomOne:e=>e[Math.floor(Math.random()*e.length)],popRandom(e){let t=this.randomOne(e);return this.removeArrayItem(e,t),t}},awaitWrap:e=>e.then(e=>[null,e]).catch(e=>[e,null]),BOMTool:{GetUA:function(){return navigator.userAgent}},ColorTool:{getRandomColor(){const e=[];for(let t=0;t<3;++t){let t=Math.floor(256*Math.random()).toString(16);t=1===t.length?"0"+t:t,e.push(t)}return"#"+e.join("")},hexToRGB(e){const t=3===e.slice(e.startsWith("#")?1:0).length?"#"+(i=e).slice(i.startsWith("#")?1:0).split("").map(e=>e+e).join(""):e;var i;return`rgb(${parseInt(t.slice(1),16)>>16}, ${(65280&parseInt(t.slice(1),16))>>8}, ${255&parseInt(t.slice(1),16)})`},RGBToHex:(e,t,i)=>((e<<16)+(t<<8)+i).toString(16).padStart(6,"0")},DateTool:{fullFormat(e){let t=null;if(e instanceof Date)t=e;else{if("string"!=typeof e)return null;t=new Date(e)}return`${t.getFullYear()}年 ${t.getMonth()+1}月 ${t.getDate()}日 ${t.getHours()}时 ${t.getMinutes()}分 ${t.getSeconds()}秒 ${t.getMilliseconds()}毫秒`},simpleFormat(e){let t=null;if(e instanceof Date)t=e;else{if("string"!=typeof e)return null;t=new Date(e)}return`${t.getFullYear()}-${t.getMonth()+1} - ${t.getDate()}`},GetDaysOfMonth:(e,t)=>new Date(e,t,0).getDate(),GetWeekOfDay(e,t,i){let n="";switch(new Date(e,t-1,i).getDay()){case 0:n="星期天";break;case 1:n="星期一";break;case 2:n="星期二";break;case 3:n="星期三";break;case 4:n="星期四";break;case 5:n="星期五";break;case 6:n="星期六";break;default:n="输入数据不正确"}return n},ISODateString:e=>{let t=e=>e<10?"0"+e:e;return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"Z"},GetNumOfTheDate(e){let t=new Date(e),i=new Date(t.getTime());return i.setMonth(0),i.setDate(1),(t.getTime()-i.getTime())/864e5},GetDayDiffBetweenDates(e,t){let i=new Date(e),n=new Date(t);return(i.getTime()-n.getTime())/864e5}},GISTool:{viewer:i,Cesium:n,turf:o,xyzToCartographic(e){let t=[];for(let o=0;o<e.length;o++){let r=i.scene.globe.ellipsoid,a=new n.Cartesian3(e[o].x,e[o].y,e[o].z),s=r.cartesianToCartographic(a),l=[n.Math.toDegrees(s.longitude),n.Math.toDegrees(s.latitude),s.height];t.push(l)}return t},calcTriangleArea(e,t,i){if(e<0||t<0||i<0)return 0;if(!(e+t>i&&e+i>t&&t+i>e))return 0;if(!(e-t<i&&t-e<i&&e-i<t&&i-e<t&&t-i<e&&i-t<e))return 0;let n=(e+t+i)/2;return Math.sqrt(n*(n-e)*(n-t)*(n-i))},VecAngle(e,t,i,n){let o,r;return o=i-e,r=n-t,this.NormalizeVecAngle(Math.atan2(r,o))},NormalizeVecAngle:e=>e-~~(e/(2*Math.PI))*(2*Math.PI),GeoAlgorithm(e,t){return this.NormalizeVecAngle(t-e)},calcGrid(e,t){let r=o.bbox(t);r[0]-=.05,r[1]-=.05,r[2]+=.05,r[3]+=.05;let a=o.squareGrid(r,e,{units:"kilometers"}),s=[];console.log(a.features.length),o.featureEach(a,function(e,i){i%100==0&&console.log(i+"/"+a.features.length+"   "+(i/a.features.length*100).toFixed(2)+"%");let n=o.center(e),r=o.booleanWithin(t,e),l=!o.booleanDisjoint(t,e);l&&(e=o.intersect(e,t)),e.properties.center={},e.properties.center.lon=n.geometry.coordinates[0],e.properties.center.lat=n.geometry.coordinates[1],(r||l)&&s.push(e)});let l=o.featureCollection(s);n.GeoJsonDataSource.load(l).then(function(e){i.dataSources.add(e)}),console.log(JSON.stringify(l))}},HTTPTool:{setCookie:function(e,t,i){let n=new Date;n.setDate(n.getDate()+i),document.cookie=e+"="+t+";expires="+n},getCookie:function(e){let t=document.cookie.split("; ");for(let i=0;i<t.length;i++){let n=t[i].split("=");if(n[0]===e)return n[1]}return""},removeCookie:function(e){this.setCookie(e,"1",-1)},currentURL:()=>window.location.href,isPc:()=>!navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)},MathTool:{calcArr(e){let t=Math.min.apply(null,e),i=Math.max.apply(null,e),n=this.calcAve(e);e.sort(function(e,t){return e-t});let o=e.length-1,r=Math.floor(o/2);return{arr:e,min:t,max:i,ave:n,median:(e[r]+e[o-r])/2,JenksBreaks:this.getJenksBreaks(e,4)}},calcAve:e=>e.reduce(function(e,t){return e+t}),calcMedian(e){e.sort(function(e,t){return e-t});let t=e.length-1,i=Math.floor(t/2);return(e[i]+e[t-i])/2},getJenksBreaks:function(e,t){let i=(e=e.map(function(e){return 100*e})).length;e.sort(function(e,t){return e-t});let n=[],o=[],r=[];for(let e=0;e<=i;e++){n[e]=[],o[e]=[],r[e]=0;for(let i=0;i<=t;i++)n[e][i]=0,o[e][i]=0}for(let e=1;e<=t;e++){n[1][e]=1,o[1][e]=0;for(let t=2;t<=i;t++)o[t][e]=Number.MAX_VALUE}let a=0;for(let r=2;r<=i;r++){let i=0,s=0,l=0,c=0;for(let d=1;d<=r;d++){c=r-d+1;let u=parseInt(String(e[c-1]));a=(s+=u*u)-(i+=u)*i/++l;let h=c-1;if(0!=h)for(let e=2;e<=t;e++)o[r][e]>=a+o[h][e-1]&&(n[r][e]=c,o[r][e]=a+o[h][e-1])}n[r][1]=1,o[r][1]=a}let s=i,l=[];l[t-1]=parseInt(String(e[e.length-1]));for(let i=t;i>=2;i--){let t=parseInt(n[s][i])-2;l[i-2]=parseInt(String(e[t])),s=parseInt(String(n[s][i]-1))}return l=l.map(function(e){return e/100})},factorial1(e){let t=1;for(let i=1;i<=e;i++)t*=i;return t},fibonacci:e=>Array(e).fill(0).reduce(function(e,t,i){return[...e,i>1?e[i-1]+e[i-2]:i]},[]).pop(),lcm:(e,t)=>{const i=(e,t)=>t?i(t,e%t):e;return Math.abs(e*t)/i(e,t)},median:e=>{const t=Math.floor(e.length/2),i=e.sort((e,t)=>e-t);return e.length%2!=0?i[t]:(i[t-1]+i[t])/2},standardDeviation:(e,t=!1)=>{const i=e.reduce((e,t)=>e+t,0)/e.length;return Math.sqrt(e.reduce((e,t)=>[].concat(Math.pow(t-i,2)),[]).reduce((e,t)=>e+t,0)/(e.length-(t?0:1)))},IsPrimeNum(e){for(let t=2;t<=e-1;t++)if(e%t==0)return!1;return!0},spliceNum2(e){let t=0,i=0,n=[],o=e;for(;t++,0!=(o=parseInt(String(o/10))););for(let o=t-1;o>=0;o--)i=e%10,e=Math.floor(e/10),n[o]=i;return n},spliceNum3(e){let t=[],i=e.toString().length;for(let n=0;n<i;n++){let i=e%10;if(e=parseInt(String(e/10)),t.push(i),0==e)break}return t.reverse()},TransferTenToOther:(e,t)=>e.toString(parseInt(t)),transfer:(e,t,i)=>parseInt(e+"",t).toString(i),gys(e,t){for(let i=e<t?e:t;i>=1;i--)if(e%i==0&&t%i==0)return i},rnd:(e,t)=>e+Math.random()*(t-e)},SafeTool:{randomString(e){e=e||8;let t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",i=t.length,n="";for(let o=0;o<e;o++)n+=t.charAt(Math.floor(Math.random()*i));return n},generateUUID(){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?i:7&i|8).toString(16)})},checkPwd:function(e){let t=0;return e.length<6||(/[0-9]/.test(e)&&t++,/[a-z]/.test(e)&&t++,/[A-Z]/.test(e)&&t++,/[\.|-|_]/.test(e)&&t++),t}},StringTool:{trim(e,t){switch(t){case 1:return e.replace(/\s+/g,"");case 2:return e.replace(/(^\s*)|(\s*$)/g,"");case 3:return e.replace(/(^\s*)/g,"");case 4:return e.replace(/(\s*$)/g,"");default:return e}},changeCase(e,t){switch(t){case 1:return e.replace(/\b\w+\b/g,function(e){return e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase()});case 2:return e.replace(/\b\w+\b/g,function(e){return e.substring(0,1).toLowerCase()+e.substring(1).toUpperCase()});case 3:return function(e){let t="";return e.split("").forEach(function(e){/^([a-z]+)/.test(e)?t+=e.toUpperCase():/^([A-Z]+)/.test(e)?t+=e.toLowerCase():t+=e}),t}(e);case 4:return e.toUpperCase();case 5:return e.toLowerCase();default:return e}},checkType(e,t){switch(t){case"CardNo":return/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(e);case"email":return/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/.test(e);case"phone":return/^1[3|4|5|7|8][0-9]{9}$/.test(e);case"tel":return/^(0\d{2,3}-\d{7,8})(-\d{1,4})?$/.test(e);case"number":return/^[0-9]$/.test(e);case"english":return/^[a-zA-Z]+$/.test(e);case"text":return/^\w+$/.test(e);case"chinese":return/^[\u4E00-\u9FA5]+$/.test(e);case"lower":return/^[a-z]+$/.test(e);case"upper":return/^[A-Z]+$/.test(e);default:return!0}},countStr:(e,t)=>e.split(t).length-1,illegalFilter:e=>!/[`~!@#$%^&*()_+<>?:"{},.\/;'[\]]/im.test(e)&&!/[·！#￥（——）：；“”‘、，|《。》？、【】[\]]/im.test(e)},Util:{speechSynthesis:e=>{const t=new SpeechSynthesisUtterance(e);t.voice=window.speechSynthesis.getVoices()[0],window.speechSynthesis.speak(t)},sleep:e=>new Promise(t=>setTimeout(t,e)),timeTaken(e,...t){console.time("函数耗时");const i=e(...t);return console.timeEnd("函数耗时"),i},cloneMap(e){let t=Object.create(null);for(let[i,n]of e)t[i]=n;t=JSON.stringify(t),t=JSON.parse(t);let i=new Map;for(let e of Object.keys(t))i.set(e,t[e]);return i},MapToJson(e){let t={};for(let[i,n]of e)t[i]=n;return t}}};"undefined"==typeof window?console.log("%cYaoDo：当前环境是-Node，初始化完成","color: green;"):(console.log("%cYaoDo：当前环境是-浏览器，初始化完成","color: green;"),window.YaoDo=r);var a=r;return t}()},e.exports=n()},NHnr:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("7+uW"),o={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]},r=i("VU/8")({name:"App"},o,!1,null,null,null).exports,a=i("/ocq");n.default.use(a.a);var s=new a.a({routes:[{path:"/",name:"mainBlank",component:function(){return i.e(0).then(i.bind(null,"vCJd"))}},{path:"*",component:function(){return i.e(1).then(i.bind(null,"mKYK"))}}]}),l=i("mtWM"),c=i.n(l),d=(i("XLwt"),i("fyjX")),u=i("nvAS");window.axios=c.a,window.turf=d,window.proj4=u.a;i("+jGy"),i("vFg8"),i("PnUH"),i("tyrt");var h=i("NYxO"),p=i("zL8q"),f=i.n(p),g=(i("tvR6"),{install:function e(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.installed||(e.installed=!0,t.use(f.a))}});n.default.use(h.a);var m={state:{appConfig:{},legendShow:!1,legendCurrent:{title:"",list:[]},legendCollection:[],timeAxis:{show:!1}},mutations:{setAppConfig:function(e,t){e.appConfig=t},setLegendCurrent:function(e,t){e.legendCurrent=t},setMainComAction:function(e,t){var i=t.name,n=t.on_off;switch(i){case"legend":e.legendShow=1===n||2!==n&&!e.legendShow}},AddLegend:function(e,t){e.legendCurrent={title:"水资源评价",list:[{text:"超载",color:"rgba(251,0,10,0.7)"},{text:"临界超载",color:"rgba(251,201,0,0.7)"},{text:"不超载",color:"rgba(0,251,24,0.7)"}]}},resetLegend:function(e){e.legendCurrent={title:"",list:[]}},showTimeAxis:function(e){e.timeAxis.show=!0},resetTimeAxis:function(e){e.timeAxis.show=!1}}},w=i("Gu7T"),y=i.n(w),b={debug:!0,state:{isInitViewer:!1,ToolBarShow:!0,toolBar:[0,0,0,0,0,0,0,0,0,0,0,0,0],addLayer:[1,0,0],sceneAtttribute:[1,0,0,0,0],terrain:[1,0,0,0],clip:[1,0,0,0],analysis:[1,0,0,0,0],cityPlan:[1,0,0,0,0],onlineEdit:[1,0,0,0],specialEffects:[0,0,0,0],hotSpots:[0,0],compass:!0,infoManage:!0,S3MLayerManage:null,imgLayerManage:null,terrainLayerManage:null,LayerAttributeToolbar:!1,LayerAttribute:[1,0,0,0],selectedLayerName:null,isEdit:!1,isEditZ:!1,zindex:99,toolBaseColor:[!0,!0,!0,!0,!0,!0,!0,!0,!0],isInitEcharts:!1,menuToolShow:!0,layerSetting:!1,measureToolShow:!1,specialEffects_scan:!1,specialEffects_wind:!1,specialEffects_rain:!1,treeToolShow:!1,extendDataShow:!1,pathPlanningShow:!1},mutations:{setZindex:function(e,t){e.zindex=t},setisInitViewer:function(e,t){e.isInitViewer=t},setToolBarShow:function(e,t){e.ToolBarShow=t},setSpecialEffects:function(e,t){var i=t.id,n=t.val;e.specialEffects[i]=n,e.specialEffects=[].concat(y()(e.specialEffects))},setHotSpots:function(e,t,i){e.hotSpots[t]=i,e.hotSpots=[].concat(y()(e.hotSpots))},setCompass:function(e,t){e.compass=t},setInfoManage:function(e,t){e.infoManage=t},setToolBarAction:function(e,t){switch(t){case 0:e.toolBar[0]=!e.toolBar[0];break;case 1:e.toolBar[1]=!e.toolBar[1],e.toolBaseColor[1]=!e.toolBaseColor[1];break;case 2:e.toolBar[2]=!e.toolBar[2],e.toolBaseColor[2]=!e.toolBaseColor[2];break;case 3:e.toolBar[3]=!e.toolBar[3],e.toolBaseColor[3]=!e.toolBaseColor[3];break;case 4:e.toolBar[4]=!e.toolBar[4],e.toolBaseColor[4]=!e.toolBaseColor[4];break;case 5:e.toolBar[5]=!e.toolBar[5],e.toolBaseColor[5]=!e.toolBaseColor[5];break;case 6:e.toolBar[6]=!e.toolBar[6],e.toolBaseColor[6]=!e.toolBaseColor[6];break;case 7:e.toolBar[7]=!e.toolBar[7],e.toolBaseColor[7]=!e.toolBaseColor[7];break;case 8:e.toolBar[8]=!e.toolBar[8],e.toolBaseColor[8]=!e.toolBaseColor[8];break;case 9:e.toolBar[9]=!e.toolBar[9];break;case 10:e.toolBar[10]=!e.toolBar[10];break;case 11:e.toolBar[11]=!e.toolBar[11];break;default:e.toolBar=[0,0,0,0,0,0,0,0,0,0,0,0]}e.toolBar=[].concat(y()(e.toolBar))},setAddLayerAction:function(e,t){e.addLayer=t},setTerrainAction:function(e,t){e.terrain=t},setSceneAtttribute:function(e,t){e.sceneAtttribute=t},setClipAction:function(e,t){e.clip=t},setAnalysisAction:function(e,t){e.analysis=t},setCityPlanAction:function(e,t){e.cityPlan=t},setOnlineEditrAction:function(e,t){e.onlineEdit=t},setS3MLayerManage:function(e,t){e.S3MLayerManage=t},setImgLayerManage:function(e,t){e.imgLayerManage=t},setTerrainLayerManage:function(e,t){e.terrainLayerManage=t},setLayerAttributeToolbal:function(e,t){e.LayerAttributeToolbar=t},setLayerAttribute:function(e,t){e.LayerAttribute=t},setSelectedLayerName:function(e,t){e.selectedLayerName=t},setIsEdit:function(e,t){e.isEdit=t},setIsEditZ:function(e,t){e.isEditZ=t},setMenuToolAction:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e.menuToolShow=1===t||2!==t&&!e.menuToolShow},setVGEEarthComAction:function(e,t){var i=t.name,n=t.on_off;switch(i){case"treeTool":e.treeToolShow=1===n||2!==n&&!e.treeToolShow;break;case"pathPlanning":e.pathPlanningShow=1===n||2!==n&&!e.pathPlanningShow;break;case"measureTool":e.measureToolShow=1===n||2!==n&&!e.measureToolShow;break;case"extendData":e.extendDataShow=1===n||2!==n&&!e.extendDataShow}}}};function C(e,t){(function(e,t){for(var i=0;i<e.length;i++)if(e[i].windowName===t)return e[i]})(e,t.windowName)||e.push(t)}function v(e,t){for(var i=0;i<e.length;i++)e[i].windowName===t&&(e[i].visible=!1)}function S(e,t){for(var i=[],n=0;n<e.length;n++)e[n].windowName!==t&&i.push(e[n]);return i}n.default.use(h.a);new h.a.Store({state:{token:null,customWindows:[],floatWindows:[],popWindows:[],rightWindows:[],bottomWindows:[]},mutations:{openCustomWindow:function(e,t){var i=t.windowName,n=t.windowProp;C(e.customWindows,{windowName:i,visible:!0,windowProp:n})},hideCustomWindow:function(e,t){v(e.customWindows,t)},removeCustomWindow:function(e,t){e.customWindows=S(e.popWindows,t)},openPopWindow:function(e,t){var i=t.windowName,n=t.windowProp;C(e.popWindows,{windowName:i,visible:!0,windowProp:n})},hidePopWindow:function(e,t){v(e.popWindows,t)},removePopWindow:function(e,t){e.popWindows=S(e.popWindows,t)},openFloatWindow:function(e,t){var i=t.windowName,n=t.windowProp;C(e.floatWindows,{windowName:i,visible:!0,windowProp:n})},hideFloatWindow:function(e,t){v(e.popWindows,t)},removeFloatWindow:function(e,t){e.floatWindows=S(e.floatWindows,t)},removeAllFloatWindow:function(e){e.floatWindows=[]},openRightWindow:function(e,t){var i=t.windowName,n=t.windowProp;C(e.rightWindows,{windowName:i,visible:!0,windowProp:n})},removeRightWindow:function(e,t){e.rightWindows=S(e.rightWindows,t)},closeOtherRightWindow:function(e,t){for(;e.rightWindows.length>1&&e.rightWindows[0].windowName!==t;)e.rightWindows.shift();for(;e.rightWindows.length>1;)e.rightWindows[1].windowName!==t&&e.rightWindows.pop()},removeAllRightWindow:function(e){e.rightWindows=[]},openBottomWindow:function(e,t){var i=t.windowName,n=t.windowProp;window.$("#toolBarLeft").css("display","horizontal"),window.$("#viewer-div").css("height","calc(100vh - 260px)"),window.$("#viewerCon").css("height","calc(100vh - 260px)"),window.$("#doubleViewerCon").css("height","calc(100vh - 260px)"),window.$("#footerCon").css("height","200px"),C(e.bottomWindows,{windowName:i,visible:!0,windowProp:n})},removeBottomWindow:function(e,t){window.$("#viewerCon").css("height","calc(100vh - 60px)"),window.$("#viewerLine").css("height","calc(100vh - 60px)"),window.$("#doubleViewerCon").css("height","calc(100vh - 60px)"),window.$("#footerCon").css("height","0px"),e.bottomWindows=S(e.bottomWindows,t)},closeOtherBottomWindow:function(e,t){for(;e.bottomWindows.length>1&&e.bottomWindows[0].windowName!==t;)e.bottomWindows.shift();for(;e.bottomWindows.length>1;)e.bottomWindows[1].windowName!==t&&e.bottomWindows.pop()},removeAllBottomWindow:function(e){e.bottomWindows=[]},reSetWindows:function(e){e.customWindows=[],e.popWindows=[],e.floatWindows=[],e.rightWindows=[],e.bottomWindows=[]}},modules:{mainStore:m,superMap:b}});var T,P=i("Xxa5"),E=i.n(P),M=i("exGp"),D=i.n(M),k=i("BO1k"),I=i.n(k),L=i("d7EF"),x=i.n(L),B=i("mvHQ"),_=i.n(B),A=i("ifoU"),O={ws:null,listenMap:new(i.n(A).a)};O.connect=function(){var e=this;e.ws=new ReconnectingWebSocket("ws://localhost:3000"),e.ws.onopen=function(t){e.ws.send(_()({role:"客户端",token:"64bfc9fcd702c537841292a41b2789f2",instruct:"连接申请",data:{}}))},e.ws.onclose=function(e){return console.log("服务器连接断开")},e.ws.onerror=function(e){return console.log("连接出错")},e.ws.onmessage=function(t){var i=JSON.parse(t.data),n=!1,o=!0,r=!1,a=void 0;try{for(var s,l=I()(e.listenMap);!(o=(s=l.next()).done);o=!0){var c=s.value,d=x()(c,2),u=d[0],h=d[1];i.action===u&&"function"==typeof h&&(n=!0,h(i))}}catch(e){r=!0,a=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw a}}!1===n&&console.log("服务器推送消息："+t.data)}},O.addListen=function(e,t){this.listenMap.set(e,t)},O.send=(T=D()(E.a.mark(function e(t){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:that.ws.send(_()(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return T.apply(this,arguments)}),O.close=function(){this.ws.close()};var W=O;n.default.use(h.a),n.default.use(g),window.clientWebSocketTool=W,n.default.config.productionTip=!1,new n.default({el:"#app",router:s,components:{App:r},created:function(){W.connect()},destroyed:function(){W.close()},template:"<App/>"})},PnUH:function(e,t){},tvR6:function(e,t){},tyrt:function(e,t){document.oncontextmenu=function(){return!1},document.onselectstart=function(){return!1}},vFg8:function(e,t,i){var n;self,n=function(){return function(){"use strict";var e={d:function(t,i){for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:function(){return Me}});var i={config:null,version:"1.2",token:null,currentUser:null,viewerLeft:null,viewerRight:null,viewer2D:null,viewerLeftWorkSpace:null,viewerRightWorkSpace:null,viewer2DWorkSpace:null};const n=window,o=n.Cesium,r=n.turf,a=n.proj4,s=n.$;function l(e){function t(e){return e.map(e=>{e.pid=e.pid||(()=>{let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?i:7&i|8).toString(16)})})(),e.disable=e.disable||!1,e.defaultLoad=e.defaultLoad||!1,e.show=e.defaultLoad||!1}),e.filter(e=>!e.disable)}return e.layerList=t(e.layerList),e.terrainList=t(e.terrainList),e.modelList=t(e.modelList),e.cesium3DTileSetList=t(e.cesium3DTileSetList),e.geoJsonList=t(e.geoJsonList),e.poi=t(e.poi),e}var c={getConfig(){const e=window.VGEEarth;let t=e.globeDataCache.config;return t||(window.APPConfig?(t=e.globeDataCache.config=JSON.parse(JSON.stringify(l(window.APPConfig))),document.title=t.appTitle,console.log("%c从全局 script 文件中加载 ：【"+t.appName+"】 的配置文件","color: green;")):(t=e.globeDataCache.config=function(){const e={appName:"VGE工程实验室WebGL平台",appTitle:"VGE",homeAddr:{lon:108.387,lat:30.71,height:15e4},homeBox:{west:120,south:37,east:120,north:37},terrain:"",baseURL:"",GISResources:"",AppResources:"",JavaServer:"",layerList:[{name:"mapbox影像",catalog:"基础数据",dataType:"layer",defaultLoad:!0,properties:{scheme:"layer-xyz-3857",baseLayer:!0,url:"https://api.mapbox.com/styles/v1/mapbox/satellite-v9/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXFhYTA2bTMyeW44ZG0ybXBkMHkifQ.gUGbDOPUN1v1fTs5SeOR4A",layers:"cite:polygon_sheng",minimumLevel:7,maximumLevel:15,legend:"",rectangle:{}}}],terrainList:[],modelList:[],cesium3DTileSetList:[],geoJsonList:[],poi:[]};return l(e),e}(),console.log("%c从默认配置文件中加载","color: green;"))),t},getAllSources(){let e=this.getConfig();return[...e.layerList,...e.terrainList,...e.modelList,...e.cesium3DTileSetList,...e.geoJsonList,...e.poi]},getInitialTerrain(){let e=this.getConfig(),t=new o.EllipsoidTerrainProvider({});if(e.terrainList){let i=e.terrainList.find(e=>e.defaultLoad);if(i)if("default"===i.properties.url)t=o.createWorldTerrain({requestWaterMask:!0,requestVertexNormals:!0});else{let e=new o.Resource({url:i.properties.url,queryParameters:{}});t=new o.CesiumTerrainProvider({url:e,requestVertexNormals:!1,requestWaterMask:!1,credit:"VRTheWorldTerrainProvider"===i.properties.provider?"Terrain data courtesy VT M?K":void 0})}}return t},getNameByPid(e){let t=this.getAllSources().find(t=>t.pid===e);return t?t.name:null}},d=function(e,t){let i=new XMLHttpRequest;i.open("GET",e,!1),i.onreadystatechange=function(){if(4==i.readyState&&(200==i.status||304==i.status)){let n={};try{n=JSON.parse(i.responseText)}catch(t){console.log(e,"数据解析错误：",i.responseText)}t(n)}},i.send()},u=class{constructor(e,t){this.viewer=e,this.dataSourceToo=t}createPoint(e){return this.dataSourceToo.entities.add({position:e,point:{color:o.Color.WHITE,pixelSize:5,heightReference:o.HeightReference.NONE}})}PolyLinePrimitive(e){return this.dataSourceToo.entities.add({polyline:{positions:new o.CallbackProperty(function(){return e},!1),clampToGround:!0,material:new o.PolylineOutlineMaterialProperty({color:o.Color.CHARTREUSE}),width:2}})}PointLabelEntity(e,t){return this.dataSourceToo.entities.add({name:t,position:e,point:{pixelSize:5,color:o.Color.RED,outlineColor:o.Color.WHITE,outlineWidth:2,heightReference:o.HeightReference.NONE},label:{showBackground:!0,horizontalOrigin:o.HorizontalOrigin.LEFT,verticalOrigin:o.VerticalOrigin.BOTTOM,text:t,font:"18px sans-serif",fillColor:o.Color.GOLD,outlineWidth:2,disableDepthTestDistance:1e4}})}lineLabelEntity(e,t){return this.dataSourceToo.entities.add({polyline:{show:!0,positions:e,material:new o.PolylineOutlineMaterialProperty({color:o.Color.RED}),depthFailMaterial:new o.PolylineOutlineMaterialProperty({color:o.Color.RED}),width:2,pixelOffset:new o.Cartesian2(20,-40)},label:{text:t,font:"14pt monospace",color:o.Color.RED,backgroundColor:o.Color.RED,style:o.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,heightReference:o.HeightReference.NONE,verticalOrigin:o.VerticalOrigin.TOP,pixelOffset:new o.Cartesian2(40,-40)}})}spaceDistanceLabel(e,t){let i=this,n=i.viewer,r=new o.Cartesian3;r.x=(e.x+t.x)/2,r.y=(e.y+t.y)/2,r.z=(e.z+t.z)/2;let a=o.Cartographic.fromCartesian(r,o.Ellipsoid.WGS84,new o.Cartographic),s=o.Cartographic.fromCartesian(e,o.Ellipsoid.WGS84,new o.Cartographic),l=o.Cartographic.fromCartesian(t,o.Ellipsoid.WGS84,new o.Cartographic),c=new o.EllipsoidGeodesic;c.setEndPoints(s,l);let d=c.surfaceDistance.toFixed(3);d=d>1e3?(d/1e3).toFixed(3)+"km":d+"m",n.scene.sampleHeightMostDetailed([a]).then(function(e){e[0].height||(e[0].height=0),i.dataSourceToo.entities.add({position:o.Cartographic.toCartesian(e[0],o.Ellipsoid.WGS84,new o.Cartesian3),label:{text:d,font:"21px SimSun",style:o.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,fillColor:o.Color.WHITE,disableDepthTestDistance:5e5,distanceDisplayCondition:5e5}})})}polygonCenterLabel(e,t="周长"){let i=r.center(e),n="";switch(t){case"周长":{let t=r.length(e,{units:"kilometers"});n=t<5?"周长："+(1e3*t).toFixed(3)+" m":"周长："+t.toFixed(3)+" km"}break;case"面积":{let t=r.area(e);n=t<2e5?"面积："+t.toFixed(3)+" m2":"面积："+(1e-6*t).toFixed(3)+" km2"}}this.dataSourceToo.entities.add({position:o.Cartesian3.fromDegrees(i.geometry.coordinates[0],i.geometry.coordinates[1]),label:{text:n,font:"21px SimSun",style:o.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,fillColor:o.Color.WHITE,disableDepthTestDistance:5e5,distanceDisplayCondition:5e5}})}buildLabel(e,t){return new o.Entity({position:e,label:{text:t,font:"16pt monospace",color:o.Color.RED,backgroundColor:o.Color.RED,style:o.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,heightReference:o.HeightReference.NONE,verticalOrigin:o.VerticalOrigin.TOP,pixelOffset:new o.Cartesian2(30,-30)}})}buildLabelByDegrees(e,t,i={}){let n={position:o.Cartesian3.fromDegrees(e.longitude,e.latitude),label:{text:t,font:"12pt bold monospace",fillColor:o.Color.WHITE,outlineColor:o.Color.BLACK,outlineWidth:4,style:o.LabelStyle.FILL_AND_OUTLINE,horizontalOrigin:o.HorizontalOrigin.LEFT,verticalOrigin:o.VerticalOrigin.BOTTOM,disableDepthTestDistance:Number.POSITIVE_INFINITY,heightReference:o.HeightReference.RELATIVE_TO_GROUND}};for(const e in i)"id"===e?n[e]=i[e]:n.label[e]=i[e];return new o.Entity(n)}buildBillboard(e,t,i){let n={param:JSON.stringify(i),position:o.Cartesian3.fromDegrees(e,t),billboard:{image:i.imgUrl,width:void 0,height:void 0,scaleByDistance:new o.NearFarScalar(150,2,15e6,.5),disableDepthTestDistance:Number.POSITIVE_INFINITY,heightReference:o.HeightReference.RELATIVE_TO_GROUND,verticalOrigin:o.VerticalOrigin.BOTTOM}};return i.name&&(n.param=i.name),i.height&&(n.billboard.height=i.height),i.width&&(n.billboard.width=i.width),new o.Entity(n)}},h=function(e,t,i){let n=o.JulianDate.fromDate(new Date),a=r.length(t,{units:"meters"})/i;e.position=new o.CallbackProperty(function(e){let s=e.secondsOfDay-n.secondsOfDay;if(s<0)return;let l=i*(s%a),c=r.along(t,l,{units:"meters"}).geometry.coordinates;return o.Cartesian3.fromDegrees(c[0],c[1],400)})};function p(e,t,i){let n=[],o=e.length;for(let t=0;t<o;t++)n[3*t]=e[t][0],n[3*t+1]=e[t][1],3===e[t].length?n[3*t+2]=e[t][2]:n[3*t+2]=22;return new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArrayHeights(n)),height:1,vertexFormat:Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,clampToGround:!0,classificationType:Cesium.ClassificationType.BOTH,perPositionHeight:!0})}),appearance:new Cesium.EllipsoidSurfaceAppearance({aboveGround:!1,material:new Cesium.Material({fabric:{type:"Water",uniforms:{baseWaterColor:new Cesium.Color(i.color_r,i.color_g,i.color_b,i.color_a),normalMap:t,frequency:i.water_freq,animationSpeed:i.water_animationspeed,amplitude:i.water_amplitude}}})})})}var f="addData",g="removeData",m=class{constructor(e){this.viewer=e,this.nodes=[],this.dataSourceToo=new o.CustomDataSource("工作区-实体集合"),this.viewer.dataSources.add(this.dataSourceToo),this.terrainMana=new class{constructor(e){this.viewer=e,this.sourcesItems=[]}addData(e){let t,i=this.viewer.scene,n=e.properties,r=n.url,a=n.queryParameters||{},s=n.scheme||"CesiumTerrainProvider";if("default"===r)t=o.createWorldTerrain(),i.terrainProvider=t;else{let e=new o.Resource({url:r,queryParameters:a});t=new o[s]({url:e,requestVertexNormals:!1,requestWaterMask:!1,credit:"VRTheWorldTerrainProvider"===s?"Terrain data courtesy VT M?K":void 0}),i.terrainProvider=t}return t}flyToByPid(e){}getByPid(e){}removeByPid(e){return this.removeAll()}removeAll(){return this.viewer.scene.terrainProvider=new o.EllipsoidTerrainProvider({}),!0}}(e),this.layerMana=new class{constructor(e){this.viewer=e,this.sourcesItems=[]}addData(e){let t=e.properties,i=t.url,n=null;switch(t.scheme){case"wms":case"layer-wmts":n=this.addWebMapTileServiceImageryProvider(i,e);break;case"layer-xyz-3857":n=this.addImageryXYZ_3857_Provider(i,e);break;case"layer-xyz-4326":n=this.addImageryXYZ_4326_Provider(i,e);break;case"layer-arcgisMapServer":n=this.addArcGisMapServerImagery(i,e);break;case"layer-geoserver":n=this.addGeoserverWMS(i,e);break;default:return console.log("数据项，缺少图层类型标识符",t),!1}return this.sourcesItems.push(e),!0}getByPid(e){return this.sourcesItems.find(t=>t.name===e)}flyToByPid(e){let t=this.getByPid(e).param.properties.rectangle;this.viewer.camera.flyTo({destination:o.Rectangle.fromDegrees(t.west,t.south,t.east,t.north)})}removeByPid(e){let t=this,i=!1,n=t.sourcesItems.find(t=>t.pid===e);return n?(t.sourcesItems.filter(t=>t!==e),i=t.viewer.imageryLayers.remove(n),n.isDestroyed()||n.destroy(),i):i}removeAll(){return!1}addWebMapTileServiceImageryProvider(e,t){let i=t.properties.queryParameters||{},n=new o.Resource({url:e,queryParameters:i}),r=new o.WebMapTileServiceImageryProvider({url:n,format:"image/jpeg",show:!1});return this.addImageryProvider(r,t)}addImageryXYZ_3857_Provider(e,t){let i=t.properties.queryParameters||{},n=new o.Resource({url:e,queryParameters:i}),r=new o.UrlTemplateImageryProvider({url:n,tilingScheme:new o.WebMercatorTilingScheme,fileExtension:"png"});return this.addImageryProvider(r,t)}addImageryXYZ_4326_Provider(e,t){let i=t.properties.queryParameters||{},n=new o.Resource({url:e,queryParameters:i}),r=new o.UrlTemplateImageryProvider({url:n,tilingScheme:new o.GeographicTilingScheme({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:1}),fileExtension:"png"});return this.addImageryProvider(r,t)}addArcGisMapServerImagery(e,t){let i=t.properties.queryParameters||{},n=new o.Resource({url:e,queryParameters:i}),r=new o.ArcGisMapServerImageryProvider({url:n,enablePickFeatures:!1});return this.addImageryProvider(r,t)}addGeoserverWMS(e,t){let i=t.properties.queryParameters||{},n=new o.Resource({url:e,queryParameters:i});const r=new o.WebMapServiceImageryProvider({url:n,layers:t.layers,parameters:{service:"WMS",format:"image/png",transparent:!0}});return this.addImageryProvider(r,t)}addImageryProvider(e,t){const i=this.viewer.imageryLayers.addImageryProvider(e);return i.pid=t.pid,i.param=t,t.properties.baseLayer&&this.viewer.imageryLayers.lowerToBottom(i),this.sourcesItems.unshift(i),i}}(e),this.gltfMana=new class{constructor(e){this.viewer=e,this.sourcesItems=[],this.dataSourceToo=new o.CustomDataSource("工作区 GLTF - 附加实体集合"),this.viewer.dataSources.add(this.dataSourceToo)}addData(e){let t=e.properties,i=t.url,n=t.queryParameters||{},a=t.scale||1;this.viewer.scene.globe.depthTestAgainstTerrain=!0;let s=new o.Resource({url:i,queryParameters:n}),l=o.Cartesian3.fromDegrees(t.position.longitude,t.position.latitude,t.position.height||0),c=o.Math.toRadians(135),d=new o.HeadingPitchRoll(c,0,0),u=o.Transforms.headingPitchRollQuaternion(l,d),p={id:e.pid,name:e.name,position:l,orientation:u,model:{uri:s,scale:a,minimumPixelSize:64}};if(null===t.position.height)p.model.heightReference=o.HeightReference.CLAMP_TO_GROUND;else if(t.DistanceDisplayCondition){let e=t.DistanceDisplayCondition.near,i=t.DistanceDisplayCondition.far;p.model.distanceDisplayCondition=new o.DistanceDisplayCondition(e,i)}let f=this.dataSourceToo.entities.add(p);return t.motion&&h(f,r.lineString(t.motion.path),t.motion.speed),this.sourcesItems.unshift(f),f}getByPid(e){return this.sourcesItems.find(t=>t.id===e)}flyToByPid(e){let t=this.sourcesItems.find(t=>t.id===e);this.viewer.flyTo(t,{offset:new o.HeadingPitchRange(0,-1.57,0)})}removeByPid(e){let t=this.viewer.dataSources.remove(this.getByPid(e));return this.sourcesItems=this.sourcesItems.filter(t=>t.id!==e),this.dataSourceToo.entities.removeById(e),t}removeAll(){return this.sourcesItems.forEach(e=>{this.viewer.dataSources.remove(this.getByPid(e.pid))}),this.sourcesItems=[],!1}}(e),this.poiMana=new class{constructor(e){this.viewer=e,this.sourcesItems=[],this.dataSourceToo=new o.CustomDataSource("工作区 geoJson - 标注点"),this.viewer.dataSources.add(this.dataSourceToo)}addData(e){let t=e.pid,{longitude:i,latitude:n,height:r}=e.properties.position,a=e.properties.text_string,s=e.properties.image_path,l=this.dataSourceToo.entities.add({id:t,name:" mark",position:o.Cartesian3.fromDegrees(i,n),billboard:{show:!0,image:s,width:15,height:15,scaleByDistance:new o.NearFarScalar(150,2,15e6,.5),disableDepthTestDistance:Number.POSITIVE_INFINITY,heightReference:o.HeightReference.RELATIVE_TO_GROUND,verticalOrigin:o.VerticalOrigin.BOTTOM},label:{text:a,font:"12pt bold monospace",fillColor:o.Color.WHITE,outlineColor:o.Color.BLACK,outlineWidth:4,style:o.LabelStyle.FILL_AND_OUTLINE,horizontalOrigin:o.HorizontalOrigin.LEFT,verticalOrigin:o.VerticalOrigin.BOTTOM,pixelOffset:new o.Cartesian2(20,0),disableDepthTestDistance:Number.POSITIVE_INFINITY,heightReference:o.HeightReference.RELATIVE_TO_GROUND}});return this.sourcesItems.push(l),l}getByPid(e){return this.sourcesItems.find(t=>t.id===e)}flyToByPid(e){let t=this.sourcesItems.find(t=>t.id===e);this.viewer.flyTo(t,{offset:new o.HeadingPitchRange(0,-1.57,0)})}removeByPid(e){return this.sourcesItems=this.sourcesItems.filter(t=>t.id!==e),this.dataSourceToo.entities.removeById(e),!0}removeAll(){return this.dataSourceToo.removeAll(),this.sourcesItems=[],!1}}(e),this._3DTileMana=new class{constructor(e){this.viewer=e,this.sourcesItems=[]}addData(e){let t=e.properties,i=t.url,n=t.queryParameters||{};this.viewer.scene.globe.depthTestAgainstTerrain=!0;let r=new o.Resource({url:i,queryParameters:n}),a=new o.Cesium3DTileset({url:r,show:!0,maximumScreenSpaceError:2,maximumMemoryUsage:4e3,cullWithChildrenBounds:!0,cullRequestsWhileMoving:!1,cullRequestsWhileMovingMultiplier:60,preloadWhenHidden:!0,preloadFlightDestinations:!0,preferLeaves:!0,dynamicScreenSpaceError:!0,dynamicScreenSpaceErrorDensity:.00278,dynamicScreenSpaceErrorFactor:8,dynamicScreenSpaceErrorHeightFalloff:.1,progressiveResolutionHeightFraction:.5,foveatedScreenSpaceError:!0,foveatedConeSize:.1,foveatedMinimumScreenSpaceErrorRelaxation:0,foveatedTimeDelay:.2,skipLevelOfDetail:!0,baseScreenSpaceError:1024,skipScreenSpaceErrorFactor:16,skipLevels:0,immediatelyLoadDesiredLevelOfDetail:!1,loadSiblings:!1,luminanceAtZenith:.2,backFaceCulling:!0,showOutline:!0,vectorClassificationOnly:!1,vectorKeepDecodedPositions:!0,debugFreezeFrame:!1,debugColorizeTiles:!1,debugWireframe:!1,debugShowBoundingVolume:!1,debugShowContentBoundingVolume:!1,debugShowViewerRequestVolume:!1,debugShowGeometricError:!1,debugShowRenderingStatistics:!1,debugShowMemoryUsage:!1,debugShowUrl:!1});return a.pid=e.pid,a.param=t,this.sourcesItems.unshift(a),(a=this.viewer.scene.primitives.add(a)).readyPromise.then(function(e){let i=t.offset;i&&function(e,t){if(t.longitude&&!isNaN(t.longitude)&&t.latitude&&!isNaN(t.latitude)&&t.height&&!isNaN(t.height)){let i=e.boundingSphere.center,n=o.Cartesian3.fromDegrees(t.longitude,t.latitude,t.height),r=o.Transforms.eastNorthUpToFixedFrame(i),a=o.Matrix4.getMatrix3(r,new o.Matrix3),s=o.Matrix3.inverse(a,new o.Matrix3),l=new o.Cartesian3(-i.x,-i.y,-i.z),c=o.Transforms.eastNorthUpToFixedFrame(n);c=o.Matrix4.multiplyByMatrix3(c,s,new o.Matrix4),c=o.Matrix4.multiplyByTranslation(c,l,new o.Matrix4),e.modelMatrix=c}if(!t.longitude&&!t.latitude&&t.height&&!isNaN(t.height)){let i=o.Cartographic.fromCartesian(e.boundingSphere.center),n=o.Cartesian3.fromRadians(i.longitude,i.latitude,t.height),r=e.boundingSphere.center,a=new o.Cartesian3;o.Cartesian3.subtract(n,r,a),e.modelMatrix=o.Matrix4.fromTranslation(a)}}(e,i)}),a}flyToByPid(e){let t=this.sourcesItems.find(t=>t.pid===e);this.viewer.flyTo(t,{offset:new o.HeadingPitchRange(0,-1.57,0)})}getByPid(e){return this.sourcesItems.find(t=>t.name===e)}removeByPid(e){let t=this.sourcesItems.find(t=>t.pid===e);return t&&!t.isDestroyed()&&t.destroy(),this.sourcesItems=this.sourcesItems.filter(t=>t.pid!==e),this.viewer.scene.primitives.remove(t)}removeAll(){return this.sourcesItems.forEach(e=>{this.viewer.dataSources.remove(this.getByPid(e.pid))}),this.sourcesItems=[],!1}}(e),this.geoJsonMana=new class{constructor(e){this.viewer=e,this.sourcesItems=[],this.dataSourceToo=new o.CustomDataSource("工作区 geoJson - 附加实体集合"),this.entityFactory=new u(e,this.dataSourceToo),this.viewer.dataSources.add(this.dataSourceToo)}addData(e){let t=this,i=e.properties,n=i.url,a=e.pid;return d(n,n=>{if(i.label){let e=r.center(n).geometry.coordinates,s={id:a};i.label.pixelOffset&&(s.pixelOffset=new o.Cartesian2(i.label.pixelOffset.x,i.label.pixelOffset.y));let l=t.entityFactory.buildLabelByDegrees({longitude:e[0],latitude:e[1],height:0},i.label.text,s);this.dataSourceToo.entities.add(l)}let s=new o.GeoJsonDataSource;s.id=a,s.load(n,{clampToGround:!0}).then(function(t){s.name=e.pid,s.nikeName=e.name,t.entities.values.forEach(e=>{i.symbol.lineArrow&&e.polyline&&(e.polyline.material=new o.PolylineArrowMaterialProperty(o.Color.RED),e.polyline.width=15)})}),s.name=e.pid,s.nikeName=e.name,t.sourcesItems.push(s),t.viewer.dataSources.add(s)}),!0}getByPid(e){return this.sourcesItems.find(t=>t.id===e)}flyToByPid(e){let t=this.sourcesItems.find(t=>t.id===e);this.viewer.flyTo(t,{offset:new o.HeadingPitchRange(0,-1.57,0)})}removeByPid(e){let t=this.viewer.dataSources.remove(this.getByPid(e));return this.sourcesItems=this.sourcesItems.filter(t=>t.id!==e),this.dataSourceToo.entities.removeById(e),t}removeAll(){return this.sourcesItems.forEach(e=>{this.viewer.dataSources.remove(this.getByPid(e.pid))}),this.sourcesItems=[],!1}}(e),this.waterMana=new class{constructor(e){this.viewer=e,this.sourcesItems=[],this.options={color_r:0,color_g:.2941177,color_b:.2078431,color_a:1,water_freq:100,water_animationspeed:.01,water_amplitude:2},this.primitives=[]}addData(e){let t=this,i=e.properties,n=JSON.parse(JSON.stringify(i.waterOptions));!n.color_r&&(n.color_r=t.options.color_r),!n.color_g&&(n.color_g=t.options.color_g),!n.color_b&&(n.color_b=t.options.color_b),!n.color_a&&(n.color_a=t.options.color_a),!n.water_freq&&(n.water_freq=t.options.water_freq),!n.water_animationspeed&&(n.water_animationspeed=t.options.water_animationspeed),!n.water_amplitude&&(n.water_amplitude=t.options.water_amplitude);let o=n.geoJsonUrl,r=n.textureUrl;return this.getByPid(e.pid)?(console.log("不允许重复添加"),!1):(t.sourcesItems.push(e),d(o,function(i){(function(e,t,i){let n=[],o=e.features;for(let e=0;e<o.length;e++){let r=p(o[e].geometry.coordinates[0],t,i);n.push(r)}return n})(i,r,n).forEach(i=>{i.pid=e.pid,t.viewer.scene.primitives.add(i),t.primitives.push(i)})}),!0)}reLoad(){let e=JSON.parse(JSON.stringify(this.sourcesItems));this.removeAll(),e.forEach(e=>{this.addData(e)})}flyToByPid(e){}getByPid(e){return this.sourcesItems.find(t=>t.name===e)}removeAll(){let e=this;return e.primitives.forEach(t=>e.viewer.scene.primitives.remove(t)),e.sourcesItems=[],!0}removeByPid(e){let t=this;return t.primitives.filter(t=>t.pid===e).forEach(e=>t.viewer.scene.primitives.remove(e)),this.sourcesItems=this.sourcesItems.filter(t=>t.pid!==e),!0}}(e),this.sourceEvent=new class{constructor(){this.listenCallbacks=[]}addEventListener(e,t,i){return!this.listenCallbacks.find(n=>n.listenType===e&&n.callback===t&&n.scope===i)&&(this.listenCallbacks.push({listenType:e,callback:t,scope:i}),!0)}triggerEvent(e,t){this.listenCallbacks.forEach(i=>{i.listenType===e&&("function"==typeof i.callback?i.callback(t):console.log("无法触发监听方法：",i.callback))})}removeListen(e){return!!this.listenCallbacks.find(t=>t.callback===e)&&(this.listenCallbacks=this.listenCallbacks.filter(t=>t.callback!==e),!0)}},this.listenSource()}listenSource(){let e=this;e.viewer.scene.globe.imageryLayersUpdatedEvent.addEventListener(function(){setTimeout(()=>{e.nodes.forEach(t=>{"layer"===t.dataType&&!e.viewer.imageryLayers._layers.find(e=>(e.param||{}).pid===t.pid)&&e.removeData(t)})},50)})}addData(e){let t=this,i=null;if(!t.checkSourceItem(e))return console.log("该资源项不合法",e),i;if(e=JSON.parse(JSON.stringify(e)),this.nodes.find(t=>e.pid===t.pid))return console.warn("工作区已加载该数据!不允许重复加载：",e.name),i;switch(console.log("%c正在加载数据："+e.name,"color:green"),e.dataType){case"layer":i=t.layerMana.addData(e);break;case"dem":i=t.terrainMana.addData(e);break;case"gltf":i=t.gltfMana.addData(e);break;case"3DTiles":i=t._3DTileMana.addData(e);break;case"geoJson":i=t.geoJsonMana.addData(e);break;case"water":i=t.waterMana.addData(e);break;case"poi":i=t.poiMana.addData(e)}return this.nodes.push(e),t.sourceEvent.triggerEvent(f,e),i}removeData(e){let t=this,i=!1;if(e){switch(t.nodes.find(t=>e.pid===t.pid)&&void 0!==e.pid?console.warn("正在执行移除!"):console.error("正在执行重复移除!"),e.dataType){case"layer":i=t.layerMana.removeByPid(e.pid);break;case"dem":t.terrainMana.removeByPid(e.pid);break;case"3DTiles":i=t._3DTileMana.removeByPid(e.pid);break;case"geoJson":i=t.geoJsonMana.removeByPid(e.pid);break;case"water":i=t.waterMana.removeByPid(e.pid);break;case"gltf":i=t.gltfMana.removeByPid(e.pid);break;case"poi":i=t.poiMana.removeByPid(e.pid)}t.nodes=t.nodes.filter(t=>t.pid!==e.pid),t.sourceEvent.triggerEvent(g,e),console.log(e.dataType+"移除 "+i)}}flyToData(e){let t=this;if(this.nodes.find(t=>e.pid===t.pid))switch(e.dataType){case"layer":case"dem":break;case"3DTiles":t._3DTileMana.flyToByPid(e.pid);break;case"geoJson":t.geoJsonMana.flyToByPid(e.pid);break;case"water":t.waterMana.flyToByPid(e.pid);break;case"gltf":t.gltfMana.flyToByPid(e.pid);break;case"poi":t.poiMana.flyToByPid(e.pid)}}checkSourceItem(e){let t=!0;return t=(t=(t=t&&!!e)&&!!e.pid)&&!!e.properties}},w={getCameraHeight(){let e=i.viewerLeft.scene,t=e.canvas.clientWidth,n=e.canvas.clientHeight,r=e.camera.getPickRay(new o.Cartesian2(t/2|0,n-1)),a=e.camera.getPickRay(new o.Cartesian2(1+t/2|0,n-1)),s=e.globe,l=s.pick(r,e),c=s.pick(a,e);function d(e){return null!=e}if(!d(l)||!d(c))return NaN;let u=s.ellipsoid.cartesianToCartographic(l),h=s.ellipsoid.cartesianToCartographic(c),p=new o.EllipsoidGeodesic;return p.setEndPoints(u,h),100*p.surfaceDistance},getTerrainMostDetailedHeight(e,t){let i=o.createWorldTerrain();o.sampleTerrainMostDetailed(i,[e]).then(function(e){"function"==typeof t&&t(e[0])})},fullScreen(){let e=i.viewerLeft;o.Fullscreen.requestFullscreen(e.scene.canvas)},globalView(){i.viewerLeft.camera.flyHome(1)},trueNorth(){let e=i.viewerLeft,t=o.Cartographic.fromCartesian(e.camera.position,o.Ellipsoid.WGS84,new o.Cartographic),n=e.scene.pickPosition(new o.Cartesian2(e.canvas.clientWidth/2,e.canvas.clientHeight/2)),r=o.Cartographic.fromCartesian(n,o.Ellipsoid.WGS84,new o.Cartographic);r.height=t.height;let a=o.Cartographic.toCartesian(r,o.Ellipsoid.WGS84,new o.Cartesian3);e.camera.setView({destination:a,orientation:{heading:o.Math.toRadians(0),pitch:e.camera.pitch,roll:e.camera.roll}})},verticalView(){let e=i.viewerLeft,t=o.Cartographic.fromCartesian(e.camera.position,o.Ellipsoid.WGS84,new o.Cartographic),n=e.scene.pickPosition(new o.Cartesian2(e.canvas.clientWidth/2,e.canvas.clientHeight/2)),r=o.Cartographic.fromCartesian(n,o.Ellipsoid.WGS84,new o.Cartographic);r.height=t.height;let a=o.Cartographic.toCartesian(r,o.Ellipsoid.WGS84,new o.Cartesian3);e.camera.setView({destination:a,orientation:{heading:e.camera.heading,pitch:o.Math.toRadians(-90),roll:e.camera.roll}})},lockVerticalView(){let e=i.viewerLeft;!0===e.scene.screenSpaceCameraController.enableTilt?(this.verticalView(),e.scene.screenSpaceCameraController.enableTilt=!1):e.scene.screenSpaceCameraController.enableTilt=!0},doubleViewer(){},shutterView(){},spaceDistance(){},surfaceArea(){},TriangleDistance(){},verticalDistance(){},viewPointManage(){},surroundBrowse(){},flyView(){},viewShed(){},openPDF(){window.open("_blank").location.href="用户手册.pdf"},viewerCapture(){let e=i.viewerLeft.scene.canvas.toDataURL("image/png"),t=atob(e.split(",")[1]),n=t.length,o=new Uint8Array(n);for(let e=0;e<n;e++)o[e]=t.charCodeAt(e);let r=document.createElement("a");r.download="scene.png",r.href=URL.createObjectURL(new Blob([o])),r.click()},runFunByName(e){"fullScreen"===e?this.fullScreen():"trueNorth"===e?this.trueNorth():"verticalView"===e?this.verticalView():"lockVerticalView"===e?this.lockVerticalView():"doubleViewer"===e?this.doubleViewer():"shutterView"===e?this.shutterView():"spaceDistance"===e?this.spaceDistance():"surfaceArea"===e?this.surfaceArea():"TriangleDistance"===e?this.TriangleDistance():"verticalDistance"===e?this.verticalDistance():"viewPointManage"===e?this.viewPointManage():"surroundBrowse"===e?this.surroundBrowse():"flyView"===e?this.flyView():"viewShed"===e?this.viewShed():"surfaceTransparent"===e||("openPDF"===e?this.openPDF():"viewerCapture"===e?this.viewerCapture():"resetMap"===e||console.log("未识别的操作"))}},y=class{constructor(e){let t=this;this.listenCallbacks=[],new o.ScreenSpaceEventHandler(e.scene.canvas).setInputAction(function(i){let n=e.scene.pick(i.position);o.defined(n)&&t.triggerEvent(n)},o.ScreenSpaceEventType.LEFT_CLICK)}addEventListener(e,t,i){return!this.listenCallbacks.find(n=>n.listenType===e&&n.callback===t&&n.scope===i)&&(this.listenCallbacks.push({listenType:e,callback:t,scope:i}),!0)}triggerEvent(e){this.listenCallbacks.forEach(t=>{"function"==typeof t.callback?t.callback(e):console.log("无法触发监听方法：",t.callback)})}removeListen(e){return!!this.listenCallbacks.find(t=>t.callback===e)&&(this.listenCallbacks=this.listenCallbacks.filter(t=>t.callback!==e),!0)}},b=function(e){let t=c.getConfig();e.scene.globe.baseColor=o.Color.BLACK,e._cesiumWidget._creditContainer.style.display="none",e.camera.DEFAULT_VIEW_RECTANGLE=o.Rectangle.fromDegrees(t.homeBox.west,t.homeBox.south,t.homeBox.east,t.homeBox.north),t&&t["viewer.resolutionScale"]&&(e.resolutionScale=t["viewer.resolutionScale"]),e.scene.camera.setView({destination:o.Cartesian3.fromDegrees(t.homeAddr.lon,t.homeAddr.lat,t.homeAddr.height)}),e.scene.fxaa=!0,e.scene.postProcessStages.fxaa.enabled=!0,o.FeatureDetection.supportsImageRenderingPixelated()&&(e.resolutionScale=window.devicePixelRatio)},C={createViewer(e,t=!0){!function(e){let t=document.getElementById(e);t.innerHTML="",t.style.position="absolute";let i=document.createElement("div");i.style.display="flex",i.style.position="absolute",i.style.width="100%",i.style.height="100%",i.style.minWidth="500px",i.style.minHeight="400px",t.appendChild(i);let n=document.createElement("div"),o=document.createElement("div");n.setAttribute("id","viewer3DDom"),o.setAttribute("id","viewer2DDom"),n.style.height="100%",o.style.height="100%",n.style.width="100%",o.style.width="100%",n.style.display="inline-block",o.style.display="inline-block",i.appendChild(n),i.appendChild(o)}(e);let i={homeButton:!1,fullscreenButton:!1,sceneModePicker:!1,clockViewModel:new o.ClockViewModel,infoBox:!1,geocoder:!1,sceneMode:o.SceneMode.SCENE2D,navigationHelpButton:!1,animation:!1,timeline:!1,baseLayerPicker:!1},n=new o.Viewer("viewer3DDom",{animation:!1,homeButton:!1,geocoder:!1,baseLayerPicker:!1,timeline:!1,fullscreenButton:!1,scene3DOnly:!0,infoBox:!0,sceneModePicker:!1,navigationInstructionsInitiallyVisible:!1,navigationHelpButton:!1,selectionIndicator:!1,vrButton:!0,shadows:!1,shouldAnimate:!0,contextOptions:{webgl:{preserveDrawingBuffer:!0}}}),r=new o.Viewer("viewer2DDom",i);return b(n),b(r),n.camera.changed.addEventListener(function(e,t){let i,n;return function(){let r=new o.Cartesian2(Math.floor(e.canvas.clientWidth/2),Math.floor(e.canvas.clientHeight/2)),a=e.scene.camera.pickEllipsoid(r);o.defined(a)&&(i=a),n=o.Cartesian3.distance(i,e.scene.camera.positionWC),t.scene.camera.lookAt(i,new o.Cartesian3(0,0,n))}}(n,r)),n.camera.percentageChanged=.01,function(e){document.getElementById("viewer2DDom").style.display="none",e.scene.screenSpaceCameraController.enableRotate=!1,e.scene.screenSpaceCameraController.enableTranslate=!1,e.scene.screenSpaceCameraController.enableZoom=!1,e.scene.screenSpaceCameraController.enableTilt=!1,e.scene.screenSpaceCameraController.enableLook=!1}(r),this.loadSource({viewer3D:n,viewer2D:r}),this.initEvent(n),{viewer3D:n,viewer2D:r}},createNavigation(e){!e&&(e=i.viewerLeft);let t=c.getConfig(),n={defaultResetView:o.Rectangle.fromDegrees(t.homeBox.west,t.homeBox.south,t.homeBox.east,t.homeBox.north),enableCompass:!0,enableZoomControls:!0,enableDistanceLegend:!0,enableCompassOuterRing:!0};e.extend(o.viewerCesiumNavigationMixin,n)},loadSource({viewer3D:e,viewer2D:t}){const n=i;n.viewerLeft=e,n.viewer2D=t,n.viewerLeftWorkSpace=new m(e),n.viewer2DWorkSpace=new m(t),e.imageryLayers.removeAll(),t.imageryLayers.removeAll(),c.getAllSources().forEach(e=>{!e.defaultLoad||"layer"!==e.dataType&&"dem"!==e.dataType||(n.viewerLeftWorkSpace.addData(e),n.viewer2DWorkSpace.addData(e))}),setTimeout(function(){c.getAllSources().forEach(e=>{e.defaultLoad&&"layer"!==e.dataType&&"dem"!==e.dataType&&(n.viewerLeftWorkSpace.addData(e),n.viewer2DWorkSpace.addData(e))})},2e3)},toggle2DShow(){s("#viewer2DDom").toggle(),s("#viewer3DDom").width="50%",s("#viewer2DDom").width="50%"},initEvent(e){i.screenEvent=new y(e)},open2D3D(){document.getElementById("viewer2DDom").style.display="inline-block"},close2D3D(){document.getElementById("viewer2DDom").style.display="none"},openDeBug(e){!e&&(e=i.viewerLeft),e.scene.debugShowFramesPerSecond=!0},closeDeBug(e){!e&&(e=i.viewerLeft),e.scene.debugShowFramesPerSecond=!1},initMonitorCoordinates({viewer:e,moveFun:t}){!e&&(e=i.viewerLeft);let n=e.scene.canvas,r=e.scene.globe.ellipsoid,a=new o.ScreenSpaceEventHandler(n),s=0,l=0,c=0,d=0,u=!0,h=!0;a.setInputAction(function(i){let n=e.camera.pickEllipsoid(i.endPosition,r);if(n){let t=e.scene.globe.ellipsoid.cartesianToCartographic(n);s=o.Math.toDegrees(t.longitude),l=o.Math.toDegrees(t.latitude),u=!0}else u=!1;e.terrainProvider instanceof o.EllipsoidTerrainProvider||h&&(h=!1,w.getTerrainMostDetailedHeight(o.Cartographic.fromDegrees(s,l),function(e){h=!0,c=e.height})),d=w.getCameraHeight()||3e6,u&&"function"==typeof t&&t(s,l,c,d)},o.ScreenSpaceEventType.MOUSE_MOVE),a.setInputAction(function(){d=w.getCameraHeight()||3e6,u&&"function"==typeof t&&t(s,l,c,d)},o.ScreenSpaceEventType.WHEEL)}};let v,S,T,P,E={},M={};function D(e){v&&!v.isDestroyed()||E[o.ScreenSpaceEventType.LEFT_CLICK]&&E[o.ScreenSpaceEventType.LEFT_CLICK].forEach(t=>{t.callback(e,t.scope)})}function k(e){S&&!S.isDestroyed()||M[o.ScreenSpaceEventType.LEFT_CLICK]&&M[o.ScreenSpaceEventType.LEFT_CLICK].forEach(t=>{t.callback(e,t.scope)})}function I(e){v&&!v.isDestroyed()||E[o.ScreenSpaceEventType.MOUSE_MOVE]&&E[o.ScreenSpaceEventType.MOUSE_MOVE].forEach(t=>{t.callback(e,t.scope)})}function L(e){S&&!S.isDestroyed()||M[o.ScreenSpaceEventType.MOUSE_MOVE]&&M[o.ScreenSpaceEventType.MOUSE_MOVE].forEach(t=>{t.callback(e,t.scope)})}var x={getHandle:(e,t)=>({handler:new o.ScreenSpaceEventHandler(e.canvas),errCallback:t||function(){console.log("默认事件监听器，被重置！")}}),getRuntimeHandle(e,t,n){let r;return e===i.viewerLeft?(v&&!v.isDestroyed()&&(v.errCallback&&"function"==typeof v.errCallback&&(v.errCallback(v.errCallbackScope),delete v.errCallbackScope,delete v.errCallback),v.destroy()),(v=new o.ScreenSpaceEventHandler(e.canvas)).errCallback=t,v.errCallbackScope=n,r=v):i.viewerRight&&e===i.viewerRight&&(S&&!S.isDestroyed()&&(S.errCallback&&"function"==typeof S.errCallback&&(S.errCallback(S.errCallbackScope),delete S.errCallbackScope,delete S.errCallback),S.destroy()),(S=new o.ScreenSpaceEventHandler(e.canvas)).errCallback=t,S.errCallbackScope=n,r=S),r},addEventListener(e,t,n,r){e===i.viewerLeft&&(T||((T=new o.ScreenSpaceEventHandler(e.canvas)).setInputAction(D,o.ScreenSpaceEventType.LEFT_CLICK),T.setInputAction(I,o.ScreenSpaceEventType.MOUSE_MOVE)),E[n]||(E[n]=[]),"function"==typeof t?E[n].push({callback:t,scope:r}):console.log("注册失败！")),e===i.viewerRight&&(P||((P=new o.ScreenSpaceEventHandler(e.canvas)).setInputAction(k,o.ScreenSpaceEventType.LEFT_CLICK),P.setInputAction(L,o.ScreenSpaceEventType.MOUSE_MOVE)),M[n]||(M[n]=[]),"function"==typeof t?M[n].push({callback:t,scope:r}):console.log("注册失败！"))}};let B={DeltaDegree:1e-5,DeltaRadian:1e-5*Math.PI/180,getBlankViewer:()=>new o.Viewer(document.createElement("div")),lat_to_meter:e=>e/1.57891e-7,lon_to_meter:(e,t)=>e/1.56785e-7*Math.cos(t),meter_to_lat:e=>1.57891e-7*e,meter_to_long:(e,t)=>1.56785e-7*e/Math.cos(t),cartesianToCartographicObj:function(e){let t=this.getBlankViewer(),i=[];for(let n=0;n<e.length;n++){let r=t.scene.globe.ellipsoid,a=new o.Cartesian3(e[n].x,e[n].y,e[n].z),s=r.cartesianToCartographic(a),l={longitude:o.Math.toDegrees(s.longitude),latitude:o.Math.toDegrees(s.latitude),height:s.height};i.push(l)}return i},cartesianToCartographicArr:function(e){let t=this.getBlankViewer(),i=[];for(let n=0;n<e.length;n++){let r=t.scene.globe.ellipsoid,a=new o.Cartesian3(e[n].x,e[n].y,e[n].z),s=r.cartesianToCartographic(a);i.push(s.longitude/Math.PI*180),i.push(s.latitude/Math.PI*180),i.push(s.height)}return i},cartesianToCartographicPoiArr:function(e){let t=this.getBlankViewer(),i=[];for(let n=0;n<e.length;n++){let r=t.scene.globe.ellipsoid,a=new o.Cartesian3(e[n].x,e[n].y,e[n].z),s=r.cartesianToCartographic(a);i.push([s.longitude/Math.PI*180,s.latitude/Math.PI*180,s.height])}return i},pointProjectLine:function(e,t,i,n,o,r,a){if(_(i,n,o,r,1e-7))return a[0]=i,a[1]=n,0;if(_(i,n,e,t,1e-7)||_(o,r,e,t,1e-7))return a[0]=e,a[1]=t,0;let s=this.TwoPointsDistance(i,n,e,t),l=this.vecAngle(i,n,o,r),c=this.TwoPointsDistance(i,n,o,r),d=l-this.vecAngle(i,n,e,t),u=Math.cos(d)*s;return a[0]=i+Math.cos(l)*u,a[1]=n+Math.sin(l)*u,u<0?-1:u<=c?0:1},TwoPointsDistance:(e,t,i,n)=>Math.sqrt((e-i)*(e-i)+(t-n)*(t-n)),vecAngle:function(e,t,i,n){let o,r;return o=i-e,r=n-t,this.normalizeVecAngle(Math.atan2(r,o))},normalizeVecAngle:e=>e-~~(e/(2*Math.PI))*(2*Math.PI),polarPoint:function(e,t,i,n){let o=new Array(2);return o[0]=e+n*Math.cos(i),o[1]=t+n*Math.sin(i),o},polygonRefDot:function(e){let t=e.coordinates;"MultiPolygon"==e.type&&(t=e.coordinates[0]);let i=new Float64Array([9999,9999,-9999,-9999]);for(let e=0;e<t.length;e++){let n=t[e];for(let e=0;e<n.length;e++)n[e][0]<i[0]&&(i[0]=n[e][0]),n[e][0]>i[2]&&(i[2]=n[e][0]),n[e][1]<i[1]&&(i[1]=n[e][1]),n[e][1]>i[3]&&(i[3]=n[e][1])}if(i[2]-i[0]<1e-13||i[3]-i[1]<1e-13)return new Float64Array([(i[0]+i[2])/2,(i[1]+i[3])/2]);let n,o=(i[0]+i[2])/2,r=[];for(let e=0;e<t.length;e++){let i=t[e];for(let e=0;e<i.length-1;e++){if(i[e][0]<=i[e+1][0]){if(o<i[e][0]||o>=i[e+1][0])continue}else if(o<=i[e+1][0]||o>i[e][0])continue;n=i[e][1]+(i[e+1][1]-i[e][1])*(o-i[e][0])/(i[e+1][0]-i[e][0]),r.push(n)}}return r.sort(),n=(r[0]+r[1])/2,new Float64Array([o,n])},deltaAngle:function(e,t){return this.normalizeVecAngle(t-e)},InterpolateLineLonlat:function(e,t){if(!e||!t)return null;if(!(e.lon&&e.lat&&t.lon&&t.lat))return null;if(!(A(e.lon)&&A(t.lon)&&O(e.lat)&&O(t.lat)))return null;let i=[];i.push([e.lon,e.lat]);let n=Math.sqrt(Math.pow(t.lon-e.lon,2)+Math.pow(t.lat-e.lat,2));if(n<=this.DeltaDegree)return i.push([t.lon,t.lat]),i;{let o=n/this.DeltaDegree,r=(t.lon-e.lon)/o,a=(t.lat-e.lat)/o;for(let t=0;t<o;t++){let n=e.lon+(t+1)*r,o=e.lat+(t+1)*a;i.push([n,o])}}return i},InterpolateLineCartographic:function(e,t,i){if(!e||!t)return null;if(!(e.longitude&&e.latitude&&t.longitude&&t.latitude))return null;let n=[];n.push(new o.Cartographic(e.longitude,e.latitude));let r=Math.sqrt(Math.pow(t.longitude-e.longitude,2)+Math.pow(t.latitude-e.latitude,2)),a=i&&"number"==typeof i?i:this.DeltaRadian;if(r<=a)return n.push(new o.Cartographic(t.longitude,t.latitude)),n;{let i=r/a,s=(t.longitude-e.longitude)/i,l=(t.latitude-e.latitude)/i;for(let t=0;t<i;t++){let i=e.longitude+(t+1)*s,r=e.latitude+(t+1)*l;n.push(new o.Cartographic(i,r))}n.push(new o.Cartographic(t.longitude,t.latitude,t.height))}return n},InterpolateLineHeightCartographic:function(e,t){if(!e||!t)return null;if(!(e.longitude&&e.latitude&&t.longitude&&t.latitude))return null;let i=[];i.push(new o.Cartographic(e.longitude,e.latitude,e.height));let n=Math.sqrt(Math.pow(t.longitude-e.longitude,2)+Math.pow(t.latitude-e.latitude,2));if(n<=this.DeltaRadian)return i.push(new o.Cartographic(t.longitude,t.latitude,t.height)),i;{let r=n/this.DeltaRadian,a=(t.longitude-e.longitude)/r,s=(t.latitude-e.latitude)/r,l=(t.height-e.height)/r;for(let t=0;t<r;t++){let n=e.longitude+(t+1)*a,r=e.latitude+(t+1)*s,c=e.height+(t+1)*l;i.push(new o.Cartographic(n,r,c))}i.push(new o.Cartographic(t.longitude,t.latitude,t.height))}return i},interpolate2IndexLineHeightCartographic:function(e,t,i,n){if(!e||!t)return null;if(!(e.longitude&&e.latitude&&t.longitude&&t.latitude))return null;let r=[];r.push(new o.Cartographic(e.longitude,e.latitude,e.height));let a=(t.longitude-e.longitude)/i,s=(t.latitude-e.latitude)/i,l=(t.height-e.height)/i;for(let t=0;t<n;t++){let i=e.longitude+(t+1)*a,n=e.latitude+(t+1)*s,c=e.height+(t+1)*l;r.push(new o.Cartographic(i,n,c))}return r},interpolateIndexLineHeightCartographic:function(e,t,i,n){if(!e||!t)return null;if(!(e.longitude&&e.latitude&&t.longitude&&t.latitude))return null;let r=(t.longitude-e.longitude)/i,a=(t.latitude-e.latitude)/i,s=(t.height-e.height)/i,l=e.longitude+n*r,c=e.latitude+n*a,d=e.height+n*s;return new o.Cartographic(l,c,d)},lonLat2WebMercator:function(e,t,i){return i||(i=[]),i[0]=20037508.34*e/180,i[1]=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180),i[1]=20037508.34*i[1]/180,i},webMercator2LonLat:function(e,t,i){return i||(i=[]),i[0]=e/20037508.34*180,i[1]=t/20037508.34*180,i[1]=180/Math.PI*(2*Math.atan(Math.exp(i[1]*Math.PI/180))-Math.PI/2),i},lonLat2GaussKruger3:function(e,t){let i=Math.floor(e/3);return a("+proj=longlat +datum=WGS84 +no_defs ","+proj=tmerc +lat_0=0 +lon_0="+3*i+" +k=1 +x_0=500000 +y_0=0 +ellps=GRS80 +units=m +no_defs").forward([e,t])},computeLineNormal:function(e,t,i,n,r){let a=this.lon_to_meter(e,t),s=this.lat_to_meter(t),l=this.lon_to_meter(i,n),c=this.lat_to_meter(n),d=(a+l)/2,u=(s+c)/2,h=this.vecAngle(a,s,l,c)-Math.PI/2,p=this.polarPoint(d,u,h,1),f=this.meter_to_lat(u),g=this.meter_to_long(d,f),m=this.meter_to_lat(p[1]),w=this.meter_to_long(p[0],m),y=new o.Cartesian3.fromDegrees(g,f,0),b=new o.Cartesian3.fromDegrees(w,m,0),C=new o.Cartesian3(b.x-y.x,b.y-y.y,b.z-y.z);return o.Cartesian3.normalize(C,r)},degree2rad:function(e){return e*Math.PI/180},rad2degree:function(e){return 180*e/Math.PI},computeArea:function(e){let t=e.length;if(t<3)return 0;let i=e[0][1]*(e[t-1][0]-e[1][0]);for(let n=1;n<t;n++)i+=e[n][1]*(e[n-1][0]-e[(n+1)%t][0]);return Math.abs(i/2)},calculationDistance:function(e,t){let i=e.y,n=t.y,o=e.x,r=t.x;return Math.sqrt((r-o)*(r-o)+(n-i)*(n-i))},douglasPeucker:function(e,t,i){if(!(e&&e.length>2))return null;e.forEach((e,t)=>{e.id=t});let n=function e(t,i,n,o,r,a){if(n<o){let s=0,l=t[n],c=t[o];if(Math.abs(l.x-c.x)>a||Math.abs(l.y-c.y)>a){let d=0;for(let e=n+1;e<o;e++){let i=W(l,c,t[e]);i>d&&(d=i,s=e)}d>=r&&(i.push(t[s]),e(t,i,n,s,r,a),e(t,i,s,o,r,a))}else(s=Math.floor((n+o)/2))>n&&s<o&&(i.push(t[s]),e(t,i,n,s,r,a),e(t,i,s,o,r,a))}return i}(e,[],0,e.length-1,t,i);n.push(e[0]),n.push(e[e.length-1]);let o=n.sort((e,t)=>e.id<t.id?-1:e.id>t.id?1:0);return o.forEach(e=>{e.id=void 0}),o},guid:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+e()+e()+e()+e()+e()+e()},BLHConvertToXYZ:function(e,t){e=o.Cartesian3.fromDegreesArrayHeights(e),t=o.Cartesian3.fromDegrees(t[0],t[1],t[2]);let i=o.Transforms.eastNorthUpToFixedFrame(t),n=o.Matrix4.inverse(i,new o.Matrix4),r=new Float64Array(3*e.length);for(let t=0;t<e.length;t++){let i=o.Matrix4.multiplyByPoint(n,e[t],new o.Cartesian3);r[3*t+0]=i.x,r[3*t+1]=i.y,r[3*t+2]=i.z}return r},calculationIntersection:function(e,t,i){i[0]?i[1]=e[1]+(i[0]-e[0])*(t[1]-e[1])/(t[0]-e[0]):i[0]=e[0]+(t[0]-e[0])*(i[1]-e[1])/(t[1]-e[1])},calculateTriangle:function(e){let t={x:e[0].x-e[1].x,y:e[0].y-e[1].y,z:e[0].z-e[1].z},i={x:e[1].x-e[2].x,y:e[1].y-e[2].y,z:e[1].z-e[2].z},n={x:e[0].x-e[2].x,y:e[0].y-e[2].y,z:e[0].z-e[2].z},r=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)+Math.pow(t.z,2)),a=Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2)+Math.pow(i.z,2)),s=Math.sqrt(Math.pow(n.x,2)+Math.pow(n.y,2)+Math.pow(n.z,2)),l=Math.acos((r**2+a**2-s**2)/(2*a*s));return o.Math.toDegrees(l)}};function _(e,t,i,n,o){return Math.abs(e-i)<o&&Math.abs(t-n)<o}function A(e){return!(e>180||e<-180)}function O(e){return!(e>90||e<-90)}function W(e,t,i){let n=Math.abs(B.calculationDistance(e,t)),o=Math.abs(B.calculationDistance(e,i)),r=Math.abs(B.calculationDistance(t,i)),a=(n+o+r)/2;return 2*Math.sqrt(Math.abs(a*(a-n)*(a-o)*(a-r)))/n}var R=B;function N(e="cartesian",t,i){"function"==typeof t&&t("cartographicObj"===e?R.cartesianToCartographicObj(i):"cartographicArr"===e?R.cartesianToCartographicArr(i):"cartographicPoiArr"===e?R.cartesianToCartographicPoiArr(i):i)}var G=class{constructor(e){this.viewer=e;let t=new o.CustomDataSource("画图工具-实体集合");this.dataSourceToo=t,e.dataSources.add(t),this.entityFactory=new u(e,t),this.dynamicPosition=null,this.dynamicPoint=null,this.coordinates=[],this.dynamicNodesPoint=[],this.drawEntities=null,this.height=null,this.errCallback=null,this.isDepthTest=null}drawPoint({coordinateType:e,endCallback:t,moveCallback:i,errCallback:n}){let r=this,{handler:a}=r.drawShapeStart();r.errCallback=n,a.setInputAction(function(i){let n=r.viewer.scene.pickPosition(i.position);o.defined(n)&&(a.isDestroyed()||(a.destroy(),a=null),r.drawShapeEnd(),N(e,t,[n]))},o.ScreenSpaceEventType.LEFT_CLICK),a.setInputAction(function(e){let t=r.viewer.scene.pickPosition(e.endPosition);o.defined(t)&&(o.defined(r.dynamicPoint)||(r.dynamicPoint=r.entityFactory.createPoint(t)),r.dynamicPoint.position.setValue(t)),"function"==typeof i&&i(t)},o.ScreenSpaceEventType.MOUSE_MOVE),a.setInputAction(function(e){a.isDestroyed()||(a.destroy(),a=null),r.drawShapeErrorCallback(),r.drawShapeEnd()},o.ScreenSpaceEventType.RIGHT_CLICK)}drawLine({coordinateType:e,endCallback:t,moveCallback:i,errCallback:n}){let r=this,{handler:a}=r.drawShapeStart();r.errCallback=n;let s=[];a.setInputAction(function(i){let n=r.viewer.scene.pickPosition(i.position);o.defined(n)&&(r.dynamicNodesPoint.push(r.entityFactory.createPoint(n)),r.coordinates.push(n),s.push(n),r.drawEntities||(r.drawEntities=r.dataSourceToo.entities.add({polyline:{positions:new o.CallbackProperty(function(){return r.coordinates},!1),width:3,clampToGround:!0,arcType:o.ArcType.RHUMB,material:o.Color.GREEN}})),2===s.length&&(N(e,t,s),a.isDestroyed()||(a.destroy(),a=null),r.drawShapeEnd()))},o.ScreenSpaceEventType.LEFT_CLICK),a.setInputAction(function(e){let t=r.viewer.scene.pickPosition(e.endPosition);o.defined(t)&&(o.defined(r.dynamicPoint)||(r.dynamicPoint=r.entityFactory.createPoint(t)),r.dynamicPoint.position.setValue(t),1===r.coordinates.length&&r.coordinates.push(t),2===r.coordinates.length&&(r.coordinates.pop(),r.coordinates.push(t)),"function"==typeof i&&i(r.coordinates))},o.ScreenSpaceEventType.MOUSE_MOVE),a.setInputAction(function(e){a.isDestroyed()||(a.destroy(),a=null),r.drawShapeErrorCallback()},o.ScreenSpaceEventType.RIGHT_CLICK)}drawPolyLine({coordinateType:e,endCallback:t,moveCallback:i,errCallback:n}){let r=this,{handler:a}=r.drawShapeStart();r.errCallback=n;let s,l=[];a.setInputAction(function(e){let t=r.viewer.scene.pickPosition(e.position);o.defined(t)&&(r.dynamicNodesPoint.push(r.entityFactory.createPoint(t)),l.push(t),r.coordinates.push(t),r.drawEntities||(s=new o.CallbackProperty(function(){return r.coordinates},!1),r.drawEntities=r.dataSourceToo.entities.add({polyline:{positions:s,width:3,clampToGround:!0,arcType:o.ArcType.RHUMB,material:o.Color.GREEN}})))},o.ScreenSpaceEventType.LEFT_CLICK),a.setInputAction(function(e){let t=r.viewer.scene.pickPosition(e.endPosition);o.defined(t)&&(o.defined(r.dynamicPoint)||(r.dynamicPoint=r.entityFactory.createPoint(t)),r.dynamicPoint.position.setValue(t),1===r.coordinates.length&&r.coordinates.push(t),r.coordinates.length>=2&&(r.coordinates.pop(),r.coordinates.push(t)),"function"==typeof i&&i(r.coordinates))},o.ScreenSpaceEventType.MOUSE_MOVE),a.setInputAction(function(i){a.isDestroyed()||(a.destroy(),a=null),r.drawShapeEnd(),l.length>=2?N(e,t,l):r.drawShapeErrorCallback()},o.ScreenSpaceEventType.RIGHT_CLICK)}drawTriangle({coordinateType:e,endCallback:t,moveCallback:i,errCallback:n}){let r=this,{handler:a}=r.drawShapeStart();r.errCallback=n;let s,l=[];a.setInputAction(function(i){let n=r.viewer.scene.pickPosition(i.position);o.defined(n)&&(r.dynamicNodesPoint.push(r.entityFactory.createPoint(n)),l.push(n),r.coordinates.push(n),r.drawEntities||(s=new o.CallbackProperty(function(){return r.coordinates},!1),r.drawEntities=r.dataSourceToo.entities.add({polyline:{positions:s,width:3,clampToGround:!0,arcType:o.ArcType.RHUMB,material:o.Color.GREEN}})),3===l.length&&(N(e,t,l),a.isDestroyed()||(a.destroy(),a=null),r.drawShapeEnd()))},o.ScreenSpaceEventType.LEFT_CLICK),a.setInputAction(function(e){let t=r.viewer.scene.pickPosition(e.endPosition);o.defined(t)&&(o.defined(r.dynamicPoint)||(r.dynamicPoint=r.entityFactory.createPoint(t)),r.dynamicPoint.position.setValue(t),1===r.coordinates.length&&r.coordinates.push(t),r.coordinates.length>=2&&(r.coordinates.pop(),r.coordinates.push(t)),"function"==typeof i&&i(r.coordinates))},o.ScreenSpaceEventType.MOUSE_MOVE),a.setInputAction(function(i){a.isDestroyed()||(a.destroy(),a=null),r.drawShapeEnd(),l.length>=2?N(e,t,l):r.drawShapeErrorCallback()},o.ScreenSpaceEventType.RIGHT_CLICK)}drawPolygon({coordinateType:e,endCallback:t,moveCallback:i,errCallback:n}){let r=this,{handler:a}=r.drawShapeStart();r.errCallback=n;let s=[];a.setInputAction(function(e){let t=r.viewer.scene.pickPosition(e.position);o.defined(t)&&(r.dynamicNodesPoint.push(r.entityFactory.createPoint(t)),s.push(JSON.parse(JSON.stringify(t))),r.coordinates.push(t),2===r.dynamicNodesPoint.length&&(r.drawEntities||(r.dynamicPosition=new o.CallbackProperty(function(){return new o.PolygonHierarchy(r.coordinates)},!1),r.drawEntities=r.dataSourceToo.entities.add({polygon:{hierarchy:r.dynamicPosition,material:new o.ColorMaterialProperty(o.Color.LIGHTSKYBLUE.withAlpha(.3)),heightReference:o.HeightReference.NONE}}))))},o.ScreenSpaceEventType.LEFT_CLICK),a.setInputAction(function(e){let t=r.viewer.scene.pickPosition(e.endPosition);if(o.defined(t)&&(o.defined(r.dynamicPoint)||(r.dynamicPoint=r.entityFactory.createPoint(t)),r.dynamicPoint.position.setValue(t),r.coordinates.pop(),r.coordinates.push(t),"function"==typeof i)){let e=JSON.parse(JSON.stringify(s));e.push(JSON.parse(JSON.stringify(t))),i(e)}},o.ScreenSpaceEventType.MOUSE_MOVE),a.setInputAction(function(){a.isDestroyed()||(a.destroy(),a=null),r.drawShapeEnd(),s.length>=2?(s.push(s[0]),N(e,t,s)):r.drawShapeErrorCallback()},o.ScreenSpaceEventType.RIGHT_CLICK)}drwCurve({coordinateType:e,endCallback:t,moveCallback:i,errCallback:n}){}drawCircle({endCallback:e,moveCallback:t,errCallback:i}){let n,r,a=this,{handler:s}=a.drawShapeStart();a.errCallback=i;let l=0;s.setInputAction(function(t){let i=a.viewer.scene.pickPosition(t.position);o.defined(i)&&(a.dynamicNodesPoint.push(a.entityFactory.createPoint(i)),r?("function"==typeof e&&e({Center:r,EndPoint:i,Radius:l}),s.isDestroyed()||(s.destroy(),s=null),a.drawShapeEnd()):r=i)},o.ScreenSpaceEventType.LEFT_CLICK),s.setInputAction(function(e){let i=a.viewer.scene.pickPosition(e.endPosition);if(o.defined(i)&&(o.defined(a.dynamicPoint)||(a.dynamicPoint=a.entityFactory.createPoint(i)),a.dynamicPoint.position.setValue(i),r)){let e=a.viewer.scene.globe.ellipsoid.cartesianToCartographic(r),s=a.viewer.scene.globe.ellipsoid.cartesianToCartographic(i),c=new o.EllipsoidGeodesic(e,s);l=c.surfaceDistance,"function"==typeof t&&t({Center:r,EndPoint:i,Radius:l}),n||(n=new o.CallbackProperty(function(){return l},!1)),a.drawEntities||(a.drawEntities=a.dataSourceToo.entities.add({position:r,name:"Red ellipse on surface",ellipse:{semiMinorAxis:n,semiMajorAxis:n,material:o.Color.RED.withAlpha(.5)}}))}},o.ScreenSpaceEventType.MOUSE_MOVE),s.setInputAction(function(e){s.isDestroyed()||(s.destroy(),s=null),a.drawShapeErrorCallback()},o.ScreenSpaceEventType.RIGHT_CLICK)}drawRectangle({coordinateType:e,endCallback:t,moveCallback:i,errCallback:n}){let r=this,{handler:a}=r.drawShapeStart();r.errCallback=n;let s,l=[],c=[];a.setInputAction(function(i){let n=r.viewer.scene.pickPosition(i.position);o.defined(n)&&(r.dynamicNodesPoint.push(r.entityFactory.createPoint(n)),l.push(n),1===l.length&&(r.drawEntities||(s=new o.CallbackProperty(function(){return new o.PolygonHierarchy(c)},!1),r.drawEntities=r.dataSourceToo.entities.add({polygon:{hierarchy:s,material:new o.ColorMaterialProperty(o.Color.LIGHTSKYBLUE.withAlpha(.3)),heightReference:o.HeightReference.NONE}}))),2===l.length&&(l[1]=n,c=r.getRectanglePoint(r.viewer,l[0],l[1]),N(e,t,c),a.isDestroyed()||(a.destroy(),a=null),r.drawShapeEnd()))},o.ScreenSpaceEventType.LEFT_CLICK),a.setInputAction(function(e){let t=r.viewer.scene.pickPosition(e.endPosition);o.defined(t)&&(o.defined(r.dynamicPoint)||(r.dynamicPoint=r.entityFactory.createPoint(t)),r.dynamicPoint.position.setValue(t)),1===l.length&&t&&(c=c=r.getRectanglePoint(r.viewer,l[0],t),"function"==typeof i&&i(r.coordinates))},o.ScreenSpaceEventType.MOUSE_MOVE),a.setInputAction(function(){a.isDestroyed()||(a.destroy(),a=null),r.drawShapeErrorCallback()},o.ScreenSpaceEventType.RIGHT_CLICK)}drawInclinedRectangle({coordinateType:e,endCallback:t,moveCallback:i,errCallback:n}){let r,a=this,{handler:s}=a.drawShapeStart();a.errCallback=n,s.setInputAction(function(i){let n=a.viewer.scene.pickPosition(i.position);o.defined(n)&&(a.dynamicNodesPoint.push(a.entityFactory.createPoint(n)),a.coordinates.length<2&&a.coordinates.push(n),2===a.dynamicNodesPoint.length&&(a.drawEntities||(r=new o.CallbackProperty(function(){return new o.PolygonHierarchy(a.coordinates)},!1),a.drawEntities=a.dataSourceToo.entities.add({polygon:{hierarchy:r,material:new o.ColorMaterialProperty(o.Color.LIGHTSKYBLUE.withAlpha(.3)),heightReference:o.HeightReference.NONE}}))),3===a.dynamicNodesPoint.length&&(N(e,t,a.coordinates),s.isDestroyed()||(s.destroy(),s=null),a.drawShapeEnd()))},o.ScreenSpaceEventType.LEFT_CLICK),s.setInputAction(function(e){let t=a.viewer.scene.pickPosition(e.endPosition);if(o.defined(t)&&(o.defined(a.dynamicPoint)||(a.dynamicPoint=a.entityFactory.createPoint(t)),a.dynamicPoint.position.setValue(t)),2===a.coordinates.length){let e=new o.Cartesian3,i=new o.Cartesian3;a.getInclinedRectangle(a.coordinates[0],a.coordinates[1],t,e,i),a.coordinates.push(e,i)}else if(a.coordinates.length>2){a.coordinates.pop(),a.coordinates.pop();let e=new o.Cartesian3,n=new o.Cartesian3;a.getInclinedRectangle(a.coordinates[0],a.coordinates[1],t,e,n),a.coordinates.push(e),a.coordinates.push(n),"function"==typeof i&&i(a.coordinates)}},o.ScreenSpaceEventType.MOUSE_MOVE),s.setInputAction(function(){s.isDestroyed()||(s.destroy(),s=null),a.drawShapeErrorCallback()},o.ScreenSpaceEventType.RIGHT_CLICK)}startDrawingeYPlan({position:e,normal:t,dimensions:i,endCallback:n,moveCallback:r,errCallback:a}){let s=this,{handler:l}=s.drawShapeStart();var c;s.errCallback=a;var d=0,u=new o.ClippingPlane(t,0);s.drawEntities=s.dataSourceToo.entities.add({position:e,plane:{dimensions:i,material:o.Color.BLUE.withAlpha(.5),plane:new o.CallbackProperty(function(e){return function(){return e.distance=d,e}}(u),!1),outline:!0,outlineColor:o.Color.BLUE}}),s.drawEntities.startDrawingeYPlan="startDrawingeYPlan",l.setInputAction(function(e){var t=s.viewer.scene.pick(e.position);o.defined(t)&&o.defined(t.id)&&o.defined(t.id.plane)&&"startDrawingeYPlan"==t.id.startDrawingeYPlan&&((c=t.id.plane).material=o.Color.RED.withAlpha(.5),c.outlineColor=o.Color.RED,s.viewer.scene.screenSpaceCameraController.enableInputs=!1)},o.ScreenSpaceEventType.LEFT_DOWN),l.setInputAction(function(){o.defined(c)&&(c.material=o.Color.BLUE.withAlpha(.5),c.outlineColor=o.Color.BLUE,c=void 0),"function"==typeof n&&n(d),s.viewer.scene.screenSpaceCameraController.enableInputs=!0},o.ScreenSpaceEventType.LEFT_UP),l.setInputAction(function(e){if(o.defined(c)){var t=e.startPosition.y-e.endPosition.y;d+=t}},o.ScreenSpaceEventType.MOUSE_MOVE),l.setInputAction(function(e){l.isDestroyed()||(l.destroy(),l=null),s.drawShapeErrorCallback()},o.ScreenSpaceEventType.RIGHT_CLICK)}getInclinedRectangle(e,t,i,n,r){let a=o.Cartographic.fromCartesian(e),s=o.Cartographic.fromCartesian(t),l=o.Cartographic.fromCartesian(i),c=(a.longitude+s.longitude)/2,d=(a.latitude+s.latitude)/2,u=R.lon_to_meter(a.longitude-c,a.latitude),h=R.lat_to_meter(a.latitude-d),p=R.lon_to_meter(s.longitude-c,s.latitude),f=R.lat_to_meter(s.latitude-d),g=R.lon_to_meter(l.longitude-c,l.latitude),m=R.lat_to_meter(l.latitude-d),w=[];R.pointProjectLine(g,m,u,h,p,f,w);let y=R.TwoPointsDistance(g,m,w[0],w[1]),b=R.vecAngle(w[0],w[1],g,m),C=R.polarPoint(u,h,b,y),v=R.polarPoint(p,f,b,y),S=R.meter_to_lat(C[1])+d,T=R.meter_to_long(C[0],S)+c,P=R.meter_to_lat(v[1])+d,E=R.meter_to_long(v[0],P)+c;a.longitude=T,a.latitude=S,s.longitude=E,s.latitude=P,o.Cartographic.toCartesian(a,o.Ellipsoid.WGS84,r),o.Cartographic.toCartesian(s,o.Ellipsoid.WGS84,n)}getRectanglePoint(e,t){let i=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(e),n=o.Math.toDegrees(i.longitude),r=o.Math.toDegrees(i.latitude),a=this.viewer.scene.globe.ellipsoid.cartesianToCartographic(t),s=o.Math.toDegrees(a.longitude),l=o.Math.toDegrees(a.latitude),c=Math.min(n,s),d=Math.max(n,s),u=Math.min(r,l),h=Math.max(r,l),p=o.Cartesian3.fromDegrees(c,h);return[p,o.Cartesian3.fromDegrees(d,h),o.Cartesian3.fromDegrees(d,u),o.Cartesian3.fromDegrees(c,u),p]}drawShapeErrorCallback(){let e=this;e.clearDrawEntity(),e.errCallback&&"function"==typeof e.errCallback&&(e.errCallback(),e.errCallback=null)}drawShapeStart(){let e=this,t=x.getHandle(e.viewer,e.drawShapeErrorCallback).handler;return e.isDepthTest=e.viewer.scene.globe.depthTestAgainstTerrain,e.isDepthTest||(e.viewer.scene.globe.depthTestAgainstTerrain=!0,console.log("%c自动开启深度检测！","color: #43bb88;")),{handler:t}}drawShapeEnd(){let e=this;e.clearDrawEntity(),e.viewer.scene.globe.depthTestAgainstTerrain=e.isDepthTest,e.isDepthTest||(e.viewer.scene.globe.depthTestAgainstTerrain=!1,console.log("%c自动关闭深度检测！","color: rgb(200,20,20);"))}clearDrawEntity(){let e=this;e.dynamicPosition=null,e.dynamicPoint&&e.dataSourceToo.entities.remove(e.dynamicPoint),e.dynamicPoint=null,e.coordinates=[];for(let t=0;t<e.dynamicNodesPoint.length;t++)e.dynamicNodesPoint[t]&&e.dataSourceToo.entities.remove(e.dynamicNodesPoint[t]);e.dynamicNodesPoint=[],e.drawEntities&&e.dataSourceToo.entities.remove(e.drawEntities),e.drawEntities=null}};let F={contents:[o.Rectangle.fromDegrees(113.537926,36.066539,119.848199,42.656242),o.Rectangle.fromDegrees(116.784339,39.929257,117.109741,40.043802)],startFlyCallbacks:[],endFlyCallbacks:[],start(e){let t=i.viewerLeft;e&&(this.contents=[o.Rectangle.fromDegrees(e[0][0],e[0][1],e[0][2],e[0][3]),o.Rectangle.fromDegrees(e[1][0],e[1][1],e[1][2],e[1][3])]),F.startFlyCallbacks.forEach(e=>{e()}),t.camera.flyTo({destination:this.contents[0],duration:2,complete:function(){t.camera.flyTo({destination:this.contents[1],complete:function(){F.endFlyCallbacks.forEach(e=>{e()})}})}})},onStartFly(e){"function"==typeof e&&this.startFlyCallbacks.push(e)},onEndFly(e){"function"==typeof e&&this.endFlyCallbacks.push(e)}};var V=F;let K,H,z,U;function J(e){let t=e.camera.positionCartographic.height,i=Date.now(),n=(i-H)/1e3*5/180*Math.PI*(t/24678990.67414785);H=i,e.scene.camera.rotate(o.Cartesian3.UNIT_Z,-n)}function Z(e){(new Date).getTime()-K.getTime()>6e4&&function(e){H=Date.now(),e.clock.onTick.addEventListener(J),window.clearInterval(z),z=null}(e)}var q={rotateInit(e){let t=this;(U=new o.ScreenSpaceEventHandler(e.scene.canvas)).setInputAction(function(){t.endRote(e)},o.ScreenSpaceEventType.MOUSE_MOVE)},endRote(e){e.clock.onTick.removeEventListener(J),z||(z=window.setInterval(Z,500)),K=new Date}};function j(){}function Q(e){let t,i;return j.WKBByteOrder.wkbNDR==e.byteOrder?(t=e.buffer.readDoubleLE(e.offset),e.offset+=8,i=e.buffer.readDoubleLE(e.offset),e.offset+=8):(t=e.buffer.readDoubleBE(e.offset),e.offset+=8,i=e.buffer.readDoubleBE(e.offset),e.offset+=8),new j.Point(t,i)}function Y(e){let t,i,n;return j.WKBByteOrder.wkbNDR==e.byteOrder?(t=e.buffer.readDoubleLE(e.offset),e.offset+=8,i=e.buffer.readDoubleLE(e.offset),e.offset+=8,n=e.buffer.readDoubleLE(e.offset),e.offset+=8):(t=e.buffer.readDoubleBE(e.offset),e.offset+=8,i=e.buffer.readDoubleBE(e.offset),e.offset+=8,n=e.buffer.readDoubleBE(e.offset),e.offset+=8),new j.PointZ(t,i,n)}function X(e){let t,i,n;return j.WKBByteOrder.wkbNDR==e.byteOrder?(t=e.buffer.readDoubleLE(e.offset),e.offset+=8,i=e.buffer.readDoubleLE(e.offset),e.offset+=8,n=e.buffer.readDoubleLE(e.offset),e.offset+=8):(t=e.buffer.readDoubleBE(e.offset),e.offset+=8,i=e.buffer.readDoubleBE(e.offset),e.offset+=8,n=e.buffer.readDoubleBE(e.offset),e.offset+=8),new j.PointM(t,i,n)}function ee(e){let t,i,n,o;return j.WKBByteOrder.wkbNDR==e.byteOrder?(t=e.buffer.readDoubleLE(e.offset),e.offset+=8,i=e.buffer.readDoubleLE(e.offset),e.offset+=8,n=e.buffer.readDoubleLE(e.offset),e.offset+=8,o=e.buffer.readDoubleLE(e.offset),e.offset+=8):(t=e.buffer.readDoubleBE(e.offset),e.offset+=8,i=e.buffer.readDoubleBE(e.offset),e.offset+=8,n=e.buffer.readDoubleBE(e.offset),e.offset+=8,o=e.buffer.readDoubleBE(e.offset),e.offset+=8),new j.PointZM(t,i,n,o)}function te(e){let t,i=e.buffer,n=null,o=i[e.offset];if(e.offset++,j.WKBByteOrder.wkbNDR==o?(t=i.readInt32LE(e.offset),e.offset+=4):(t=i.readInt32BE(e.offset),e.offset+=4),t==j.WKBGeometryType.wkbLineString){let t;j.WKBByteOrder.wkbNDR==o?(t=i.readInt32LE(e.offset),e.offset+=4):(t=i.readInt32BE(e.offset),e.offset+=4);let r=[];for(let i=0;i<t;i++)r.push(Q(e));n=new j.LinearRing(t,r)}return n}function ie(e){let t,i=e.buffer,n=null,o=i[e.offset];if(e.offset++,j.WKBByteOrder.wkbNDR==o?(t=i.readInt32LE(e.offset),e.offset+=4):(t=i.readInt32BE(e.offset),e.offset+=4),t==j.WKBGeometryType.wkbLineStringZ){let t;j.WKBByteOrder.wkbNDR==o?(t=i.readInt32LE(e.offset),e.offset+=4):(t=i.readInt32BE(e.offset),e.offset+=4);let r=[];for(let i=0;i<t;i++)r.push(Y(e));n=new j.LinearRingZ(t,r)}return n}function ne(e){let t,i=e.buffer,n=null,o=i[e.offset];if(e.offset++,j.WKBByteOrder.wkbNDR==o?(t=i.readInt32LE(e.offset),e.offset+=4):(t=i.readInt32BE(e.offset),e.offset+=4),t==j.WKBGeometryType.wkbLineStringM){let t;j.WKBByteOrder.wkbNDR==o?(t=i.readInt32LE(e.offset),e.offset+=4):(t=i.readInt32BE(e.offset),e.offset+=4);let r=[];for(let i=0;i<t;i++)r.push(X(e));n=new j.LinearRingM(t,r)}return n}function oe(e){let t,i=e.buffer,n=null,o=i[e.offset];if(e.offset++,j.WKBByteOrder.wkbNDR==o?(t=i.readInt32LE(e.offset),e.offset+=4):(t=i.readInt32BE(e.offset),e.offset+=4),t==j.WKBGeometryType.wkbLineStringZM){let t;j.WKBByteOrder.wkbNDR==o?(t=i.readInt32LE(e.offset),e.offset+=4):(t=i.readInt32BE(e.offset),e.offset+=4);let r=[];for(let i=0;i<t;i++)r.push(ee(e));n=new j.LinearRingZM(t,r)}return n}function re(e){let t,i=e.buffer,n=null,o=i[e.offset];if(e.offset++,j.WKBByteOrder.wkbNDR==o?(t=i.readInt32LE(e.offset),e.offset+=4):(t=i.readInt32BE(e.offset),e.offset+=4),t==j.WKBGeometryType.wkbPolygon){let r;j.WKBByteOrder.wkbNDR==o?(r=i.readInt32LE(e.offset),e.offset+=4):(r=i.readInt32BE(e.offset),e.offset+=4);let a=[];for(let t=0;t<r;t++){let t;j.WKBByteOrder.wkbNDR==o?(t=i.readInt32LE(e.offset),e.offset+=4):(t=i.readInt32BE(e.offset),e.offset+=4);let n=[];for(let r=0;r<t;r++){let t,r;j.WKBByteOrder.wkbNDR==o?(t=i.readDoubleLE(e.offset),e.offset+=8,r=i.readDoubleLE(e.offset),e.offset+=8):(t=i.readDoubleBE(e.offset),e.offset+=8,r=i.readDoubleBE(e.offset),e.offset+=8);let a=new j.Point(t,r);n.push(a)}let r=new j.LinearRing(t,n);a.push(r)}n=new j.WKBPolygon(o,t,r,a)}return n}function ae(){}function se(){}function le(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}j.WKBByteOrder={},j.WKBByteOrder.wkbXDR=0,j.WKBByteOrder.wkbNDR=1,j.WKBGeometryType={},j.WKBGeometryType.wkbPoint=1,j.WKBGeometryType.wkbLineString=2,j.WKBGeometryType.wkbPolygon=3,j.WKBGeometryType.wkbTriangle=17,j.WKBGeometryType.wkbMultiPoint=4,j.WKBGeometryType.wkbMultiLineString=5,j.WKBGeometryType.wkbMultiPolygon=6,j.WKBGeometryType.wkbGeometryCollection=7,j.WKBGeometryType.wkbPolyhedralSurface=15,j.WKBGeometryType.wkbTIN=16,j.WKBGeometryType.wkbPointZ=1001,j.WKBGeometryType.wkbLineStringZ=1002,j.WKBGeometryType.wkbPolygonZ=1003,j.WKBGeometryType.wkbTrianglez=1017,j.WKBGeometryType.wkbMultiPointZ=1004,j.WKBGeometryType.wkbMultiLineStringZ=1005,j.WKBGeometryType.wkbMultiPolygonZ=1006,j.WKBGeometryType.wkbGeometryCollectionZ=1007,j.WKBGeometryType.wkbPolyhedralSurfaceZ=1015,j.WKBGeometryType.wkbTINZ=1016,j.WKBGeometryType.wkbPointM=2001,j.WKBGeometryType.wkbLineStringM=2002,j.WKBGeometryType.wkbPolygonM=2003,j.WKBGeometryType.wkbTriangleM=2017,j.WKBGeometryType.wkbMultiPointM=2004,j.WKBGeometryType.wkbMultiLineStringM=2005,j.WKBGeometryType.wkbMultiPolygonM=2006,j.WKBGeometryType.wkbGeometryCollectionM=2007,j.WKBGeometryType.wkbPolyhedralSurfaceM=2015,j.WKBGeometryType.wkbTINM=2016,j.WKBGeometryType.wkbPointZM=3001,j.WKBGeometryType.wkbLineStringZM=3002,j.WKBGeometryType.wkbPolygonZM=3003,j.WKBGeometryType.wkbTriangleZM=3017,j.WKBGeometryType.wkbMultiPointZM=3004,j.WKBGeometryType.wkbMultiLineStringZM=3005,j.WKBGeometryType.wkbMultiPolygonZM=3006,j.WKBGeometryType.wkbGeometryCollectionZM=3007,j.WKBGeometryType.wkbPolyhedralSurfaceZM=3015,j.WKBGeometryType.wkbTinZM=3016,j.fromBase64=function(e){let t=new j;!function(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace("-","+").replace("_","/"),i=window.atob(t),n=new Uint8Array(i.length);for(let e=0;e<i.length;++e)n[e]=i.charCodeAt(e)}(e);switch(t.buffer=function(e){if(e.length>2147483647)throw new RangeError('The value "'+length+'" is invalid for option "size"');var t=e;for(let e in se.prototype)t.__proto__[e]||(t.__proto__[e]=se.prototype[e]);return t}(o),t.length=o.length,t.offset=0,t.byteOrder=o[t.offset],t.offset++,j.WKBByteOrder.wkbNDR==t.byteOrder?(t.wkbType=t.buffer.readInt32LE(t.offset),t.offset+=4):(t.wkbType=t.buffer.readInt32BE(t.offset),t.offset+=4),t.wkbType){case j.WKBGeometryType.wkbPoint:t.geom=Q(t);break;case j.WKBGeometryType.wkbPointZ:t.geom=Y(t);break;case j.WKBGeometryType.wkbPointM:t.geom=X(t);break;case j.WKBGeometryType.wkbPointZM:t.geom=ee(t);break;case j.WKBGeometryType.wkbLineString:case j.WKBGeometryType.wkbLineStringZ:case j.WKBGeometryType.wkbLineStringM:case j.WKBGeometryType.wkbLineStringZM:t.geom=te(t);break;case j.WKBGeometryType.wkbMultiLineString:j.WKBByteOrder.wkbNDR==t.byteOrder?(n=t.buffer.readInt32LE(t.offset),t.offset+=4):(n=t.buffer.readInt32BE(t.offset),t.offset+=4);var i=[];for(let e=0;e<n;e++)i.push(te(t));t.geom=new j.WKBMultiLineString(t.byteOrder,j.WKBGeometryType.wkbMultiLineString,n,i);break;case j.WKBGeometryType.wkbMultiLineStringZ:j.WKBByteOrder.wkbNDR==t.byteOrder?(n=t.buffer.readInt32LE(t.offset),t.offset+=4):(n=t.buffer.readInt32BE(t.offset),t.offset+=4),i=[];for(let e=0;e<n;e++)i.push(ie(t));t.geom=new j.WKBMultiLineStringZ(t.byteOrder,j.WKBGeometryType.wkbMultiLineStringZ,n,i);break;case j.WKBGeometryType.wkbMultiLineStringM:j.WKBByteOrder.wkbNDR==t.byteOrder?(n=t.buffer.readInt32LE(t.offset),t.offset+=4):(n=t.buffer.readInt32BE(t.offset),t.offset+=4),i=[];for(let e=0;e<n;e++)i.push(ne(t));t.geom=new j.WKBMultiLineStringM(t.byteOrder,j.WKBGeometryType.wkbMultiLineStringM,n,i);break;case j.WKBGeometryType.wkbMultiLineStringZM:var n;j.WKBByteOrder.wkbNDR==t.byteOrder?(n=t.buffer.readInt32LE(t.offset),t.offset+=4):(n=t.buffer.readInt32BE(t.offset),t.offset+=4),i=[];for(let e=0;e<n;e++)i.push(oe(t));t.geom=new j.WKBMultiLineStringZM(t.byteOrder,j.WKBGeometryType.wkbMultiLineStringZM,n,i);break;case j.WKBGeometryType.wkbPolygon:let e;j.WKBByteOrder.wkbNDR==t.byteOrder?(e=t.buffer.readInt32LE(t.offset),t.offset+=4):(e=t.buffer.readInt32BE(t.offset),t.offset+=4);let o=[];for(let i=0;i<e;i++){let e;j.WKBByteOrder.wkbNDR==t.byteOrder?(e=t.buffer.readInt32LE(t.offset),t.offset+=4):(e=t.buffer.readInt32BE(t.offset),t.offset+=4);let i=[];for(let n=0;n<e;n++)i.push(Q(t));let n=new j.LinearRing(e,i);o.push(n)}let r=new j.WKBPolygon(t.byteOrder,t.wkbType,e,o);t.geom=r;break;case j.WKBGeometryType.wkbMultiPolygon:let a;j.WKBByteOrder.wkbNDR==t.byteOrder?(a=t.buffer.readInt32LE(t.offset),t.offset+=4):(a=t.buffer.readInt32BE(t.offset),t.offset+=4);let s=[];for(let e=0;e<a;e++)s.push(re(t));t.geom=new j.WKBMultiPolygon(t.byteOrder,j.WKBGeometryType.wkbMultiPolygon,a,s);break;default:console.log("暂时不支持的wkb数据类型；"+t.wkbType)}return t},j.Point=function(e,t){this.x=e,this.y=t},j.PointZ=function(e,t,i){this.x=e,this.y=t,this.z=i},j.PointM=function(e,t,i){this.x=e,this.y=t,this.m=i},j.PointZM=function(e,t,i,n){this.x=e,this.y=t,this.z=i,this.m=n},j.LinearRing=function(e,t){this.numPoints=e,this.points=t},j.LinearRingZ=function(e,t){this.numPoints=e,this.points=t},j.LinearRingM=function(e,t){this.numPoints=e,this.points=t},j.LinearRingZM=function(e,t){this.numPoints=e,this.points=t},j.WKBMultiLineString=function(e,t,i,n){this.byteOrder=e,this.wkbType=t,this.numLineStrings=i,this.lineStrings=n},j.WKBMultiLineStringZ=function(e,t,i,n){this.byteOrder=e,this.wkbType=t,this.numLineStrings=i,this.lineStrings=n},j.WKBMultiLineStringM=function(e,t,i,n){this.byteOrder=e,this.wkbType=t,this.numLineStrings=i,this.lineStrings=n},j.WKBMultiLineStringZM=function(e,t,i,n){this.byteOrder=e,this.wkbType=t,this.numLineStrings=i,this.lineStrings=n},j.WKBPolygon=function(e,t,i,n){this.byteOrder=e,this.wkbType=t,this.numRings=i,this.rings=n},j.WKBMultiPolygon=function(e,t,i,n){this.byteOrder=e,this.wkbType=t,this.numPolygons=i,this.polygons=n},ae.read=function(e,t,i,n,o){var r,a,s=8*o-n-1,l=(1<<s)-1,c=l>>1,d=-7,u=i?o-1:0,h=i?-1:1,p=e[t+u];for(u+=h,r=p&(1<<-d)-1,p>>=-d,d+=s;d>0;r=256*r+e[t+u],u+=h,d-=8);for(a=r&(1<<-d)-1,r>>=-d,d+=n;d>0;a=256*a+e[t+u],u+=h,d-=8);if(0===r)r=1-c;else{if(r===l)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,n),r-=c}return(p?-1:1)*a*Math.pow(2,r-n)},ae.write=function(e,t,i,n,o,r){var a,s,l,c=8*r-o-1,d=(1<<c)-1,u=d>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:r-1,f=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=d):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+u>=1?h/l:h*Math.pow(2,1-u))*l>=2&&(a++,l/=2),a+u>=d?(s=0,a=d):a+u>=1?(s=(t*l-1)*Math.pow(2,o),a+=u):(s=t*Math.pow(2,u-1)*Math.pow(2,o),a=0));o>=8;e[i+p]=255&s,p+=f,s/=256,o-=8);for(a=a<<o|s,c+=o;c>0;e[i+p]=255&a,p+=f,a/=256,c-=8);e[i+p-f]|=128*g},se.prototype.readUIntLE=function(e,t,i){e>>>=0,t>>>=0,i||le(e,t,this.length);for(var n=this[e],o=1,r=0;++r<t&&(o*=256);)n+=this[e+r]*o;return n},se.prototype.readUIntBE=function(e,t,i){e>>>=0,t>>>=0,i||le(e,t,this.length);for(var n=this[e+--t],o=1;t>0&&(o*=256);)n+=this[e+--t]*o;return n},se.prototype.readUInt8=function(e,t){return e>>>=0,t||le(e,1,this.length),this[e]},se.prototype.readUInt16LE=function(e,t){return e>>>=0,t||le(e,2,this.length),this[e]|this[e+1]<<8},se.prototype.readUInt16BE=function(e,t){return e>>>=0,t||le(e,2,this.length),this[e]<<8|this[e+1]},se.prototype.readUInt32LE=function(e,t){return e>>>=0,t||le(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},se.prototype.readUInt32BE=function(e,t){return e>>>=0,t||le(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},se.prototype.readIntLE=function(e,t,i){e>>>=0,t>>>=0,i||le(e,t,this.length);for(var n=this[e],o=1,r=0;++r<t&&(o*=256);)n+=this[e+r]*o;return n>=(o*=128)&&(n-=Math.pow(2,8*t)),n},se.prototype.readIntBE=function(e,t,i){e>>>=0,t>>>=0,i||le(e,t,this.length);for(var n=t,o=1,r=this[e+--n];n>0&&(o*=256);)r+=this[e+--n]*o;return r>=(o*=128)&&(r-=Math.pow(2,8*t)),r},se.prototype.readInt8=function(e,t){return e>>>=0,t||le(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},se.prototype.readInt16LE=function(e,t){e>>>=0,t||le(e,2,this.length);var i=this[e]|this[e+1]<<8;return 32768&i?4294901760|i:i},se.prototype.readInt16BE=function(e,t){e>>>=0,t||le(e,2,this.length);var i=this[e+1]|this[e]<<8;return 32768&i?4294901760|i:i},se.prototype.readInt32LE=function(e,t){return e>>>=0,t||le(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},se.prototype.readInt32BE=function(e,t){return e>>>=0,t||le(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},se.prototype.readFloatLE=function(e,t){return e>>>=0,t||le(e,4,this.length),ae.read(this,e,!0,23,4)},se.prototype.readFloatBE=function(e,t){return e>>>=0,t||le(e,4,this.length),ae.read(this,e,!1,23,4)},se.prototype.readDoubleLE=function(e,t){return e>>>=0,t||le(e,8,this.length),ae.read(this,e,!0,52,8)},se.prototype.readDoubleBE=function(e,t){return e>>>=0,t||le(e,8,this.length),ae.read(this,e,!1,52,8)};var ce=j;var de={getTreeNodes:function(){let e=[],t=VGEEarth.getConfig(),i=[...t.layerList,...t.terrainList,...t.modelList,...t.cesium3DTileSetList,...t.geoJsonList,...t.poi],n=VGEEarth.globeDataCache.viewerLeftWorkSpace.nodes,o=function(e){let t=new Map;return e.forEach(e=>{let i=t.get(e.catalog);i?i.push(e):t.set(e.catalog,[e])}),t}(i);for(const[t,i]of o){let o=!0,r={name:t,open:!0,children:[]};i.forEach(e=>{let t=n.find(t=>t.pid===e.pid);r.children.push({id:e.pid,name:e.name,checked:!!t,nodeData:e}),0==!!t&&(o=!1)}),r.checked=o,e.push(r)}return e},getSetting:function(){let e=VGEEarth.globeDataCache.viewerLeftWorkSpace;return{check:{enable:!0,chkboxType:{Y:"ps",N:"ps"}},callback:{onCheck:function(t,i,n){let o=n.checked,r=this.getZTreeObj("treeDom").transformToArray(n);o?r.forEach(t=>{t.children||e.addData(t.nodeData)}):r.forEach(t=>{t.children||e.removeData(t.nodeData)})},onClick:function(t,i,n){n.children||e.flyToData(n.nodeData)}},data:{simpleData:{enable:!0}}}},initTree:function(){let e=this,t=VGEEarth.globeDataCache.viewerLeftWorkSpace;t?(t.sourceEvent.addEventListener(f,function(){setTimeout(()=>e.buildTree(),50)},""),t.sourceEvent.addEventListener(g,function(){setTimeout(()=>e.buildTree(),50)},""),this.buildTree()):console.log("请先初始化 Viewer")},buildTree:function(){let e=$("#treeDom"),t=this.getSetting(),i=this.getTreeNodes();$.fn.zTree.init(e,t,i)}};let ue,he,pe,fe,ge,me=new Cesium.Cartesian3,we=new Cesium.Quaternion;function ye(e){(ue=e).scene.preUpdate.addEventListener(function(e,t){null!=he&&he.flyActionMana.updateCurrentActionIndex()})}function be(e){this.flyActions=e,this.currentActionIndex=0,this.flyActions[0].updatePositionProperty(),this.flyActions[0].uptateOrientationProperty()}function Ce(e,t){this.startPosition=t.startPosition,this.currentPosition=this.startPosition,this.endPosition=t.endPosition,this.speed=t.speed,this.type=e,this.position=t.position,this.startQuaternion=t.startQuaternion,this.currentQuaternion=this.startQuaternion,this.endQuaternion=t.endQuaternion,this.rotateSpeed=t.rotateSpeed}function ve(e){this.times=[],this.quaternions=[]}function Se(e){return new o.Entity({position:e,point:{pixelSize:5,color:o.Color.RED,outlineColor:o.Color.WHITE,outlineWidth:2}})}Cesium.JulianDate.fromDate(new Date),ye.startFly=function(e){let t=[],i=[];for(let t=0;t<e.position.length;t+=3)i.push(e.position[t+0]),i.push(e.position[t+1]),i.push(e.position[t+2]+e.height);let n,o,r=Cesium.Cartesian3.fromDegreesArrayHeights(i),a=function(e){let t=new Cesium.SampledPositionProperty,i=Cesium.JulianDate.fromDate(new Date);for(let n=0;n<e.length;n++)t.addSample(Cesium.JulianDate.addSeconds(i,n,new Cesium.JulianDate),e[n]);let n=new Cesium.VelocityOrientationProperty(t),o=[];for(let t=0;t<e.length-1;t++){let e=n.getValue(Cesium.JulianDate.addSeconds(i,t+.5,new Cesium.JulianDate));o.push(e)}return o}(r);for(let i=0;i<r.length;i++){if(0===i){n=r[0];continue}o=r[i];let s=new Ce(Ce.Type.line,{startPosition:n,endPosition:o,speed:e.speed});if(t.push(s),s.orientations=a,i<r.length-1){let e=new Ce(Ce.Type.rotate,{position:o,startQuaternion:a[i-1],endQuaternion:a[i],rotateSpeed:10});t.push(e)}n=o}let s=new be(t);(he=ye.initEntity(ue,s)).flyActionMana=s,pe=ye.drawEntityLine(ue,e.position),ue.trackedEntity=he},ye.hidePlane=function(){1===he._model._color._value.alpha?(he._model._color._value.alpha=0,$("#hidePlane").hide(),$("#showPlane").show()):(he._model._color._value.alpha=1,$("#showPlane").hide(),$("#hidePlane").show())},ye.hideLine=function(){let e=pe.show;void 0===e||!0===e?(pe.show=!1,$("#hidePath").hide(),$("#showPath").show()):(pe.show=!0,$("#showPath").hide(),$("#hidePath").show())},ye.quitFly=function(){ue.scene.preUpdate.removeEventListener(ye.cameraFollow),pe&&(ue.entities.remove(pe),pe=null),he&&(ue.entities.remove(he),he=null)},ye.pauseFly=function(){let e=he.flyActionMana,t=e.flyActions[e.currentActionIndex];t.stopPosition(),t.stopOrientation()},ye.continueFly=function(){let e=he.flyActionMana,t=e.flyActions[e.currentActionIndex];t.restartPosition(),t.restartOrientation()},ye.upSpeed=function(){let e=he.flyActionMana,t=e.flyActions[0].speed;(t+=10)>100&&(t=100),e.updateSpeed(t)},ye.downSpeed=function(){let e=he.flyActionMana,t=e.flyActions[0].speed;(t-=10)<15&&(t=10),e.updateSpeed(t)},ye.follow=function(){ue.trackedEntity=he},ye.cameraUpdate=function(){ue.scene.preUpdate.addEventListener(ye.cameraFollow)},ye.cameraFollow=function(e,t){let i=new Cesium.HeadingPitchRoll;i=Cesium.HeadingPitchRoll.fromQuaternion(we),ue.camera.setView({destination:me,orientation:{heading:i.heading,pitch:-1,roll:0}}),ue.camera.moveForward(3),ue.camera.moveDown(1)},ye.free=function(){ue.scene.preUpdate.removeEventListener(ye.cameraFollow),ue.trackedEntity=void 0},ye.drawEntityLine=function(e,t){let i=new Cesium.CallbackProperty(function(){return Cesium.Cartesian3.fromDegreesArrayHeights(this.positions)});i.positions=t;let n=ue.entities.add({polyline:{positions:i,width:5,clampToGround:!0,arcType:Cesium.ArcType.RHUMB,material:Cesium.Color.YELLOW}});return n.positionsProperty=i,n},ye.initEntity=function(e,t){return(fe=new Cesium.CallbackProperty(function(){let e=this.flyActionMana.flyActions[this.flyActionMana.currentActionIndex];return me=e.getPosition(Cesium.JulianDate.fromDate(new Date)),e.getPosition(Cesium.JulianDate.fromDate(new Date))},!1)).flyActionMana=t,(ge=new Cesium.CallbackProperty(function(){let e=this.flyActionMana.flyActions[this.flyActionMana.currentActionIndex];return we=e.getOrientation(Cesium.JulianDate.fromDate(new Date)),e.getOrientation(Cesium.JulianDate.fromDate(new Date))},!1)).flyActionMana=t,e.entities.add({position:fe,orientation:ge,model:{uri:"../static/Models/Cesium_Air.glb",scale:1,color:Cesium.Color.fromAlpha(Cesium.Color.WHITE,1),minimumPixelSize:64,maximumScale:1e4,show:!0}})},be.prototype.updateCurrentActionIndex=function(){let e=this.flyActions[this.currentActionIndex];e.isDestroy()&&(e.resetPosition(),e.resetOrientation(),this.currentActionIndex+1===this.flyActions.length?(this.currentActionIndex=0,this.flyActions[0].updatePositionProperty(),this.flyActions[0].uptateOrientationProperty()):((e=this.flyActions[this.currentActionIndex+1]).updatePositionProperty(),e.uptateOrientationProperty(),this.currentActionIndex++))},be.prototype.updateSpeed=function(e){for(let t=0;t<this.flyActions.length;t++)this.flyActions[t].type===Ce.Type.line&&(this.flyActions[t].speed=e);let t=this.flyActions[this.currentActionIndex];t.updatePositionProperty(),t.uptateOrientationProperty()},Ce.Type={},Ce.Type.line=1,Ce.Type.rotate=2,Ce.prototype.getPosition=function(e){let t;return 1===this.state?t=this.currentPosition:(t=this.positionProperty.getValue(e),this.currentPosition=t,void 0===this.currentPosition&&(this.currentPosition=this.endPosition)),t},Ce.prototype.stopPosition=function(){this.state=1},Ce.prototype.restartPosition=function(){this.state=0,this.updatePositionProperty()},Ce.prototype.resetPosition=function(){this.currentPosition=this.startPosition},Ce.prototype.updatePositionProperty=function(){let e=new Cesium.SampledPositionProperty;if(this.type===Ce.Type.line){let t=Cesium.JulianDate.fromDate(new Date);e.addSample(t,this.currentPosition);let i=Math.sqrt(Math.pow(this.currentPosition.x-this.endPosition.x,2)+Math.pow(this.currentPosition.y-this.endPosition.y,2)+Math.pow(this.currentPosition.z-this.endPosition.z,2)),n=Cesium.JulianDate.addSeconds(t,i/this.speed,new Cesium.JulianDate);e.addSample(n,this.endPosition)}if(this.type===Ce.Type.rotate){let t=Cesium.JulianDate.fromDate(new Date);e.addSample(t,this.position);let i=Cesium.HeadingPitchRoll.fromQuaternion(this.currentQuaternion),n=Cesium.HeadingPitchRoll.fromQuaternion(this.endQuaternion),o=Math.abs(n.heading-i.heading),r=Cesium.JulianDate.addSeconds(t,o/this.rotateSpeed,new Cesium.JulianDate);e.addSample(r,this.position)}this.positionProperty=e},Ce.prototype.getOrientation=function(e){let t;return 1===this.state?t=this.currentQuaternion:(t=this.orientationProperty.getValue(e),this.currentQuaternion=t,void 0===this.currentQuaternion&&(this.currentQuaternion=this.endQuaternion)),t},Ce.prototype.stopOrientation=function(){this.state=1},Ce.prototype.restartOrientation=function(){this.state=0,this.uptateOrientationProperty()},Ce.prototype.resetOrientation=function(){this.currentQuaternion=this.startQuaternion},Ce.prototype.uptateOrientationProperty=function(){if(this.type===Ce.Type.line){let e=new Cesium.VelocityOrientationProperty(this.positionProperty);this.orientationProperty=e}if(this.type===Ce.Type.rotate){let e=new ve,t=Cesium.JulianDate.fromDate(new Date);e.addSample(t,this.currentQuaternion);let i=Cesium.HeadingPitchRoll.fromQuaternion(this.currentQuaternion),n=Cesium.HeadingPitchRoll.fromQuaternion(this.endQuaternion),o=Math.abs(n.heading-i.heading),r=Cesium.JulianDate.addSeconds(t,o/this.rotateSpeed,new Cesium.JulianDate);e.addSample(r,this.endQuaternion),this.orientationProperty=e}},Ce.prototype.isDestroy=function(){let e=!1;if(this.type===Ce.Type.line&&(this.currentPosition,Math.sqrt(Math.pow(this.currentPosition.x-this.endPosition.x,2)+Math.pow(this.currentPosition.y-this.endPosition.y,2)+Math.pow(this.currentPosition.z-this.endPosition.z,2))<1&&(e=!0)),this.type===Ce.Type.rotate){let t=Cesium.HeadingPitchRoll.fromQuaternion(this.currentQuaternion),i=Cesium.HeadingPitchRoll.fromQuaternion(this.endQuaternion);Math.abs(i.heading-t.heading)<6&&(e=!0)}return e},ve.prototype.addSample=function(e,t){this.times.push(e),this.quaternions.push(t)},ve.prototype.getValue=function(e,t){let i,n,o,r,a=new Cesium.Quaternion;if(0!==this.times.length){if(1===this.times.length)return this.quaternions[0];for(let t=0;t<this.times.length;t++)if(0!==t){if(n=this.times[t],r=this.quaternions[t],e.dayNumber+e.secondsOfDay>=i.dayNumber+i.secondsOfDay&&e.dayNumber+e.secondsOfDay<=n.dayNumber+n.secondsOfDay){let t=(e.dayNumber+e.secondsOfDay-(i.dayNumber+i.secondsOfDay))/(n.dayNumber+n.secondsOfDay-(i.dayNumber+i.secondsOfDay));Cesium.Quaternion.lerp(o,r,t,a);break}i=n,o=r}else if(i=this.times[0],o=this.quaternions[0],i.dayNumber+i.secondsOfDay>e.dayNumber+e.secondsOfDay)return;return a}};const Te={wj:"wjIcon",dataSet:"DataSetIcon",vrs:"VRSIcon",bim:"BIMIcon",las:"LASIcon",hole:"HoleIcon",pipe:"PipeIcon","3Dtiles":"TILES_3D_Icon",wms:"TILESIcon","layer-xyz-4326":"TILESIcon","layer-xyz-3857":"TILESIcon",geoserver:"TILESIcon",dem:"DEMIcon",shp_polygon:"PolygonFill_Icon",shp_line:"BrokenLine_Icon",shp_point:"Points_Icon",isoline:"ISOLineIcon",lct:"lct_Icon",wanderingThrough:"myllIcon",flightPath:"fxljIcon",oneCarRoaming:"rcmyIcon",surroundingBrowse:"hrllIcon",thematicData:"ztsjIcon",drillingData:"zksjIcon",BIMData:"bimIcon",formationModelData:"dcmxIcon",geologicalModelAnalysis:"dzmxfxIcon",stratigraphicModel:"dcjmIcon",peelingAnalysis:"bcfxIcon",tunnelAnalysis:"sdfxIcon",excavationAnalysis:"kwfxIcon",cuttingAnalysis:"pqfxIcon",fenceProfile:"slpmIcon",profile:"pmtIcon",surfaceWaveVelocityAnalysis:"mbsfxIcon",rectangularModel:"jxmxIcon",highlySplittings:"gdbpIcon",waveSplittings:"bsbpIcon",digAnalysis:"wkfxIcon",pointCloudAnalysis:"dyfxIcon",graphicData:"txsjIcon",set:"setIcon",weatherEffects:"tqxgIcon",query:"cxIcon",statistical:"tjIcon",appendageClassification:"fswfltjIcon",pipeClasses:"glfltjIcon",PipeDiameter:"gjfltjIcon",visual:"ksyIcon",coverage:"tcglIcon","modelManagement ":"mxglIcon",externalData:"wbsjIcon"},Pe={bim:"建筑模型",las:"点云","3DTiles":"三维模型","layer-wms":"图层","layer-wmts":"图层","layer-arcgisMapServer":"图层","layer-xyz-4326":"图层","layer-xyz-3857":"图层","layer-geoserver":"数据",dem:"高程",shp_polygon:"矢量面",shp_line:"矢量线",shp_point:"矢量点"};let Ee={globeDataCache:i,Viewer:C,ScreenSpaceHandlerMana:x,DrawShape:G,FlyToWorkspace:V,GlobalRotation:q,ParsWKB:ce,TreeMana:de,SysMathTool:R,ViewerListener:class{constructor(){this.listenCallbacks=[]}addEventListener(e,t,i){return!this.listenCallbacks.find(n=>n.listenType===e&&n.callback===t&&n.scope===i)&&(this.listenCallbacks.push({listenType:e,callback:t,scope:i}),!0)}triggerEvent(e,t){this.listenCallbacks.forEach(i=>{i.listenType===e&&"function"==typeof i.callback?i.callback(t):console.log("无法触发监听方法：",i.callback)})}removeListen(e){return!!this.listenCallbacks.find(t=>t.callback===e)&&(this.listenCallbacks=this.listenCallbacks.filter(t=>t.callback!==e),!0)}},restMap:function(e){e.commit("resetLegend"),e.commit("resetTimeAxis"),e.commit("reSetWindows")},FlyMana:ye,SceneTool:w,EntityFactory:u,MeasureTool:class{constructor(e){this.viewer=e,this.dataSourceToo=new o.CustomDataSource("测量工具-实体集合"),e.dataSources.add(this.dataSourceToo),this.entityFactory=new u(e,this.dataSourceToo),this.drawShape=new G(e)}CesiumTriangle(){}measureTriangle(){let e=this;e.drawShape.drawTriangle({endCallback:function(t){if(3===t.length){for(let i in t)e.dataSourceToo.entities.add(Se(t[i]));e.dataSourceToo.entities.add(function(e){return new o.Entity({polyline:{positions:e,width:3,clampToGround:!0,arcType:o.ArcType.RHUMB,material:o.Color.GREEN}})}(t));let i=R.calculateTriangle(t).toFixed(3)+"度";e.dataSourceToo.entities.add(function(e,t){return new o.Entity({position:e,label:{text:t,font:"16pt monospace",color:o.Color.RED,backgroundColor:o.Color.RED,style:o.LabelStyle.FILL_AND_OUTLINE,outlineWidth:2,heightReference:o.HeightReference.NONE,verticalOrigin:o.VerticalOrigin.TOP,pixelOffset:new o.Cartesian2(30,-30)}})}(t[1],i))}}})}verticalDistance(){let e=this;e.removeAll();let t,i,n=[],r=null,a=null,{handler:s}=x.getHandle(e.viewer,function(){});s.setInputAction(function(i){a=e.viewer.scene.pickPosition(i.endPosition),o.defined(a)&&n.length>=2&&(o.defined(r)?(n.pop(),n.push(a)):r=new class{constructor(e){this.options={name:"直线",polyline:{show:!0,positions:[],material:o.Color.AQUA,depthFailMaterial:new o.PolylineOutlineMaterialProperty({color:o.Color.RED}),width:2},ellipse:{show:!0,semiMinorAxis:5,semiMajorAxis:5,material:o.Color.GREEN.withAlpha(.7),outline:!0}},this.positions=e,this._init()}_init(){let t=this,i=function(){let e=o.Cartographic.fromCartesian(t.positions[0]),i=o.Cartographic.fromCartesian(t.positions[1]),n=new o.EllipsoidGeodesic;return n.setEndPoints(e,i),n.surfaceDistance};this.options.polyline.positions=new o.CallbackProperty(function(){let e=[];e.push(t.positions[0]);let i=o.Cartographic.fromCartesian(t.positions[0]),n=o.Cartographic.fromCartesian(t.positions[1]),r=o.Cartesian3.fromDegrees(o.Math.toDegrees(i.longitude),o.Math.toDegrees(i.latitude),n.height);return e.push(r),e},!1),this.options.position=new o.CallbackProperty(function(){return t.positions[0]},!1),this.options.ellipse.semiMinorAxis=new o.CallbackProperty(i,!1),this.options.ellipse.semiMajorAxis=new o.CallbackProperty(i,!1),this.options.ellipse.height=new o.CallbackProperty(function(){let e=function(e){return o.Cartographic.fromCartesian(e[1]).height.toFixed(2)}(t.positions);return e},!1),e.dataSourceToo.entities.add(this.options)}}(n),t=function(e){let t=o.Cartographic.fromCartesian(e[0]);return(o.Cartographic.fromCartesian(e[1]).height-t.height).toFixed(2)}(n))},o.ScreenSpaceEventType.MOUSE_MOVE),s.setInputAction(function(t){a=e.viewer.scene.pickPosition(t.position),o.defined(a)&&0==n.length&&(n.push(a.clone()),n.push(a),i=e.entityFactory.PointLabelEntity(n[0],"0米"))},o.ScreenSpaceEventType.LEFT_CLICK),s.setInputAction(function(i){if(s.destroy(),2===n.length){let i=t+"米",s=o.Cartographic.fromCartesian(n[0]),l=o.Cartographic.fromCartesian(n[1]),c=o.Cartesian3.fromDegrees(o.Math.toDegrees(s.longitude),o.Math.toDegrees(s.latitude),l.height);e.entityFactory.PointLabelEntity(c,i),n=[],r=null,t="0米",a=null}},o.ScreenSpaceEventType.RIGHT_CLICK)}spaceDistance(){let e=this,t=0;this.drawShape.drawPolyLine({endCallback:function(i){if(i.length>=2){for(let t in i)e.dataSourceToo.entities.add({position:i[t],point:{pixelSize:6,color:o.Color.WHITE}});if(e.dataSourceToo.entities.add({polyline:{positions:i,width:3,clampToGround:!0,arcType:o.ArcType.RHUMB,material:o.Color.GREEN}}),i.length>=2&&i.length-1>t){t++;let n=i[i.length-1],o=i[i.length-2];e.entityFactory.spaceDistanceLabel(n,o)}}},errCallback:function(i){if(i.length>2&&i.length-2>t){t++;let n=i[i.length-2],o=i[i.length-3];e.entityFactory.spaceDistanceLabel(n,o)}}})}measureHeight(){let e=this;e.drawShape.drawPoint({endCallback:function(t){let i=new o.Cartographic.fromCartesian(t[0]),n=(e.viewer.scene.sampleHeight(i)||0).toFixed(3)+" m",r=Se(t[0]),a=e.entityFactory.buildLabel(t[0],n);e.dataSourceToo.entities.add(r),e.dataSourceToo.entities.add(a)}})}surfaceArea(){let e=this;e.viewer,this.drawShape.drawPolygon({endCallback:function(t){if(t.length>3){e.dataSourceToo.entities.add({polygon:{hierarchy:t,material:o.Color.BLUEVIOLET.withAlpha(.5)}});for(let i=0;i<t.length-1;i++)e.dataSourceToo.entities.add({position:t[i],point:{pixelSize:5,color:o.Color.RED,outlineColor:o.Color.WHITE,outlineWidth:2}});let i=[];for(let e=0;e<t.length;e++)i.push(o.Cartographic.fromCartesian(new o.Cartesian3(t[e].x,t[e].y,t[e].z),o.Ellipsoid.WGS84,new o.Cartographic));let n=[];for(let e=0;e<i.length;e++){let t=i[e].longitude/Math.PI*180,o=i[e].latitude/Math.PI*180;n.push([t,o])}let r={type:"Polygon"};r.coordinates=[n],e.entityFactory.polygonCenterLabel(r,"面积")}else console.error("绘制失败")}})}perimeter(){let e=this;e.viewer,this.drawShape.drawPolygon({endCallback:function(t){if(t.length>3){e.dataSourceToo.entities.add({polygon:{hierarchy:t,material:o.Color.BLUEVIOLET.withAlpha(.5)}});for(let i=0;i<t.length-1;i++)e.dataSourceToo.entities.add(Se(t[i]));let i=[];for(let e=0;e<t.length;e++)i.push(o.Cartographic.fromCartesian(new o.Cartesian3(t[e].x,t[e].y,t[e].z),o.Ellipsoid.WGS84,new o.Cartographic));let n=[];for(let e=0;e<i.length;e++){let t=i[e].longitude/Math.PI*180,o=i[e].latitude/Math.PI*180;n.push([t,o])}let r={type:"Polygon"};r.coordinates=[n],e.entityFactory.polygonCenterLabel(r,"周长")}else console.error("绘制失败")}})}profileAnalysis(){}visiableSelectPoint(){}removeAll(){this.dataSourceToo.entities.removeAll()}},ViewShedStage:class{constructor(e,t){this.viewer=e,this.viewPosition=t.viewPosition,this.viewPositionEnd=t.viewPositionEnd,this.viewDistance=this.viewPositionEnd?o.Cartesian3.distance(this.viewPosition,this.viewPositionEnd):t.viewDistance||100,this.viewHeading=this.viewPositionEnd?this.getHeading(this.viewPosition,this.viewPositionEnd):t.viewHeading||0,this.viewPitch=this.viewPositionEnd?this.getPitch(this.viewPosition,this.viewPositionEnd):t.viewPitch||0,this.horizontalViewAngle=t.horizontalViewAngle||90,this.verticalViewAngle=t.verticalViewAngle||60,this.visibleAreaColor=t.visibleAreaColor||o.Color.GREEN,this.invisibleAreaColor=t.invisibleAreaColor||o.Color.RED,this.enabled="boolean"!=typeof t.enabled||t.enabled,this.softShadows="boolean"!=typeof t.softShadows||t.softShadows,this.size=t.size||1024,this.update()}update(){this.clear(),this.createLightCamera(),this.createShadowMap(),this.createPostStage(),this.drawFrustumOutline(),this.drawSketch()}clear(){this.sketch&&(this.viewer.entities.removeById(this.sketch.id),this.sketch=null),this.frustumOutline&&(this.frustumOutline.destroy(),this.frustumOutline=null),this.postStage&&(this.viewer.scene.postProcessStages.remove(this.postStage),this.postStage=null)}createLightCamera(){this.lightCamera=new o.Camera(this.viewer.scene),this.lightCamera.position=this.viewPosition,this.lightCamera.frustum.near=.001*this.viewDistance,this.lightCamera.frustum.far=this.viewDistance;const e=o.Math.toRadians(this.horizontalViewAngle),t=o.Math.toRadians(this.verticalViewAngle),i=this.viewDistance*Math.tan(e/2)*2/(this.viewDistance*Math.tan(t/2)*2);this.lightCamera.frustum.aspectRatio=i,this.lightCamera.frustum.fov=e>t?e:t,this.lightCamera.setView({destination:this.viewPosition,orientation:{heading:o.Math.toRadians(this.viewHeading||0),pitch:o.Math.toRadians(this.viewPitch||0),roll:0}})}createShadowMap(){this.shadowMap=new o.ShadowMap({context:this.viewer.scene.context,lightCamera:this.lightCamera,enabled:this.enabled,isPointLight:!0,pointLightRadius:this.viewDistance,cascadesEnabled:!1,size:this.size,softShadows:this.softShadows,normalOffset:!1,fromLightSource:!1}),this.viewer.scene.shadowMap=this.shadowMap}createPostStage(){const e=new o.PostProcessStage({fragmentShader:"\n #define USE_CUBE_MAP_SHADOW true\n uniform sampler2D colorTexture;\n uniform sampler2D depthTexture;\n varying vec2 v_textureCoordinates;\n uniform mat4 camera_projection_matrix;\n uniform mat4 camera_view_matrix;\n uniform samplerCube shadowMap_textureCube;\n uniform mat4 shadowMap_matrix;\n uniform vec4 shadowMap_lightPositionEC;\n uniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness;\n uniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth;\n uniform float helsing_viewDistance;\n uniform vec4 helsing_visibleAreaColor;\n uniform vec4 helsing_invisibleAreaColor;\n struct zx_shadowParameters\n {\n     vec3 texCoords;\n     float depthBias;\n     float depth;\n     float nDotL;\n     vec2 texelStepSize;\n     float normalShadingSmooth;\n     float darkness;\n };\n float czm_shadowVisibility(samplerCube shadowMap, zx_shadowParameters shadowParameters)\n {\n     float depthBias = shadowParameters.depthBias;\n     float depth = shadowParameters.depth;\n     float nDotL = shadowParameters.nDotL;\n     float normalShadingSmooth = shadowParameters.normalShadingSmooth;\n     float darkness = shadowParameters.darkness;\n     vec3 uvw = shadowParameters.texCoords;\n     depth -= depthBias;\n     float visibility = czm_shadowDepthCompare(shadowMap, uvw, depth);\n     return czm_private_shadowVisibility(visibility, nDotL, normalShadingSmooth, darkness);\n }\n vec4 getPositionEC(){\n     return czm_windowToEyeCoordinates(gl_FragCoord);\n }\n vec3 getNormalEC(){\n     return vec3(1.);\n }\n vec4 toEye(in vec2 uv,in float depth){\n     vec2 xy=vec2((uv.x*2.-1.),(uv.y*2.-1.));\n     vec4 posInCamera=czm_inverseProjection*vec4(xy,depth,1.);\n     posInCamera=posInCamera/posInCamera.w;\n     return posInCamera;\n }\n vec3 pointProjectOnPlane(in vec3 planeNormal,in vec3 planeOrigin,in vec3 point){\n     vec3 v01=point-planeOrigin;\n     float d=dot(planeNormal,v01);\n     return(point-planeNormal*d);\n }\n float getDepth(in vec4 depth){\n     float z_window=czm_unpackDepth(depth);\n     z_window=czm_reverseLogDepth(z_window);\n     float n_range=czm_depthRange.near;\n     float f_range=czm_depthRange.far;\n     return(2.*z_window-n_range-f_range)/(f_range-n_range);\n }\n float shadow(in vec4 positionEC){\n     vec3 normalEC=getNormalEC();\n     zx_shadowParameters shadowParameters;\n     shadowParameters.texelStepSize=shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy;\n     shadowParameters.depthBias=shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z;\n     shadowParameters.normalShadingSmooth=shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w;\n     shadowParameters.darkness=shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w;\n     vec3 directionEC=positionEC.xyz-shadowMap_lightPositionEC.xyz;\n     float distance=length(directionEC);\n     directionEC=normalize(directionEC);\n     float radius=shadowMap_lightPositionEC.w;\n     if(distance>radius)\n     {\n         return 2.0;\n     }\n     vec3 directionWC=czm_inverseViewRotation*directionEC;\n     shadowParameters.depth=distance/radius-0.0003;\n     shadowParameters.nDotL=clamp(dot(normalEC,-directionEC),0.,1.);\n     shadowParameters.texCoords=directionWC;\n     float visibility=czm_shadowVisibility(shadowMap_textureCube,shadowParameters);\n     return visibility;\n }\n bool visible(in vec4 result)\n {\n     result.x/=result.w;\n     result.y/=result.w;\n     result.z/=result.w;\n     return result.x>=-1.&&result.x<=1.\n     &&result.y>=-1.&&result.y<=1.\n     &&result.z>=-1.&&result.z<=1.;\n }\n void main(){\n     // 釉色 = 结构二维(颜色纹理, 纹理坐标)\n     gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\n     // 深度 = 获取深度(结构二维(深度纹理, 纹理坐标))\n     float depth = getDepth(texture2D(depthTexture, v_textureCoordinates));\n     // 视角 = (纹理坐标, 深度)\n     vec4 viewPos = toEye(v_textureCoordinates, depth);\n     // 世界坐标\n     vec4 wordPos = czm_inverseView * viewPos;\n     // 虚拟相机中坐标\n     vec4 vcPos = camera_view_matrix * wordPos;\n     float near = .001 * helsing_viewDistance;\n     float dis = length(vcPos.xyz);\n     if(dis > near && dis < helsing_viewDistance){\n         // 透视投影\n         vec4 posInEye = camera_projection_matrix * vcPos;\n         // 可视区颜色\n         // vec4 helsing_visibleAreaColor=vec4(0.,1.,0.,.5);\n         // vec4 helsing_invisibleAreaColor=vec4(1.,0.,0.,.5);\n         if(visible(posInEye)){\n             float vis = shadow(viewPos);\n             if(vis > 0.3){\n                 gl_FragColor = mix(gl_FragColor,helsing_visibleAreaColor,.5);\n             } else{\n                 gl_FragColor = mix(gl_FragColor,helsing_invisibleAreaColor,.5);\n             }\n         }\n     }\n }",uniforms:{shadowMap_textureCube:()=>(this.shadowMap.update(Reflect.get(this.viewer.scene,"_frameState")),Reflect.get(this.shadowMap,"_shadowMapTexture")),shadowMap_matrix:()=>(this.shadowMap.update(Reflect.get(this.viewer.scene,"_frameState")),Reflect.get(this.shadowMap,"_shadowMapMatrix")),shadowMap_lightPositionEC:()=>(this.shadowMap.update(Reflect.get(this.viewer.scene,"_frameState")),Reflect.get(this.shadowMap,"_lightPositionEC")),shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:()=>{this.shadowMap.update(Reflect.get(this.viewer.scene,"_frameState"));const e=this.shadowMap._pointBias;return o.Cartesian4.fromElements(e.normalOffsetScale,this.shadowMap._distance,this.shadowMap.maximumDistance,0,new o.Cartesian4)},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:()=>{this.shadowMap.update(Reflect.get(this.viewer.scene,"_frameState"));const e=this.shadowMap._pointBias,t=new o.Cartesian2;return t.x=1/this.shadowMap._textureSize.x,t.y=1/this.shadowMap._textureSize.y,o.Cartesian4.fromElements(t.x,t.y,e.depthBias,e.normalShadingSmooth,new o.Cartesian4)},camera_projection_matrix:this.lightCamera.frustum.projectionMatrix,camera_view_matrix:this.lightCamera.viewMatrix,helsing_viewDistance:()=>this.viewDistance,helsing_visibleAreaColor:this.visibleAreaColor,helsing_invisibleAreaColor:this.invisibleAreaColor}});this.postStage=this.viewer.scene.postProcessStages.add(e)}drawFrustumOutline(){const e=new o.Cartesian3,t=new o.Matrix3,i=new o.Quaternion,n=(this.lightCamera.positionWC,this.lightCamera.directionWC),r=this.lightCamera.upWC;let a=this.lightCamera.rightWC;a=o.Cartesian3.negate(a,e);let s=t;o.Matrix3.setColumn(s,0,a,s),o.Matrix3.setColumn(s,1,r,s),o.Matrix3.setColumn(s,2,n,s);let l=o.Quaternion.fromRotationMatrix(s,i),c=new o.GeometryInstance({geometry:new o.FrustumOutlineGeometry({frustum:this.lightCamera.frustum,origin:this.viewPosition,orientation:l}),id:Math.random().toString(36).substr(2),attributes:{color:o.ColorGeometryInstanceAttribute.fromColor(o.Color.YELLOWGREEN),show:new o.ShowGeometryInstanceAttribute(!0)}});this.frustumOutline=this.viewer.scene.primitives.add(new o.Primitive({geometryInstances:[c],appearance:new o.PerInstanceColorAppearance({flat:!0,translucent:!1})}))}drawSketch(){this.sketch=this.viewer.entities.add({name:"sketch",position:this.viewPosition,orientation:o.Transforms.headingPitchRollQuaternion(this.viewPosition,o.HeadingPitchRoll.fromDegrees(this.viewHeading-90,this.viewPitch,0)),ellipsoid:{radii:new o.Cartesian3(this.viewDistance,this.viewDistance,this.viewDistance),minimumClock:o.Math.toRadians(-this.horizontalViewAngle/2),maximumClock:o.Math.toRadians(this.horizontalViewAngle/2),minimumCone:o.Math.toRadians(90-this.verticalViewAngle),maximumCone:o.Math.toRadians(90+this.verticalViewAngle),fill:!1,outline:!0,subdivisions:256,stackPartitions:64,slicePartitions:64,outlineColor:o.Color.YELLOWGREEN}})}getHeading(e,t){let i=new o.Cartesian3,n=o.Transforms.eastNorthUpToFixedFrame(e);return o.Matrix4.inverse(n,n),o.Matrix4.multiplyByPoint(n,t,i),o.Cartesian3.normalize(i,i),o.Math.toDegrees(Math.atan2(i.x,i.y))}getPitch(e,t){let i=new o.Cartesian3,n=o.Transforms.eastNorthUpToFixedFrame(e);return o.Matrix4.inverse(n,n),o.Matrix4.multiplyByPoint(n,t,i),o.Cartesian3.normalize(i,i),o.Math.toDegrees(Math.asin(i.z))}},ScreenEvent:y,WorkSpace:m,WorkspaceContextMenu:{MenuItems:[{id:"location",icon:"",text:"定位",beginGroup:!0,visible:!1},{id:"polygon",icon:"",text:"载入图斑",visible:!1},{id:"bound",icon:"",text:"载入边界",visible:!1},{id:"line",icon:"",text:"载入线条",visible:!1},{id:"point",icon:"",text:"载入点位",visible:!1},{id:"text",icon:"",text:"载入标注",visible:!1},{id:"table",icon:"rowField",text:"打开属性表",beginGroup:!0,visible:!1},{id:"param",icon:"favorites",text:"符号系统",visible:!1}],getMenuData(e){let t=JSON.parse(JSON.stringify(this.MenuItems));switch(e.map_type){case"wmts":case"layer-xyz-3857":case"wms":t[0].visible=!0,t[8].visible=!0;break;case"mvt":{e.properties.table;let i=e.properties.layer_type;t[0].visible=!0,"polygon"===i&&(t[1].visible=!0,t[2].visible=!0),"line"===i&&(t[3].visible=!0),t[5].visible=!0,t[6].visible=!0,t[7].visible=!0}break;case"arcgisMapserver":case"dem":case"3Dtiles":case"shape_postgis":break;default:t=[]}return t}},VGE3DTilesMana:class{constructor(){this.listenCallbacks=[]}addEventListener(e,t,i){return!this.listenCallbacks.find(n=>n.listenType===e&&n.callback===t&&n.scope===i)&&(this.listenCallbacks.push({listenType:e,callback:t,scope:i}),!0)}triggerEvent(e,t){this.listenCallbacks.forEach(i=>{i.listenType===e&&"function"==typeof i.callback?i.callback(t):console.log("无法触发监听方法：",i.callback)})}removeListen(e){return!!this.listenCallbacks.find(t=>t.callback===e)&&(this.listenCallbacks.filter(t=>t.callback===e),!0)}},VGEImageryLayerMana:class{constructor(){this.listenCallbacks=[]}addEventListener(e,t,i){return!this.listenCallbacks.find(n=>n.listenType===e&&n.callback===t&&n.scope===i)&&(this.listenCallbacks.push({listenType:e,callback:t,scope:i}),!0)}triggerEvent(e,t){this.listenCallbacks.forEach(i=>{i.listenType===e&&"function"==typeof i.callback?i.callback(t):console.log("无法触发监听方法：",i.callback)})}removeListen(e){return!!this.listenCallbacks.find(t=>t.callback===e)&&(this.listenCallbacks=this.listenCallbacks.filter(t=>t.callback!==e),!0)}},WorkSpaceConfig:{getIcon:e=>Te[e],getName:e=>Pe[e]},MotionEntity:h,getMainViewer:function(){return i.viewerLeft},ConfigTool:c,getConfig:c.getConfig};window.VGEEarth=Ee,console.log("%cVGEEarth：当前接口版本：v"+i.version,"color: green;");var Me=Ee;return t}()},e.exports=n()}},["NHnr"]);
//# sourceMappingURL=app.306c59f2f964b3630130.js.map